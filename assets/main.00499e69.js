var ms=Object.defineProperty,_s=Object.defineProperties;var Es=Object.getOwnPropertyDescriptors;var ai=Object.getOwnPropertySymbols;var Ss=Object.prototype.hasOwnProperty,Ts=Object.prototype.propertyIsEnumerable;var li=(t,e,r)=>e in t?ms(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ot=(t,e)=>{for(var r in e||(e={}))Ss.call(e,r)&&li(t,r,e[r]);if(ai)for(var r of ai(e))Ts.call(e,r)&&li(t,r,e[r]);return t},Lt=(t,e)=>_s(t,Es(e));class $t{constructor(e){this.properties=e!=null?e:[]}get(e){const r=this.properties.filter(n=>n.name===e).map(n=>n.value);if(r.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(r.length!==0)return r[0]}getString(e){return this.getByType(e,"string")}getNumber(e){return this.getByType(e,"number")}getBoolean(e){return this.getByType(e,"boolean")}getByType(e,r){const n=this.get(e);if(n!==void 0){if(typeof n!==r)throw new Error('Expected property "'+e+'" to have type "'+r+'"');return n}}mustGetString(e){return this.mustGetByType(e,"string")}mustGetNumber(e){return this.mustGetByType(e,"number")}mustGetBoolean(e){return this.mustGetByType(e,"boolean")}mustGetByType(e,r){const n=this.get(e);if(n===void 0)throw new Error('Property "'+e+'" is missing');if(typeof n!==r)throw new Error('Expected property "'+e+'" to have type "'+r+'"');return n}getType(e){const r=this.properties.filter(n=>n.name===e).map(n=>n.type);if(r.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(r.length!==0)return r[0]}}const Tr="https://unpkg.com/@workadventure/scripting-api-extra@1.3.2/dist";class Cs{constructor(e){this.name=e.name,this.x=e.x,this.y=e.y,this.properties=new $t(e.properties)}get isReadable(){const e=this.properties.getString("readableBy");return e?WA.player.tags.includes(e):!0}get isWritable(){const e=this.properties.getString("writableBy");return e?WA.player.tags.includes(e):!0}}function fi(t){const e=t?"#"+t.join():"";WA.nav.openCoWebSite(Tr+"/configuration.html"+e)}async function As(t,e){const r=await WA.room.getTiledMap(),n=new Map;return Ki(r.layers,n,t,e),n}function Ki(t,e,r,n){for(const i of t)if(i.type==="objectgroup"){for(const o of i.objects)if(o.type==="variable"){if(!!r&&i.name!==r||!!n&&!n.includes(o.name))continue;e.set(o.name,new Cs(o))}}else i.type==="group"&&Ki(i.layers,e,r,n)}let Hr;async function Cr(){return Hr===void 0&&(Hr=ks()),Hr}async function ks(){return Is(await WA.room.getTiledMap())}function Is(t){const e=new Map;return Gi(t.layers,"",e),e}function Gi(t,e,r){for(const n of t)n.type==="group"?Gi(n.layers,e+n.name+"/",r):(n.name=e+n.name,r.set(n.name,n))}function xs(t){let e=1/0,r=1/0,n=0,i=0;const o=t.data;if(typeof o=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let s=0;s<t.height;s++)for(let a=0;a<t.width;a++)o[a+s*t.width]!==0&&(e=Math.min(e,a),i=Math.max(i,a),r=Math.min(r,s),n=Math.max(n,s));return{top:r,left:e,right:i+1,bottom:n+1}}function Qi(t){let e=1/0,r=1/0,n=0,i=0;for(const o of t){const s=xs(o);s.left<e&&(e=s.left),s.top<r&&(r=s.top),s.right>i&&(i=s.right),s.bottom>n&&(n=s.bottom)}return{top:r,left:e,right:i,bottom:n}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var Bs=Object.prototype.toString,Pt=Array.isArray||function(e){return Bs.call(e)==="[object Array]"};function kn(t){return typeof t=="function"}function Rs(t){return Pt(t)?"array":typeof t}function Kr(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function ui(t,e){return t!=null&&typeof t=="object"&&e in t}function Ps(t,e){return t!=null&&typeof t!="object"&&t.hasOwnProperty&&t.hasOwnProperty(e)}var Ms=RegExp.prototype.test;function Os(t,e){return Ms.call(t,e)}var Ls=/\S/;function Ds(t){return!Os(Ls,t)}var Us={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Fs(t){return String(t).replace(/[&<>"'`=\/]/g,function(r){return Us[r]})}var Ns=/\s*/,js=/\s+/,ci=/\s*=/,qs=/\s*\}/,Ws=/#|\^|\/|>|\{|&|=|!/;function $s(t,e){if(!t)return[];var r=!1,n=[],i=[],o=[],s=!1,a=!1,f="",l=0;function d(){if(s&&!a)for(;o.length;)delete i[o.pop()];else o=[];s=!1,a=!1}var p,y,w;function S(H){if(typeof H=="string"&&(H=H.split(js,2)),!Pt(H)||H.length!==2)throw new Error("Invalid tags: "+H);p=new RegExp(Kr(H[0])+"\\s*"),y=new RegExp("\\s*"+Kr(H[1])),w=new RegExp("\\s*"+Kr("}"+H[1]))}S(e||ge.tags);for(var _=new Kt(t),C,x,h,g,m,A;!_.eos();){if(C=_.pos,h=_.scanUntil(p),h)for(var R=0,j=h.length;R<j;++R)g=h.charAt(R),Ds(g)?(o.push(i.length),f+=g):(a=!0,r=!0,f+=" "),i.push(["text",g,C,C+1]),C+=1,g===`
`&&(d(),f="",l=0,r=!1);if(!_.scan(p))break;if(s=!0,x=_.scan(Ws)||"name",_.scan(Ns),x==="="?(h=_.scanUntil(ci),_.scan(ci),_.scanUntil(y)):x==="{"?(h=_.scanUntil(w),_.scan(qs),_.scanUntil(y),x="&"):h=_.scanUntil(y),!_.scan(y))throw new Error("Unclosed tag at "+_.pos);if(x==">"?m=[x,h,C,_.pos,f,l,r]:m=[x,h,C,_.pos],l++,i.push(m),x==="#"||x==="^")n.push(m);else if(x==="/"){if(A=n.pop(),!A)throw new Error('Unopened section "'+h+'" at '+C);if(A[1]!==h)throw new Error('Unclosed section "'+A[1]+'" at '+C)}else x==="name"||x==="{"||x==="&"?a=!0:x==="="&&S(h)}if(d(),A=n.pop(),A)throw new Error('Unclosed section "'+A[1]+'" at '+_.pos);return Vs(zs(i))}function zs(t){for(var e=[],r,n,i=0,o=t.length;i<o;++i)r=t[i],r&&(r[0]==="text"&&n&&n[0]==="text"?(n[1]+=r[1],n[3]=r[3]):(e.push(r),n=r));return e}function Vs(t){for(var e=[],r=e,n=[],i,o,s=0,a=t.length;s<a;++s)switch(i=t[s],i[0]){case"#":case"^":r.push(i),n.push(i),r=i[4]=[];break;case"/":o=n.pop(),o[5]=i[2],r=n.length>0?n[n.length-1][4]:e;break;default:r.push(i)}return e}function Kt(t){this.string=t,this.tail=t,this.pos=0}Kt.prototype.eos=function(){return this.tail===""};Kt.prototype.scan=function(e){var r=this.tail.match(e);if(!r||r.index!==0)return"";var n=r[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n};Kt.prototype.scanUntil=function(e){var r=this.tail.search(e),n;switch(r){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,r),this.tail=this.tail.substring(r)}return this.pos+=n.length,n};function Tt(t,e){this.view=t,this.cache={".":this.view},this.parent=e}Tt.prototype.push=function(e){return new Tt(e,this)};Tt.prototype.lookup=function(e){var r=this.cache,n;if(r.hasOwnProperty(e))n=r[e];else{for(var i=this,o,s,a,f=!1;i;){if(e.indexOf(".")>0)for(o=i.view,s=e.split("."),a=0;o!=null&&a<s.length;)a===s.length-1&&(f=ui(o,s[a])||Ps(o,s[a])),o=o[s[a++]];else o=i.view[e],f=ui(i.view,e);if(f){n=o;break}i=i.parent}r[e]=n}return kn(n)&&(n=n.call(this.view)),n};function he(){this.templateCache={_cache:{},set:function(e,r){this._cache[e]=r},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}he.prototype.clearCache=function(){typeof this.templateCache!="undefined"&&this.templateCache.clear()};he.prototype.parse=function(e,r){var n=this.templateCache,i=e+":"+(r||ge.tags).join(":"),o=typeof n!="undefined",s=o?n.get(i):void 0;return s==null&&(s=$s(e,r),o&&n.set(i,s)),s};he.prototype.render=function(e,r,n,i){var o=this.getConfigTags(i),s=this.parse(e,o),a=r instanceof Tt?r:new Tt(r,void 0);return this.renderTokens(s,a,n,e,i)};he.prototype.renderTokens=function(e,r,n,i,o){for(var s="",a,f,l,d=0,p=e.length;d<p;++d)l=void 0,a=e[d],f=a[0],f==="#"?l=this.renderSection(a,r,n,i,o):f==="^"?l=this.renderInverted(a,r,n,i,o):f===">"?l=this.renderPartial(a,r,n,o):f==="&"?l=this.unescapedValue(a,r):f==="name"?l=this.escapedValue(a,r,o):f==="text"&&(l=this.rawValue(a)),l!==void 0&&(s+=l);return s};he.prototype.renderSection=function(e,r,n,i,o){var s=this,a="",f=r.lookup(e[1]);function l(y){return s.render(y,r,n,o)}if(!!f){if(Pt(f))for(var d=0,p=f.length;d<p;++d)a+=this.renderTokens(e[4],r.push(f[d]),n,i,o);else if(typeof f=="object"||typeof f=="string"||typeof f=="number")a+=this.renderTokens(e[4],r.push(f),n,i,o);else if(kn(f)){if(typeof i!="string")throw new Error("Cannot use higher-order sections without the original template");f=f.call(r.view,i.slice(e[3],e[5]),l),f!=null&&(a+=f)}else a+=this.renderTokens(e[4],r,n,i,o);return a}};he.prototype.renderInverted=function(e,r,n,i,o){var s=r.lookup(e[1]);if(!s||Pt(s)&&s.length===0)return this.renderTokens(e[4],r,n,i,o)};he.prototype.indentPartial=function(e,r,n){for(var i=r.replace(/[^ \t]/g,""),o=e.split(`
`),s=0;s<o.length;s++)o[s].length&&(s>0||!n)&&(o[s]=i+o[s]);return o.join(`
`)};he.prototype.renderPartial=function(e,r,n,i){if(!!n){var o=this.getConfigTags(i),s=kn(n)?n(e[1]):n[e[1]];if(s!=null){var a=e[6],f=e[5],l=e[4],d=s;f==0&&l&&(d=this.indentPartial(s,l,a));var p=this.parse(d,o);return this.renderTokens(p,r,n,d,i)}}};he.prototype.unescapedValue=function(e,r){var n=r.lookup(e[1]);if(n!=null)return n};he.prototype.escapedValue=function(e,r,n){var i=this.getConfigEscape(n)||ge.escape,o=r.lookup(e[1]);if(o!=null)return typeof o=="number"&&i===ge.escape?String(o):i(o)};he.prototype.rawValue=function(e){return e[1]};he.prototype.getConfigTags=function(e){return Pt(e)?e:e&&typeof e=="object"?e.tags:void 0};he.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Pt(e))return e.escape};var ge={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(t){zt.templateCache=t},get templateCache(){return zt.templateCache}},zt=new he;ge.clearCache=function(){return zt.clearCache()};ge.parse=function(e,r){return zt.parse(e,r)};ge.render=function(e,r,n,i){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+Rs(e)+'" was given as the first argument for mustache#render(template, view, partials)');return zt.render(e,r,n,i)};ge.escape=Fs;ge.Scanner=Kt;ge.Context=Tt;ge.Writer=he;class Hs{constructor(e,r){this.template=e,this.state=r,this.ast=ge.parse(e)}getValue(){return this.value===void 0&&(this.value=ge.render(this.template,this.state)),this.value}onChange(e){const r=[];for(const n of this.getUsedVariables().values())r.push(this.state.onVariableChange(n).subscribe(()=>{const i=ge.render(this.template,this.state);i!==this.value&&(this.value=i,e(this.value))}));return{unsubscribe:()=>{for(const n of r)n.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const e=new Set;return this.recursiveGetUsedVariables(this.ast,e),e}recursiveGetUsedVariables(e,r){for(const n of e){const i=n[0],o=n[1],s=n[4];["name","&","#","^"].includes(i)&&r.add(o),s!==void 0&&typeof s!="string"&&this.recursiveGetUsedVariables(s,r)}}}async function Ks(){var t;const e=await Cr();for(const[r,n]of e.entries()){const i=(t=n.properties)!==null&&t!==void 0?t:[];for(const o of i){if(o.type==="int"||o.type==="bool"||o.type==="object"||typeof o.value!="string")continue;const s=new Hs(o.value,WA.state);if(s.isPureString())continue;const a=s.getValue();hi(r,o.name,a),s.onChange(f=>{hi(r,o.name,f)})}}}function hi(t,e,r){WA.room.setProperty(t,e,r),e==="visible"&&(r?WA.room.showLayer(t):WA.room.hideLayer(t))}let yn,In=0,xn=0;function pi(t){if(WA.state[t.name]){let e=t.properties.mustGetString("openLayer");for(const r of e.split(`
`))WA.room.showLayer(r);e=t.properties.mustGetString("closeLayer");for(const r of e.split(`
`))WA.room.hideLayer(r)}else{let e=t.properties.mustGetString("openLayer");for(const r of e.split(`
`))WA.room.hideLayer(r);e=t.properties.mustGetString("closeLayer");for(const r of e.split(`
`))WA.room.showLayer(r)}}function Gs(t){const e=t.properties.getString("openSound"),r=t.properties.getNumber("soundRadius");let n=1;if(r){const i=Xi(t.properties.mustGetString("openLayer").split(`
`));if(i>r)return;n=1-i/r}e&&WA.sound.loadSound(e).play({volume:n})}function Qs(t){const e=t.properties.getString("closeSound"),r=t.properties.getNumber("soundRadius");let n=1;if(r){const i=Xi(t.properties.mustGetString("closeLayer").split(`
`));if(i>r)return;n=1-i/r}e&&WA.sound.loadSound(e).play({volume:n})}function Yi(t){return t.map(e=>yn.get(e)).filter(e=>(e==null?void 0:e.type)==="tilelayer")}function Xi(t){const e=Yi(t),r=Qi(e),n=((r.right-r.left)/2+r.left)*32,i=((r.bottom-r.top)/2+r.top)*32;return Math.sqrt(Math.pow(In-n,2)+Math.pow(xn-i,2))}function Ys(t){WA.state.onVariableChange(t.name).subscribe(()=>{WA.state[t.name]?Gs(t):Qs(t),pi(t)}),pi(t)}function Xs(t,e,r,n){const i=t.name;let o,s,a=!1;const f=r.getString("tag");let l=!0;f&&!WA.player.tags.includes(f)&&(l=!1);const d=!!f;function p(){var _;o&&o.remove(),o=WA.ui.displayActionMessage({message:(_=r.getString("closeTriggerMessage"))!==null&&_!==void 0?_:"Press SPACE to close the door",callback:()=>{WA.state[e.name]=!1,y()}})}function y(){var _;o&&o.remove(),o=WA.ui.displayActionMessage({message:(_=r.getString("openTriggerMessage"))!==null&&_!==void 0?_:"Press SPACE to open the door",callback:()=>{WA.state[e.name]=!0,p()}})}function w(_){const C=Qi(Yi(e.properties.mustGetString("closeLayer").split(`
`)));s=WA.room.website.create({name:"doorKeypad"+_,url:n+"/keypad.html#"+encodeURIComponent(_),position:{x:C.right*32,y:C.top*32,width:32*3,height:32*4},allowApi:!0})}function S(){s&&(WA.room.website.delete(s.name),s=void 0)}WA.room.onEnterLayer(i).subscribe(()=>{if(a=!0,r.getBoolean("autoOpen")&&l){WA.state[e.name]=!0;return}if(!WA.state[e.name]&&(d&&!l||!d)&&(r.getString("code")||r.getString("codeVariable"))){w(i);return}!l||(WA.state[e.name]?p():y())}),WA.room.onLeaveLayer(i).subscribe(()=>{a=!1,r.getBoolean("autoClose")&&(WA.state[e.name]=!1),o&&o.remove(),S()}),WA.state.onVariableChange(e.name).subscribe(()=>{a&&(!r.getBoolean("autoClose")&&WA.state[e.name]===!0&&p(),s&&WA.state[e.name]===!0&&S(),!r.getBoolean("autoOpen")&&WA.state[e.name]===!1&&y())})}function Zs(t){const e=t.properties.mustGetString("bellSound"),r=t.properties.getNumber("soundRadius");let n=1;if(r){const i=Math.sqrt(Math.pow(t.x-In,2)+Math.pow(t.y-xn,2));if(i>r)return;n=1-i/r}WA.sound.loadSound(e).play({volume:n})}function Js(t){WA.state[t.name]===void 0&&(WA.state[t.name]=0),WA.state.onVariableChange(t.name).subscribe(()=>{WA.state[t.name]&&Zs(t)})}function ea(t,e,r){let n;const i=e.getString("bellPopup");WA.room.onEnterLayer(r).subscribe(()=>{var o;i?n=WA.ui.openPopup(i,"",[{label:(o=e.getString("bellButtonText"))!==null&&o!==void 0?o:"Ring",callback:()=>{WA.state[t]=WA.state[t]+1}}]):WA.state[t]=WA.state[t]+1}),WA.room.onLeaveLayer(r).subscribe(()=>{n&&(n.close(),n=void 0)})}async function ta(t){t=t!=null?t:Tr;const e=await As();yn=await Cr();for(const r of e.values())r.properties.get("door")&&Ys(r),r.properties.get("bell")&&Js(r);for(const r of yn.values()){const n=new $t(r.properties),i=n.getString("doorVariable");if(i&&r.type==="tilelayer"){const s=e.get(i);if(s===void 0)throw new Error('Cannot find variable "'+i+'" referred in the "doorVariable" property of layer "'+r.name+'"');Xs(r,s,n,t)}const o=n.getString("bellVariable");o&&ea(o,n,r.name)}WA.player.onPlayerMove(r=>{In=r.x,xn=r.y})}function ra(t,e){const r=t.getString("bindVariable");if(r){const n=t.get("enterValue"),i=t.get("leaveValue"),o=t.getString("triggerMessage"),s=t.getString("tag");na(r,e,n,i,o,s)}}function na(t,e,r,n,i,o){o&&!WA.player.tags.includes(o)||(r!==void 0&&WA.room.onEnterLayer(e).subscribe(()=>{i||(WA.state[t]=r)}),n!==void 0&&WA.room.onLeaveLayer(e).subscribe(()=>{WA.state[t]=n}))}async function ia(){const t=await Cr();for(const e of t.values()){const r=new $t(e.properties);ra(r,e.name)}}let di;async function oa(t){const e=await WA.room.getTiledMap();t=t!=null?t:Tr,di=await Cr();const r=e.layers.find(n=>n.name==="configuration");if(r){const i=new $t(r.properties).getString("tag");(!i||WA.player.tags.includes(i))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(t+"/configuration.html",!0)});for(const o of di.values()){const s=new $t(o.properties),a=s.getString("openConfig");a&&o.type==="tilelayer"&&sa(a.split(","),o.name,s)}}}function sa(t,e,r){let n;const i=r.getString("openConfigAdminTag");let o=!0;i&&!WA.player.tags.includes(i)&&(o=!1);function s(){var f;n&&n.remove(),n=WA.ui.displayActionMessage({message:(f=r.getString("openConfigTriggerMessage"))!==null&&f!==void 0?f:"Press SPACE or touch here to configure",callback:()=>fi(t)})}function a(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(e).subscribe(()=>{const f=r.getString("openConfigTrigger");o&&(f&&f==="onaction"?s():fi(t))}),WA.room.onLeaveLayer(e).subscribe(()=>{n&&n.remove(),a()})}const aa=[{lowerBound:0,uppperBound:.5,config:{width:250,height:390,scale:1}},{lowerBound:.5,uppperBound:.8,config:{width:224,height:350,scale:.9}},{lowerBound:.8,uppperBound:1.25,config:{width:132,height:211,scale:.53}},{lowerBound:1.25,uppperBound:2.28,config:{width:64,height:99,scale:.25}},{lowerBound:1.25,config:{width:39,height:63,scale:.16}}],la=[{lowerBound:0,uppperBound:1,config:{width:427,height:270,scale:1}},{lowerBound:1,uppperBound:1.9,config:{width:300,height:188,scale:.7}},{lowerBound:1.9,uppperBound:3.5,config:{width:150,height:94,scale:.35}},{lowerBound:3.5,uppperBound:5,config:{width:93,height:58,scale:.21}},{lowerBound:4,config:{width:75,height:46,scale:.17}}];async function fa(){var t;const e=WA.player.state.tutorialDone,r=/Mobi|Android/i.test(navigator.userAgent),i=await((t=(await WA.room.getTiledMap()).properties)===null||t===void 0?void 0:t.find(s=>s.name==="tutorial")),o=i&&i.value;if(!e&&o){ua(r);let s=await WA.player.getPosition(),a;const f=await WA.room.website.get("tutorial"),l=()=>{const S=s.x+f.x+f.width>a.x+a.width,_=s.x+f.x<a.x,C=s.y+f.y+f.height>a.y+a.height,x=s.y+f.y<a.y;S?f.x=-f.width-1.5*16:_&&(f.x=1.5*16),C?f.y=-f.height:x&&(f.y=16)},d=w=>{f.width=w.width,f.height=w.height,f.scale=w.scale},p=w=>{const _=(r?aa:la).filter(C=>{if(C.lowerBound&&C.uppperBound)return C.lowerBound<w&&w<=C.uppperBound;if(C.lowerBound&&!C.uppperBound)return C.lowerBound<w;if(!C.lowerBound&&C.uppperBound)return w<=C.uppperBound;throw new Error(`Zoom level of: ${w} could not fit in any of the desktopConfig's ranges.`)});d(_[0].config)},y=()=>{if(a===void 0)return;const w=a.zoom;p(w),l()};WA.player.onPlayerMove(w=>{s=w,y()}),WA.camera.onCameraUpdate().subscribe(w=>{a=w,y()}),WA.player.state.tutorialDone=!0}}function ua(t){let e={allow:"",name:"tutorial",url:Tr+"/tutorial.html",position:{height:224,width:407,x:16,y:-112},visible:!0,allowApi:!0,origin:"player",scale:.9};t&&(e=Lt(Ot({},e),{position:{x:32,y:-225,height:390,width:250},scale:1})),WA.room.website.create(e)}function ca(){return WA.onInit().then(()=>{ta().catch(t=>console.error(t)),ia().catch(t=>console.error(t)),oa().catch(t=>console.error(t)),Ks().catch(t=>console.error(t)),fa().catch(t=>console.error(t))}).catch(t=>console.error(t))}var xe=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof{}!="undefined"?{}:typeof self!="undefined"?self:{};function Bn(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach(function(r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}),e}var gr={},ze={};Object.defineProperty(ze,"__esModule",{value:!0});ze.createEvent=void 0;function ha(t,e){return{topic:t,payload:typeof e=="string"?e:JSON.stringify(e)}}ze.createEvent=ha;var Me={},Ce={};Object.defineProperty(Ce,"__esModule",{value:!0});Ce.TOPIC_LEVEL_SEPARATOR=Ce.SERVICE_TOPIC=Ce.SHARED_TOPIC=Ce.TOPIC_ROOT=void 0;Ce.TOPIC_ROOT="platform-mock";Ce.SHARED_TOPIC="shared";Ce.SERVICE_TOPIC="services";Ce.TOPIC_LEVEL_SEPARATOR="/";var Ar={};Object.defineProperty(Ar,"__esModule",{value:!0});Ar.TopicType=void 0;var gi=Ce;Ar.TopicType=Object.freeze({SHARED:gi.SHARED_TOPIC,SERVICE_SPECIFIC:gi.SERVICE_TOPIC});var Rn=xe&&xe.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n};Object.defineProperty(Me,"__esModule",{value:!0});Me.nameForServiceSpecificTopic=Me.nameForSharedTopic=void 0;var Zi=Ce,Ji=Ar;function pa(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.join(Zi.TOPIC_LEVEL_SEPARATOR)}function eo(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return pa.apply(void 0,Rn([Zi.TOPIC_ROOT,t,e],r))}function da(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return eo.apply(void 0,Rn([Ji.TopicType.SHARED,t],e))}Me.nameForSharedTopic=da;function ga(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return eo.apply(void 0,Rn([Ji.TopicType.SERVICE_SPECIFIC,t],e))}Me.nameForServiceSpecificTopic=ga;var q={},fe=xe&&xe.__assign||function(){return fe=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},fe.apply(this,arguments)};Object.defineProperty(q,"__esModule",{value:!0});q.doorbell=q.mailbox=q.misc=q.socket=q.gate=q.blind=q.presence=q.electricity=q.balconyDoor=q.unitDoor=q.window=q.radiation=q.lighting=q.indoorClimate=void 0;var ya=ze,va=Me,ue;(function(t){t.INDOOR_CLIMATE="indoor-climate",t.LIGHTING="lighting",t.RADIATION="radiation",t.WINDOW="window",t.UNIT_DOOR="unit-door",t.BALCONY_DOOR="balcony-door",t.ELECTRICITY="electricity",t.PRESENCE="presence",t.BLIND="blind",t.GATE="gate",t.SOCKET="socket",t.MISC="misc",t.MAILBOX="mailbox",t.DOORBELL="doorbell"})(ue||(ue={}));var ba="smart-home",pt=new RegExp("^[a-z0-9-.]+$");function wa(t,e,r,n,i,o){return ye(t,e,r,n,i,ue.INDOOR_CLIMATE,fe({},o))}q.indoorClimate=wa;function ma(t){return t>=0&&t<=255}function _a(t){if(t.length!==4)return!1;for(var e=0;e<4;e++)if(!ma(t[e]))return!1;return!0}function Ea(t,e,r,n,i,o){var s=o.color;if(s!==void 0&&!_a(s))throw"invalid color";return ye(t,e,r,n,i,ue.LIGHTING,fe({},o))}q.lighting=Ea;function Sa(t,e,r,n,i,o){return ye(t,e,r,n,i,ue.RADIATION,fe({},o))}q.radiation=Sa;function Ta(t,e,r,n,i,o){return ye(t,e,r,n,i,ue.WINDOW,fe({},o))}q.window=Ta;function Ca(t,e,r,n,i,o){return ye(t,e,r,n,i,ue.UNIT_DOOR,fe({},o))}q.unitDoor=Ca;function Aa(t,e,r,n,i,o){return ye(t,e,r,n,i,ue.BALCONY_DOOR,fe({},o))}q.balconyDoor=Aa;function ka(t,e,r,n,i,o){return ye(t,e,r,n,i,ue.ELECTRICITY,fe({},o))}q.electricity=ka;function Ia(t,e,r,n,i,o){return ye(t,e,r,n,i,ue.PRESENCE,fe({},o))}q.presence=Ia;function xa(t,e,r,n,i,o){return ye(t,e,r,n,i,ue.BLIND,fe({},o))}q.blind=xa;function Ba(t,e,r,n,i,o){return ye(t,e,r,n,i,ue.GATE,fe({},o))}q.gate=Ba;function Ra(t,e,r,n,i,o){return ye(t,e,r,n,i,ue.SOCKET,fe({},o))}q.socket=Ra;function Pa(t,e,r,n,i,o){return ye(t,e,r,n,i,ue.MISC,fe({},o))}q.misc=Pa;function Ma(t,e,r,n,i,o){return ye(t,e,r,n,i,ue.MAILBOX,fe({},o))}q.mailbox=Ma;function Oa(t,e,r,n,i,o){return ye(t,e,r,n,i,ue.DOORBELL,fe({},o))}q.doorbell=Oa;function ye(t,e,r,n,i,o,s){if(!t.match(pt))throw"Invalid house_identifier";if(!e.match(pt))throw"Invalid floor_identifier";if(!r.match(pt))throw"Invalid unit_identifier";if(!n.match(pt))throw"Invalid room_identifier";if(!i.match(pt))throw"Invalid device_identifier";if(o===void 0||!o.match(pt))throw"Invalid category";if(s===void 0)throw"invalid payload";return ya.createEvent(va.nameForSharedTopic(ba,t,e,r,n,o,i),s)}var qe={};Object.defineProperty(qe,"__esModule",{value:!0});qe.alivePing=qe.goodbyePlatform=qe.helloPlatform=void 0;var Pn=ze,Mn=Me,On="platform-events",La=Mn.nameForSharedTopic(On,"hello-platform"),Da=Mn.nameForSharedTopic(On,"goodbye-platform"),Ua=Mn.nameForSharedTopic(On,"alive-ping");function Fa(t,e){return Pn.createEvent(La,{name:t,description:e})}qe.helloPlatform=Fa;function Na(t){return Pn.createEvent(Da,{name:t})}qe.goodbyePlatform=Na;function ja(t){return Pn.createEvent(Ua,{name:t})}qe.alivePing=ja;var Pe={};Object.defineProperty(Pe,"__esModule",{value:!0});Pe.dateToIsoString=Pe.appointmentDeleted=Pe.appointmentUpdated=Pe.appointmentCreated=void 0;var Ln=ze,Dn=Me,Un="appointments",qa=Dn.nameForSharedTopic(Un,"appointment-created"),Wa=Dn.nameForSharedTopic(Un,"appointment-updated"),$a=Dn.nameForSharedTopic(Un,"appointment-deleted");function za(t){return Ln.createEvent(qa,t)}Pe.appointmentCreated=za;function Va(t){return Ln.createEvent(Wa,t)}Pe.appointmentUpdated=Va;function Ha(t){return Ln.createEvent($a,t)}Pe.appointmentDeleted=Ha;function Ka(t){return t.toISOString()}Pe.dateToIsoString=Ka;var Ct={};Object.defineProperty(Ct,"__esModule",{value:!0});Ct.dateToIsoString=Ct.hint=void 0;var Ga=ze,Qa=Me,Ya="hints",Xa=Qa.nameForSharedTopic(Ya);function Za(t){return Ga.createEvent(Xa,t)}Ct.hint=Za;function Ja(t){return t.toISOString()}Ct.dateToIsoString=Ja;var kr={},nr,el=new Uint8Array(16);function to(){if(!nr&&(nr=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!nr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return nr(el)}var tl=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Ir(t){return typeof t=="string"&&tl.test(t)}var Z=[];for(var Gr=0;Gr<256;++Gr)Z.push((Gr+256).toString(16).substr(1));function xr(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(Z[t[e+0]]+Z[t[e+1]]+Z[t[e+2]]+Z[t[e+3]]+"-"+Z[t[e+4]]+Z[t[e+5]]+"-"+Z[t[e+6]]+Z[t[e+7]]+"-"+Z[t[e+8]]+Z[t[e+9]]+"-"+Z[t[e+10]]+Z[t[e+11]]+Z[t[e+12]]+Z[t[e+13]]+Z[t[e+14]]+Z[t[e+15]]).toLowerCase();if(!Ir(r))throw TypeError("Stringified UUID is invalid");return r}var yi,Qr,Yr=0,Xr=0;function rl(t,e,r){var n=e&&r||0,i=e||new Array(16);t=t||{};var o=t.node||yi,s=t.clockseq!==void 0?t.clockseq:Qr;if(o==null||s==null){var a=t.random||(t.rng||to)();o==null&&(o=yi=[a[0]|1,a[1],a[2],a[3],a[4],a[5]]),s==null&&(s=Qr=(a[6]<<8|a[7])&16383)}var f=t.msecs!==void 0?t.msecs:Date.now(),l=t.nsecs!==void 0?t.nsecs:Xr+1,d=f-Yr+(l-Xr)/1e4;if(d<0&&t.clockseq===void 0&&(s=s+1&16383),(d<0||f>Yr)&&t.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Yr=f,Xr=l,Qr=s,f+=122192928e5;var p=((f&268435455)*1e4+l)%4294967296;i[n++]=p>>>24&255,i[n++]=p>>>16&255,i[n++]=p>>>8&255,i[n++]=p&255;var y=f/4294967296*1e4&268435455;i[n++]=y>>>8&255,i[n++]=y&255,i[n++]=y>>>24&15|16,i[n++]=y>>>16&255,i[n++]=s>>>8|128,i[n++]=s&255;for(var w=0;w<6;++w)i[n+w]=o[w];return e||xr(i)}function ro(t){if(!Ir(t))throw TypeError("Invalid UUID");var e,r=new Uint8Array(16);return r[0]=(e=parseInt(t.slice(0,8),16))>>>24,r[1]=e>>>16&255,r[2]=e>>>8&255,r[3]=e&255,r[4]=(e=parseInt(t.slice(9,13),16))>>>8,r[5]=e&255,r[6]=(e=parseInt(t.slice(14,18),16))>>>8,r[7]=e&255,r[8]=(e=parseInt(t.slice(19,23),16))>>>8,r[9]=e&255,r[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,r[11]=e/4294967296&255,r[12]=e>>>24&255,r[13]=e>>>16&255,r[14]=e>>>8&255,r[15]=e&255,r}function nl(t){t=unescape(encodeURIComponent(t));for(var e=[],r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e}var il="6ba7b810-9dad-11d1-80b4-00c04fd430c8",ol="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function no(t,e,r){function n(i,o,s,a){if(typeof i=="string"&&(i=nl(i)),typeof o=="string"&&(o=ro(o)),o.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var f=new Uint8Array(16+i.length);if(f.set(o),f.set(i,o.length),f=r(f),f[6]=f[6]&15|e,f[8]=f[8]&63|128,s){a=a||0;for(var l=0;l<16;++l)s[a+l]=f[l];return s}return xr(f)}try{n.name=t}catch{}return n.DNS=il,n.URL=ol,n}function sl(t){if(typeof t=="string"){var e=unescape(encodeURIComponent(t));t=new Uint8Array(e.length);for(var r=0;r<e.length;++r)t[r]=e.charCodeAt(r)}return al(ll(fl(t),t.length*8))}function al(t){for(var e=[],r=t.length*32,n="0123456789abcdef",i=0;i<r;i+=8){var o=t[i>>5]>>>i%32&255,s=parseInt(n.charAt(o>>>4&15)+n.charAt(o&15),16);e.push(s)}return e}function io(t){return(t+64>>>9<<4)+14+1}function ll(t,e){t[e>>5]|=128<<e%32,t[io(e)-1]=e;for(var r=1732584193,n=-271733879,i=-1732584194,o=271733878,s=0;s<t.length;s+=16){var a=r,f=n,l=i,d=o;r=ie(r,n,i,o,t[s],7,-680876936),o=ie(o,r,n,i,t[s+1],12,-389564586),i=ie(i,o,r,n,t[s+2],17,606105819),n=ie(n,i,o,r,t[s+3],22,-1044525330),r=ie(r,n,i,o,t[s+4],7,-176418897),o=ie(o,r,n,i,t[s+5],12,1200080426),i=ie(i,o,r,n,t[s+6],17,-1473231341),n=ie(n,i,o,r,t[s+7],22,-45705983),r=ie(r,n,i,o,t[s+8],7,1770035416),o=ie(o,r,n,i,t[s+9],12,-1958414417),i=ie(i,o,r,n,t[s+10],17,-42063),n=ie(n,i,o,r,t[s+11],22,-1990404162),r=ie(r,n,i,o,t[s+12],7,1804603682),o=ie(o,r,n,i,t[s+13],12,-40341101),i=ie(i,o,r,n,t[s+14],17,-1502002290),n=ie(n,i,o,r,t[s+15],22,1236535329),r=oe(r,n,i,o,t[s+1],5,-165796510),o=oe(o,r,n,i,t[s+6],9,-1069501632),i=oe(i,o,r,n,t[s+11],14,643717713),n=oe(n,i,o,r,t[s],20,-373897302),r=oe(r,n,i,o,t[s+5],5,-701558691),o=oe(o,r,n,i,t[s+10],9,38016083),i=oe(i,o,r,n,t[s+15],14,-660478335),n=oe(n,i,o,r,t[s+4],20,-405537848),r=oe(r,n,i,o,t[s+9],5,568446438),o=oe(o,r,n,i,t[s+14],9,-1019803690),i=oe(i,o,r,n,t[s+3],14,-187363961),n=oe(n,i,o,r,t[s+8],20,1163531501),r=oe(r,n,i,o,t[s+13],5,-1444681467),o=oe(o,r,n,i,t[s+2],9,-51403784),i=oe(i,o,r,n,t[s+7],14,1735328473),n=oe(n,i,o,r,t[s+12],20,-1926607734),r=se(r,n,i,o,t[s+5],4,-378558),o=se(o,r,n,i,t[s+8],11,-2022574463),i=se(i,o,r,n,t[s+11],16,1839030562),n=se(n,i,o,r,t[s+14],23,-35309556),r=se(r,n,i,o,t[s+1],4,-1530992060),o=se(o,r,n,i,t[s+4],11,1272893353),i=se(i,o,r,n,t[s+7],16,-155497632),n=se(n,i,o,r,t[s+10],23,-1094730640),r=se(r,n,i,o,t[s+13],4,681279174),o=se(o,r,n,i,t[s],11,-358537222),i=se(i,o,r,n,t[s+3],16,-722521979),n=se(n,i,o,r,t[s+6],23,76029189),r=se(r,n,i,o,t[s+9],4,-640364487),o=se(o,r,n,i,t[s+12],11,-421815835),i=se(i,o,r,n,t[s+15],16,530742520),n=se(n,i,o,r,t[s+2],23,-995338651),r=ae(r,n,i,o,t[s],6,-198630844),o=ae(o,r,n,i,t[s+7],10,1126891415),i=ae(i,o,r,n,t[s+14],15,-1416354905),n=ae(n,i,o,r,t[s+5],21,-57434055),r=ae(r,n,i,o,t[s+12],6,1700485571),o=ae(o,r,n,i,t[s+3],10,-1894986606),i=ae(i,o,r,n,t[s+10],15,-1051523),n=ae(n,i,o,r,t[s+1],21,-2054922799),r=ae(r,n,i,o,t[s+8],6,1873313359),o=ae(o,r,n,i,t[s+15],10,-30611744),i=ae(i,o,r,n,t[s+6],15,-1560198380),n=ae(n,i,o,r,t[s+13],21,1309151649),r=ae(r,n,i,o,t[s+4],6,-145523070),o=ae(o,r,n,i,t[s+11],10,-1120210379),i=ae(i,o,r,n,t[s+2],15,718787259),n=ae(n,i,o,r,t[s+9],21,-343485551),r=Qe(r,a),n=Qe(n,f),i=Qe(i,l),o=Qe(o,d)}return[r,n,i,o]}function fl(t){if(t.length===0)return[];for(var e=t.length*8,r=new Uint32Array(io(e)),n=0;n<e;n+=8)r[n>>5]|=(t[n/8]&255)<<n%32;return r}function Qe(t,e){var r=(t&65535)+(e&65535),n=(t>>16)+(e>>16)+(r>>16);return n<<16|r&65535}function ul(t,e){return t<<e|t>>>32-e}function Br(t,e,r,n,i,o){return Qe(ul(Qe(Qe(e,t),Qe(n,o)),i),r)}function ie(t,e,r,n,i,o,s){return Br(e&r|~e&n,t,e,i,o,s)}function oe(t,e,r,n,i,o,s){return Br(e&n|r&~n,t,e,i,o,s)}function se(t,e,r,n,i,o,s){return Br(e^r^n,t,e,i,o,s)}function ae(t,e,r,n,i,o,s){return Br(r^(e|~n),t,e,i,o,s)}var cl=no("v3",48,sl),hl=cl;function pl(t,e,r){t=t||{};var n=t.random||(t.rng||to)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(var i=0;i<16;++i)e[r+i]=n[i];return e}return xr(n)}function dl(t,e,r,n){switch(t){case 0:return e&r^~e&n;case 1:return e^r^n;case 2:return e&r^e&n^r&n;case 3:return e^r^n}}function Zr(t,e){return t<<e|t>>>32-e}function gl(t){var e=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof t=="string"){var n=unescape(encodeURIComponent(t));t=[];for(var i=0;i<n.length;++i)t.push(n.charCodeAt(i))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var o=t.length/4+2,s=Math.ceil(o/16),a=new Array(s),f=0;f<s;++f){for(var l=new Uint32Array(16),d=0;d<16;++d)l[d]=t[f*64+d*4]<<24|t[f*64+d*4+1]<<16|t[f*64+d*4+2]<<8|t[f*64+d*4+3];a[f]=l}a[s-1][14]=(t.length-1)*8/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=(t.length-1)*8&4294967295;for(var p=0;p<s;++p){for(var y=new Uint32Array(80),w=0;w<16;++w)y[w]=a[p][w];for(var S=16;S<80;++S)y[S]=Zr(y[S-3]^y[S-8]^y[S-14]^y[S-16],1);for(var _=r[0],C=r[1],x=r[2],h=r[3],g=r[4],m=0;m<80;++m){var A=Math.floor(m/20),R=Zr(_,5)+dl(A,C,x,h)+g+e[A]+y[m]>>>0;g=h,h=x,x=Zr(C,30)>>>0,C=_,_=R}r[0]=r[0]+_>>>0,r[1]=r[1]+C>>>0,r[2]=r[2]+x>>>0,r[3]=r[3]+h>>>0,r[4]=r[4]+g>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,r[0]&255,r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,r[1]&255,r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,r[2]&255,r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,r[3]&255,r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,r[4]&255]}var yl=no("v5",80,gl),vl=yl,bl="00000000-0000-0000-0000-000000000000";function wl(t){if(!Ir(t))throw TypeError("Invalid UUID");return parseInt(t.substr(14,1),16)}var ml=Object.freeze(Object.defineProperty({__proto__:null,v1:rl,v3:hl,v4:pl,v5:vl,NIL:bl,version:wl,validate:Ir,stringify:xr,parse:ro},Symbol.toStringTag,{value:"Module"})),_l=Bn(ml),Rr={},Gt={exports:{}},El={},Sl=Object.freeze(Object.defineProperty({__proto__:null,default:El},Symbol.toStringTag,{value:"Module"})),ke=Bn(Sl),Fn=Cl,Tl=Object.prototype.hasOwnProperty;function Cl(){for(var t={},e=0;e<arguments.length;e++){var r=arguments[e];for(var n in r)Tl.call(r,n)&&(t[n]=r[n])}return t}var We={exports:{}},oo=ke.EventEmitter,Ve={},Pr={};Pr.byteLength=Il;Pr.toByteArray=Bl;Pr.fromByteArray=Ml;var Be=[],be=[],Al=typeof Uint8Array!="undefined"?Uint8Array:Array,Jr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var dt=0,kl=Jr.length;dt<kl;++dt)Be[dt]=Jr[dt],be[Jr.charCodeAt(dt)]=dt;be["-".charCodeAt(0)]=62;be["_".charCodeAt(0)]=63;function so(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function Il(t){var e=so(t),r=e[0],n=e[1];return(r+n)*3/4-n}function xl(t,e,r){return(e+r)*3/4-r}function Bl(t){var e,r=so(t),n=r[0],i=r[1],o=new Al(xl(t,n,i)),s=0,a=i>0?n-4:n,f;for(f=0;f<a;f+=4)e=be[t.charCodeAt(f)]<<18|be[t.charCodeAt(f+1)]<<12|be[t.charCodeAt(f+2)]<<6|be[t.charCodeAt(f+3)],o[s++]=e>>16&255,o[s++]=e>>8&255,o[s++]=e&255;return i===2&&(e=be[t.charCodeAt(f)]<<2|be[t.charCodeAt(f+1)]>>4,o[s++]=e&255),i===1&&(e=be[t.charCodeAt(f)]<<10|be[t.charCodeAt(f+1)]<<4|be[t.charCodeAt(f+2)]>>2,o[s++]=e>>8&255,o[s++]=e&255),o}function Rl(t){return Be[t>>18&63]+Be[t>>12&63]+Be[t>>6&63]+Be[t&63]}function Pl(t,e,r){for(var n,i=[],o=e;o<r;o+=3)n=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(t[o+2]&255),i.push(Rl(n));return i.join("")}function Ml(t){for(var e,r=t.length,n=r%3,i=[],o=16383,s=0,a=r-n;s<a;s+=o)i.push(Pl(t,s,s+o>a?a:s+o));return n===1?(e=t[r-1],i.push(Be[e>>2]+Be[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],i.push(Be[e>>10]+Be[e>>4&63]+Be[e<<2&63]+"=")),i.join("")}var Nn={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Nn.read=function(t,e,r,n,i){var o,s,a=i*8-n-1,f=(1<<a)-1,l=f>>1,d=-7,p=r?i-1:0,y=r?-1:1,w=t[e+p];for(p+=y,o=w&(1<<-d)-1,w>>=-d,d+=a;d>0;o=o*256+t[e+p],p+=y,d-=8);for(s=o&(1<<-d)-1,o>>=-d,d+=n;d>0;s=s*256+t[e+p],p+=y,d-=8);if(o===0)o=1-l;else{if(o===f)return s?NaN:(w?-1:1)*(1/0);s=s+Math.pow(2,n),o=o-l}return(w?-1:1)*s*Math.pow(2,o-n)};Nn.write=function(t,e,r,n,i,o){var s,a,f,l=o*8-i-1,d=(1<<l)-1,p=d>>1,y=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,w=n?0:o-1,S=n?1:-1,_=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=d):(s=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-s))<1&&(s--,f*=2),s+p>=1?e+=y/f:e+=y*Math.pow(2,1-p),e*f>=2&&(s++,f/=2),s+p>=d?(a=0,s=d):s+p>=1?(a=(e*f-1)*Math.pow(2,i),s=s+p):(a=e*Math.pow(2,p-1)*Math.pow(2,i),s=0));i>=8;t[r+w]=a&255,w+=S,a/=256,i-=8);for(s=s<<i|a,l+=i;l>0;t[r+w]=s&255,w+=S,s/=256,l-=8);t[r+w-S]|=_*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){var e=Pr,r=Nn,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=a,t.SlowBuffer=h,t.INSPECT_MAX_BYTES=50;var i=2147483647;t.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=o(),!a.TYPED_ARRAY_SUPPORT&&typeof console!="undefined"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function o(){try{var v=new Uint8Array(1),u={foo:function(){return 42}};return Object.setPrototypeOf(u,Uint8Array.prototype),Object.setPrototypeOf(v,u),v.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(!!a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(!!a.isBuffer(this))return this.byteOffset}});function s(v){if(v>i)throw new RangeError('The value "'+v+'" is invalid for option "size"');var u=new Uint8Array(v);return Object.setPrototypeOf(u,a.prototype),u}function a(v,u,c){if(typeof v=="number"){if(typeof u=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(v)}return f(v,u,c)}a.poolSize=8192;function f(v,u,c){if(typeof v=="string")return y(v,u);if(ArrayBuffer.isView(v))return S(v);if(v==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof v);if(Ie(v,ArrayBuffer)||v&&Ie(v.buffer,ArrayBuffer)||typeof SharedArrayBuffer!="undefined"&&(Ie(v,SharedArrayBuffer)||v&&Ie(v.buffer,SharedArrayBuffer)))return _(v,u,c);if(typeof v=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var b=v.valueOf&&v.valueOf();if(b!=null&&b!==v)return a.from(b,u,c);var E=C(v);if(E)return E;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof v[Symbol.toPrimitive]=="function")return a.from(v[Symbol.toPrimitive]("string"),u,c);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof v)}a.from=function(v,u,c){return f(v,u,c)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function l(v){if(typeof v!="number")throw new TypeError('"size" argument must be of type number');if(v<0)throw new RangeError('The value "'+v+'" is invalid for option "size"')}function d(v,u,c){return l(v),v<=0?s(v):u!==void 0?typeof c=="string"?s(v).fill(u,c):s(v).fill(u):s(v)}a.alloc=function(v,u,c){return d(v,u,c)};function p(v){return l(v),s(v<0?0:x(v)|0)}a.allocUnsafe=function(v){return p(v)},a.allocUnsafeSlow=function(v){return p(v)};function y(v,u){if((typeof u!="string"||u==="")&&(u="utf8"),!a.isEncoding(u))throw new TypeError("Unknown encoding: "+u);var c=g(v,u)|0,b=s(c),E=b.write(v,u);return E!==c&&(b=b.slice(0,E)),b}function w(v){for(var u=v.length<0?0:x(v.length)|0,c=s(u),b=0;b<u;b+=1)c[b]=v[b]&255;return c}function S(v){if(Ie(v,Uint8Array)){var u=new Uint8Array(v);return _(u.buffer,u.byteOffset,u.byteLength)}return w(v)}function _(v,u,c){if(u<0||v.byteLength<u)throw new RangeError('"offset" is outside of buffer bounds');if(v.byteLength<u+(c||0))throw new RangeError('"length" is outside of buffer bounds');var b;return u===void 0&&c===void 0?b=new Uint8Array(v):c===void 0?b=new Uint8Array(v,u):b=new Uint8Array(v,u,c),Object.setPrototypeOf(b,a.prototype),b}function C(v){if(a.isBuffer(v)){var u=x(v.length)|0,c=s(u);return c.length===0||v.copy(c,0,0,u),c}if(v.length!==void 0)return typeof v.length!="number"||Vr(v.length)?s(0):w(v);if(v.type==="Buffer"&&Array.isArray(v.data))return w(v.data)}function x(v){if(v>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return v|0}function h(v){return+v!=v&&(v=0),a.alloc(+v)}a.isBuffer=function(u){return u!=null&&u._isBuffer===!0&&u!==a.prototype},a.compare=function(u,c){if(Ie(u,Uint8Array)&&(u=a.from(u,u.offset,u.byteLength)),Ie(c,Uint8Array)&&(c=a.from(c,c.offset,c.byteLength)),!a.isBuffer(u)||!a.isBuffer(c))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(u===c)return 0;for(var b=u.length,E=c.length,I=0,B=Math.min(b,E);I<B;++I)if(u[I]!==c[I]){b=u[I],E=c[I];break}return b<E?-1:E<b?1:0},a.isEncoding=function(u){switch(String(u).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(u,c){if(!Array.isArray(u))throw new TypeError('"list" argument must be an Array of Buffers');if(u.length===0)return a.alloc(0);var b;if(c===void 0)for(c=0,b=0;b<u.length;++b)c+=u[b].length;var E=a.allocUnsafe(c),I=0;for(b=0;b<u.length;++b){var B=u[b];if(Ie(B,Uint8Array))I+B.length>E.length?a.from(B).copy(E,I):Uint8Array.prototype.set.call(E,B,I);else if(a.isBuffer(B))B.copy(E,I);else throw new TypeError('"list" argument must be an Array of Buffers');I+=B.length}return E};function g(v,u){if(a.isBuffer(v))return v.length;if(ArrayBuffer.isView(v)||Ie(v,ArrayBuffer))return v.byteLength;if(typeof v!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof v);var c=v.length,b=arguments.length>2&&arguments[2]===!0;if(!b&&c===0)return 0;for(var E=!1;;)switch(u){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":return zr(v).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c*2;case"hex":return c>>>1;case"base64":return ii(v).length;default:if(E)return b?-1:zr(v).length;u=(""+u).toLowerCase(),E=!0}}a.byteLength=g;function m(v,u,c){var b=!1;if((u===void 0||u<0)&&(u=0),u>this.length||((c===void 0||c>this.length)&&(c=this.length),c<=0)||(c>>>=0,u>>>=0,c<=u))return"";for(v||(v="utf8");;)switch(v){case"hex":return ps(this,u,c);case"utf8":case"utf-8":return Jn(this,u,c);case"ascii":return cs(this,u,c);case"latin1":case"binary":return hs(this,u,c);case"base64":return fs(this,u,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ds(this,u,c);default:if(b)throw new TypeError("Unknown encoding: "+v);v=(v+"").toLowerCase(),b=!0}}a.prototype._isBuffer=!0;function A(v,u,c){var b=v[u];v[u]=v[c],v[c]=b}a.prototype.swap16=function(){var u=this.length;if(u%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var c=0;c<u;c+=2)A(this,c,c+1);return this},a.prototype.swap32=function(){var u=this.length;if(u%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var c=0;c<u;c+=4)A(this,c,c+3),A(this,c+1,c+2);return this},a.prototype.swap64=function(){var u=this.length;if(u%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var c=0;c<u;c+=8)A(this,c,c+7),A(this,c+1,c+6),A(this,c+2,c+5),A(this,c+3,c+4);return this},a.prototype.toString=function(){var u=this.length;return u===0?"":arguments.length===0?Jn(this,0,u):m.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(u){if(!a.isBuffer(u))throw new TypeError("Argument must be a Buffer");return this===u?!0:a.compare(this,u)===0},a.prototype.inspect=function(){var u="",c=t.INSPECT_MAX_BYTES;return u=this.toString("hex",0,c).replace(/(.{2})/g,"$1 ").trim(),this.length>c&&(u+=" ... "),"<Buffer "+u+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(u,c,b,E,I){if(Ie(u,Uint8Array)&&(u=a.from(u,u.offset,u.byteLength)),!a.isBuffer(u))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof u);if(c===void 0&&(c=0),b===void 0&&(b=u?u.length:0),E===void 0&&(E=0),I===void 0&&(I=this.length),c<0||b>u.length||E<0||I>this.length)throw new RangeError("out of range index");if(E>=I&&c>=b)return 0;if(E>=I)return-1;if(c>=b)return 1;if(c>>>=0,b>>>=0,E>>>=0,I>>>=0,this===u)return 0;for(var B=I-E,D=b-c,$=Math.min(B,D),V=this.slice(E,I),ne=u.slice(c,b),K=0;K<$;++K)if(V[K]!==ne[K]){B=V[K],D=ne[K];break}return B<D?-1:D<B?1:0};function R(v,u,c,b,E){if(v.length===0)return-1;if(typeof c=="string"?(b=c,c=0):c>2147483647?c=2147483647:c<-2147483648&&(c=-2147483648),c=+c,Vr(c)&&(c=E?0:v.length-1),c<0&&(c=v.length+c),c>=v.length){if(E)return-1;c=v.length-1}else if(c<0)if(E)c=0;else return-1;if(typeof u=="string"&&(u=a.from(u,b)),a.isBuffer(u))return u.length===0?-1:j(v,u,c,b,E);if(typeof u=="number")return u=u&255,typeof Uint8Array.prototype.indexOf=="function"?E?Uint8Array.prototype.indexOf.call(v,u,c):Uint8Array.prototype.lastIndexOf.call(v,u,c):j(v,[u],c,b,E);throw new TypeError("val must be string, number or Buffer")}function j(v,u,c,b,E){var I=1,B=v.length,D=u.length;if(b!==void 0&&(b=String(b).toLowerCase(),b==="ucs2"||b==="ucs-2"||b==="utf16le"||b==="utf-16le")){if(v.length<2||u.length<2)return-1;I=2,B/=2,D/=2,c/=2}function $(oi,si){return I===1?oi[si]:oi.readUInt16BE(si*I)}var V;if(E){var ne=-1;for(V=c;V<B;V++)if($(v,V)===$(u,ne===-1?0:V-ne)){if(ne===-1&&(ne=V),V-ne+1===D)return ne*I}else ne!==-1&&(V-=V-ne),ne=-1}else for(c+D>B&&(c=B-D),V=c;V>=0;V--){for(var K=!0,rr=0;rr<D;rr++)if($(v,V+rr)!==$(u,rr)){K=!1;break}if(K)return V}return-1}a.prototype.includes=function(u,c,b){return this.indexOf(u,c,b)!==-1},a.prototype.indexOf=function(u,c,b){return R(this,u,c,b,!0)},a.prototype.lastIndexOf=function(u,c,b){return R(this,u,c,b,!1)};function H(v,u,c,b){c=Number(c)||0;var E=v.length-c;b?(b=Number(b),b>E&&(b=E)):b=E;var I=u.length;b>I/2&&(b=I/2);for(var B=0;B<b;++B){var D=parseInt(u.substr(B*2,2),16);if(Vr(D))return B;v[c+B]=D}return B}function Ee(v,u,c,b){return tr(zr(u,v.length-c),v,c,b)}function ss(v,u,c,b){return tr(vs(u),v,c,b)}function as(v,u,c,b){return tr(ii(u),v,c,b)}function ls(v,u,c,b){return tr(bs(u,v.length-c),v,c,b)}a.prototype.write=function(u,c,b,E){if(c===void 0)E="utf8",b=this.length,c=0;else if(b===void 0&&typeof c=="string")E=c,b=this.length,c=0;else if(isFinite(c))c=c>>>0,isFinite(b)?(b=b>>>0,E===void 0&&(E="utf8")):(E=b,b=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var I=this.length-c;if((b===void 0||b>I)&&(b=I),u.length>0&&(b<0||c<0)||c>this.length)throw new RangeError("Attempt to write outside buffer bounds");E||(E="utf8");for(var B=!1;;)switch(E){case"hex":return H(this,u,c,b);case"utf8":case"utf-8":return Ee(this,u,c,b);case"ascii":case"latin1":case"binary":return ss(this,u,c,b);case"base64":return as(this,u,c,b);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ls(this,u,c,b);default:if(B)throw new TypeError("Unknown encoding: "+E);E=(""+E).toLowerCase(),B=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function fs(v,u,c){return u===0&&c===v.length?e.fromByteArray(v):e.fromByteArray(v.slice(u,c))}function Jn(v,u,c){c=Math.min(v.length,c);for(var b=[],E=u;E<c;){var I=v[E],B=null,D=I>239?4:I>223?3:I>191?2:1;if(E+D<=c){var $,V,ne,K;switch(D){case 1:I<128&&(B=I);break;case 2:$=v[E+1],($&192)===128&&(K=(I&31)<<6|$&63,K>127&&(B=K));break;case 3:$=v[E+1],V=v[E+2],($&192)===128&&(V&192)===128&&(K=(I&15)<<12|($&63)<<6|V&63,K>2047&&(K<55296||K>57343)&&(B=K));break;case 4:$=v[E+1],V=v[E+2],ne=v[E+3],($&192)===128&&(V&192)===128&&(ne&192)===128&&(K=(I&15)<<18|($&63)<<12|(V&63)<<6|ne&63,K>65535&&K<1114112&&(B=K))}}B===null?(B=65533,D=1):B>65535&&(B-=65536,b.push(B>>>10&1023|55296),B=56320|B&1023),b.push(B),E+=D}return us(b)}var ei=4096;function us(v){var u=v.length;if(u<=ei)return String.fromCharCode.apply(String,v);for(var c="",b=0;b<u;)c+=String.fromCharCode.apply(String,v.slice(b,b+=ei));return c}function cs(v,u,c){var b="";c=Math.min(v.length,c);for(var E=u;E<c;++E)b+=String.fromCharCode(v[E]&127);return b}function hs(v,u,c){var b="";c=Math.min(v.length,c);for(var E=u;E<c;++E)b+=String.fromCharCode(v[E]);return b}function ps(v,u,c){var b=v.length;(!u||u<0)&&(u=0),(!c||c<0||c>b)&&(c=b);for(var E="",I=u;I<c;++I)E+=ws[v[I]];return E}function ds(v,u,c){for(var b=v.slice(u,c),E="",I=0;I<b.length-1;I+=2)E+=String.fromCharCode(b[I]+b[I+1]*256);return E}a.prototype.slice=function(u,c){var b=this.length;u=~~u,c=c===void 0?b:~~c,u<0?(u+=b,u<0&&(u=0)):u>b&&(u=b),c<0?(c+=b,c<0&&(c=0)):c>b&&(c=b),c<u&&(c=u);var E=this.subarray(u,c);return Object.setPrototypeOf(E,a.prototype),E};function Y(v,u,c){if(v%1!==0||v<0)throw new RangeError("offset is not uint");if(v+u>c)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(u,c,b){u=u>>>0,c=c>>>0,b||Y(u,c,this.length);for(var E=this[u],I=1,B=0;++B<c&&(I*=256);)E+=this[u+B]*I;return E},a.prototype.readUintBE=a.prototype.readUIntBE=function(u,c,b){u=u>>>0,c=c>>>0,b||Y(u,c,this.length);for(var E=this[u+--c],I=1;c>0&&(I*=256);)E+=this[u+--c]*I;return E},a.prototype.readUint8=a.prototype.readUInt8=function(u,c){return u=u>>>0,c||Y(u,1,this.length),this[u]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(u,c){return u=u>>>0,c||Y(u,2,this.length),this[u]|this[u+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(u,c){return u=u>>>0,c||Y(u,2,this.length),this[u]<<8|this[u+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(u,c){return u=u>>>0,c||Y(u,4,this.length),(this[u]|this[u+1]<<8|this[u+2]<<16)+this[u+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(u,c){return u=u>>>0,c||Y(u,4,this.length),this[u]*16777216+(this[u+1]<<16|this[u+2]<<8|this[u+3])},a.prototype.readIntLE=function(u,c,b){u=u>>>0,c=c>>>0,b||Y(u,c,this.length);for(var E=this[u],I=1,B=0;++B<c&&(I*=256);)E+=this[u+B]*I;return I*=128,E>=I&&(E-=Math.pow(2,8*c)),E},a.prototype.readIntBE=function(u,c,b){u=u>>>0,c=c>>>0,b||Y(u,c,this.length);for(var E=c,I=1,B=this[u+--E];E>0&&(I*=256);)B+=this[u+--E]*I;return I*=128,B>=I&&(B-=Math.pow(2,8*c)),B},a.prototype.readInt8=function(u,c){return u=u>>>0,c||Y(u,1,this.length),this[u]&128?(255-this[u]+1)*-1:this[u]},a.prototype.readInt16LE=function(u,c){u=u>>>0,c||Y(u,2,this.length);var b=this[u]|this[u+1]<<8;return b&32768?b|4294901760:b},a.prototype.readInt16BE=function(u,c){u=u>>>0,c||Y(u,2,this.length);var b=this[u+1]|this[u]<<8;return b&32768?b|4294901760:b},a.prototype.readInt32LE=function(u,c){return u=u>>>0,c||Y(u,4,this.length),this[u]|this[u+1]<<8|this[u+2]<<16|this[u+3]<<24},a.prototype.readInt32BE=function(u,c){return u=u>>>0,c||Y(u,4,this.length),this[u]<<24|this[u+1]<<16|this[u+2]<<8|this[u+3]},a.prototype.readFloatLE=function(u,c){return u=u>>>0,c||Y(u,4,this.length),r.read(this,u,!0,23,4)},a.prototype.readFloatBE=function(u,c){return u=u>>>0,c||Y(u,4,this.length),r.read(this,u,!1,23,4)},a.prototype.readDoubleLE=function(u,c){return u=u>>>0,c||Y(u,8,this.length),r.read(this,u,!0,52,8)},a.prototype.readDoubleBE=function(u,c){return u=u>>>0,c||Y(u,8,this.length),r.read(this,u,!1,52,8)};function pe(v,u,c,b,E,I){if(!a.isBuffer(v))throw new TypeError('"buffer" argument must be a Buffer instance');if(u>E||u<I)throw new RangeError('"value" argument is out of bounds');if(c+b>v.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(u,c,b,E){if(u=+u,c=c>>>0,b=b>>>0,!E){var I=Math.pow(2,8*b)-1;pe(this,u,c,b,I,0)}var B=1,D=0;for(this[c]=u&255;++D<b&&(B*=256);)this[c+D]=u/B&255;return c+b},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(u,c,b,E){if(u=+u,c=c>>>0,b=b>>>0,!E){var I=Math.pow(2,8*b)-1;pe(this,u,c,b,I,0)}var B=b-1,D=1;for(this[c+B]=u&255;--B>=0&&(D*=256);)this[c+B]=u/D&255;return c+b},a.prototype.writeUint8=a.prototype.writeUInt8=function(u,c,b){return u=+u,c=c>>>0,b||pe(this,u,c,1,255,0),this[c]=u&255,c+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(u,c,b){return u=+u,c=c>>>0,b||pe(this,u,c,2,65535,0),this[c]=u&255,this[c+1]=u>>>8,c+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(u,c,b){return u=+u,c=c>>>0,b||pe(this,u,c,2,65535,0),this[c]=u>>>8,this[c+1]=u&255,c+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(u,c,b){return u=+u,c=c>>>0,b||pe(this,u,c,4,4294967295,0),this[c+3]=u>>>24,this[c+2]=u>>>16,this[c+1]=u>>>8,this[c]=u&255,c+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(u,c,b){return u=+u,c=c>>>0,b||pe(this,u,c,4,4294967295,0),this[c]=u>>>24,this[c+1]=u>>>16,this[c+2]=u>>>8,this[c+3]=u&255,c+4},a.prototype.writeIntLE=function(u,c,b,E){if(u=+u,c=c>>>0,!E){var I=Math.pow(2,8*b-1);pe(this,u,c,b,I-1,-I)}var B=0,D=1,$=0;for(this[c]=u&255;++B<b&&(D*=256);)u<0&&$===0&&this[c+B-1]!==0&&($=1),this[c+B]=(u/D>>0)-$&255;return c+b},a.prototype.writeIntBE=function(u,c,b,E){if(u=+u,c=c>>>0,!E){var I=Math.pow(2,8*b-1);pe(this,u,c,b,I-1,-I)}var B=b-1,D=1,$=0;for(this[c+B]=u&255;--B>=0&&(D*=256);)u<0&&$===0&&this[c+B+1]!==0&&($=1),this[c+B]=(u/D>>0)-$&255;return c+b},a.prototype.writeInt8=function(u,c,b){return u=+u,c=c>>>0,b||pe(this,u,c,1,127,-128),u<0&&(u=255+u+1),this[c]=u&255,c+1},a.prototype.writeInt16LE=function(u,c,b){return u=+u,c=c>>>0,b||pe(this,u,c,2,32767,-32768),this[c]=u&255,this[c+1]=u>>>8,c+2},a.prototype.writeInt16BE=function(u,c,b){return u=+u,c=c>>>0,b||pe(this,u,c,2,32767,-32768),this[c]=u>>>8,this[c+1]=u&255,c+2},a.prototype.writeInt32LE=function(u,c,b){return u=+u,c=c>>>0,b||pe(this,u,c,4,2147483647,-2147483648),this[c]=u&255,this[c+1]=u>>>8,this[c+2]=u>>>16,this[c+3]=u>>>24,c+4},a.prototype.writeInt32BE=function(u,c,b){return u=+u,c=c>>>0,b||pe(this,u,c,4,2147483647,-2147483648),u<0&&(u=4294967295+u+1),this[c]=u>>>24,this[c+1]=u>>>16,this[c+2]=u>>>8,this[c+3]=u&255,c+4};function ti(v,u,c,b,E,I){if(c+b>v.length)throw new RangeError("Index out of range");if(c<0)throw new RangeError("Index out of range")}function ri(v,u,c,b,E){return u=+u,c=c>>>0,E||ti(v,u,c,4),r.write(v,u,c,b,23,4),c+4}a.prototype.writeFloatLE=function(u,c,b){return ri(this,u,c,!0,b)},a.prototype.writeFloatBE=function(u,c,b){return ri(this,u,c,!1,b)};function ni(v,u,c,b,E){return u=+u,c=c>>>0,E||ti(v,u,c,8),r.write(v,u,c,b,52,8),c+8}a.prototype.writeDoubleLE=function(u,c,b){return ni(this,u,c,!0,b)},a.prototype.writeDoubleBE=function(u,c,b){return ni(this,u,c,!1,b)},a.prototype.copy=function(u,c,b,E){if(!a.isBuffer(u))throw new TypeError("argument should be a Buffer");if(b||(b=0),!E&&E!==0&&(E=this.length),c>=u.length&&(c=u.length),c||(c=0),E>0&&E<b&&(E=b),E===b||u.length===0||this.length===0)return 0;if(c<0)throw new RangeError("targetStart out of bounds");if(b<0||b>=this.length)throw new RangeError("Index out of range");if(E<0)throw new RangeError("sourceEnd out of bounds");E>this.length&&(E=this.length),u.length-c<E-b&&(E=u.length-c+b);var I=E-b;return this===u&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(c,b,E):Uint8Array.prototype.set.call(u,this.subarray(b,E),c),I},a.prototype.fill=function(u,c,b,E){if(typeof u=="string"){if(typeof c=="string"?(E=c,c=0,b=this.length):typeof b=="string"&&(E=b,b=this.length),E!==void 0&&typeof E!="string")throw new TypeError("encoding must be a string");if(typeof E=="string"&&!a.isEncoding(E))throw new TypeError("Unknown encoding: "+E);if(u.length===1){var I=u.charCodeAt(0);(E==="utf8"&&I<128||E==="latin1")&&(u=I)}}else typeof u=="number"?u=u&255:typeof u=="boolean"&&(u=Number(u));if(c<0||this.length<c||this.length<b)throw new RangeError("Out of range index");if(b<=c)return this;c=c>>>0,b=b===void 0?this.length:b>>>0,u||(u=0);var B;if(typeof u=="number")for(B=c;B<b;++B)this[B]=u;else{var D=a.isBuffer(u)?u:a.from(u,E),$=D.length;if($===0)throw new TypeError('The value "'+u+'" is invalid for argument "value"');for(B=0;B<b-c;++B)this[B+c]=D[B%$]}return this};var gs=/[^+/0-9A-Za-z-_]/g;function ys(v){if(v=v.split("=")[0],v=v.trim().replace(gs,""),v.length<2)return"";for(;v.length%4!==0;)v=v+"=";return v}function zr(v,u){u=u||1/0;for(var c,b=v.length,E=null,I=[],B=0;B<b;++B){if(c=v.charCodeAt(B),c>55295&&c<57344){if(!E){if(c>56319){(u-=3)>-1&&I.push(239,191,189);continue}else if(B+1===b){(u-=3)>-1&&I.push(239,191,189);continue}E=c;continue}if(c<56320){(u-=3)>-1&&I.push(239,191,189),E=c;continue}c=(E-55296<<10|c-56320)+65536}else E&&(u-=3)>-1&&I.push(239,191,189);if(E=null,c<128){if((u-=1)<0)break;I.push(c)}else if(c<2048){if((u-=2)<0)break;I.push(c>>6|192,c&63|128)}else if(c<65536){if((u-=3)<0)break;I.push(c>>12|224,c>>6&63|128,c&63|128)}else if(c<1114112){if((u-=4)<0)break;I.push(c>>18|240,c>>12&63|128,c>>6&63|128,c&63|128)}else throw new Error("Invalid code point")}return I}function vs(v){for(var u=[],c=0;c<v.length;++c)u.push(v.charCodeAt(c)&255);return u}function bs(v,u){for(var c,b,E,I=[],B=0;B<v.length&&!((u-=2)<0);++B)c=v.charCodeAt(B),b=c>>8,E=c%256,I.push(E),I.push(b);return I}function ii(v){return e.toByteArray(ys(v))}function tr(v,u,c,b){for(var E=0;E<b&&!(E+c>=u.length||E>=v.length);++E)u[E+c]=v[E];return E}function Ie(v,u){return v instanceof u||v!=null&&v.constructor!=null&&v.constructor.name!=null&&v.constructor.name===u.name}function Vr(v){return v!==v}var ws=function(){for(var v="0123456789abcdef",u=new Array(256),c=0;c<16;++c)for(var b=c*16,E=0;E<16;++E)u[b+E]=v[c]+v[E];return u}()})(Ve);function vi(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Ol(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?vi(Object(r),!0).forEach(function(n){Ll(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):vi(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Ll(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Dl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function bi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ul(t,e,r){return e&&bi(t.prototype,e),r&&bi(t,r),t}var Fl=Ve,fr=Fl.Buffer,Nl=ke,vn=Nl.inspect,jl=vn&&vn.custom||"inspect";function ql(t,e,r){fr.prototype.copy.call(t,e,r)}var Wl=function(){function t(){Dl(this,t),this.head=null,this.tail=null,this.length=0}return Ul(t,[{key:"push",value:function(r){var n={data:r,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length}},{key:"unshift",value:function(r){var n={data:r,next:this.head};this.length===0&&(this.tail=n),this.head=n,++this.length}},{key:"shift",value:function(){if(this.length!==0){var r=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,r}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(r){if(this.length===0)return"";for(var n=this.head,i=""+n.data;n=n.next;)i+=r+n.data;return i}},{key:"concat",value:function(r){if(this.length===0)return fr.alloc(0);for(var n=fr.allocUnsafe(r>>>0),i=this.head,o=0;i;)ql(i.data,n,o),o+=i.data.length,i=i.next;return n}},{key:"consume",value:function(r,n){var i;return r<this.head.data.length?(i=this.head.data.slice(0,r),this.head.data=this.head.data.slice(r)):r===this.head.data.length?i=this.shift():i=n?this._getString(r):this._getBuffer(r),i}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(r){var n=this.head,i=1,o=n.data;for(r-=o.length;n=n.next;){var s=n.data,a=r>s.length?s.length:r;if(a===s.length?o+=s:o+=s.slice(0,r),r-=a,r===0){a===s.length?(++i,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=s.slice(a));break}++i}return this.length-=i,o}},{key:"_getBuffer",value:function(r){var n=fr.allocUnsafe(r),i=this.head,o=1;for(i.data.copy(n),r-=i.data.length;i=i.next;){var s=i.data,a=r>s.length?s.length:r;if(s.copy(n,n.length-r,0,a),r-=a,r===0){a===s.length?(++o,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=s.slice(a));break}++o}return this.length-=o,n}},{key:jl,value:function(r,n){return vn(this,Ol({},n,{depth:0,customInspect:!1}))}}]),t}();function $l(t,e){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?(e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(bn,this,t)):process.nextTick(bn,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(o){!e&&o?r._writableState?r._writableState.errorEmitted?process.nextTick(ur,r):(r._writableState.errorEmitted=!0,process.nextTick(wi,r,o)):process.nextTick(wi,r,o):e?(process.nextTick(ur,r),e(o)):process.nextTick(ur,r)}),this)}function wi(t,e){bn(t,e),ur(t)}function ur(t){t._writableState&&!t._writableState.emitClose||t._readableState&&!t._readableState.emitClose||t.emit("close")}function zl(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function bn(t,e){t.emit("error",e)}function Vl(t,e){var r=t._readableState,n=t._writableState;r&&r.autoDestroy||n&&n.autoDestroy?t.destroy(e):t.emit("error",e)}var ao={destroy:$l,undestroy:zl,errorOrDestroy:Vl},ht={};function Hl(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var lo={};function me(t,e,r){r||(r=Error);function n(o,s,a){return typeof e=="string"?e:e(o,s,a)}var i=function(o){Hl(s,o);function s(a,f,l){return o.call(this,n(a,f,l))||this}return s}(r);i.prototype.name=r.name,i.prototype.code=t,lo[t]=i}function mi(t,e){if(Array.isArray(t)){var r=t.length;return t=t.map(function(n){return String(n)}),r>2?"one of ".concat(e," ").concat(t.slice(0,r-1).join(", "),", or ")+t[r-1]:r===2?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}else return"of ".concat(e," ").concat(String(t))}function Kl(t,e,r){return t.substr(!r||r<0?0:+r,e.length)===e}function Gl(t,e,r){return(r===void 0||r>t.length)&&(r=t.length),t.substring(r-e.length,r)===e}function Ql(t,e,r){return typeof r!="number"&&(r=0),r+e.length>t.length?!1:t.indexOf(e,r)!==-1}me("ERR_INVALID_OPT_VALUE",function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'},TypeError);me("ERR_INVALID_ARG_TYPE",function(t,e,r){var n;typeof e=="string"&&Kl(e,"not ")?(n="must not be",e=e.replace(/^not /,"")):n="must be";var i;if(Gl(t," argument"))i="The ".concat(t," ").concat(n," ").concat(mi(e,"type"));else{var o=Ql(t,".")?"property":"argument";i='The "'.concat(t,'" ').concat(o," ").concat(n," ").concat(mi(e,"type"))}return i+=". Received type ".concat(typeof r),i},TypeError);me("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");me("ERR_METHOD_NOT_IMPLEMENTED",function(t){return"The "+t+" method is not implemented"});me("ERR_STREAM_PREMATURE_CLOSE","Premature close");me("ERR_STREAM_DESTROYED",function(t){return"Cannot call "+t+" after a stream was destroyed"});me("ERR_MULTIPLE_CALLBACK","Callback called multiple times");me("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");me("ERR_STREAM_WRITE_AFTER_END","write after end");me("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);me("ERR_UNKNOWN_ENCODING",function(t){return"Unknown encoding: "+t},TypeError);me("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");ht.codes=lo;var Yl=ht.codes.ERR_INVALID_OPT_VALUE;function Xl(t,e,r){return t.highWaterMark!=null?t.highWaterMark:e?t[r]:null}function Zl(t,e,r,n){var i=Xl(e,n,r);if(i!=null){if(!(isFinite(i)&&Math.floor(i)===i)||i<0){var o=n?r:"highWaterMark";throw new Yl(o,i)}return Math.floor(i)}return t.objectMode?16:16*1024}var fo={getHighWaterMark:Zl},Oe={exports:{}};typeof Object.create=="function"?Oe.exports=function(e,r){r&&(e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:Oe.exports=function(e,r){if(r){e.super_=r;var n=function(){};n.prototype=r.prototype,e.prototype=new n,e.prototype.constructor=e}};var Jl=ef;function ef(t,e){if(en("noDeprecation"))return t;var r=!1;function n(){if(!r){if(en("throwDeprecation"))throw new Error(e);en("traceDeprecation")?console.trace(e):console.warn(e),r=!0}return t.apply(this,arguments)}return n}function en(t){try{if(!{}.localStorage)return!1}catch{return!1}var e={}.localStorage[t];return e==null?!1:String(e).toLowerCase()==="true"}var uo=G;function co(t){var e=this;this.next=null,this.entry=null,this.finish=function(){If(e,t)}}var bt;G.WritableState=Qt;var tf={deprecate:Jl},ho=oo,Mr=Ve.Buffer,rf={}.Uint8Array||function(){};function nf(t){return Mr.from(t)}function of(t){return Mr.isBuffer(t)||t instanceof rf}var jn=ao,sf=fo,af=sf.getHighWaterMark,rt=ht.codes,lf=rt.ERR_INVALID_ARG_TYPE,ff=rt.ERR_METHOD_NOT_IMPLEMENTED,uf=rt.ERR_MULTIPLE_CALLBACK,cf=rt.ERR_STREAM_CANNOT_PIPE,hf=rt.ERR_STREAM_DESTROYED,pf=rt.ERR_STREAM_NULL_VALUES,df=rt.ERR_STREAM_WRITE_AFTER_END,gf=rt.ERR_UNKNOWN_ENCODING,At=jn.errorOrDestroy;Oe.exports(G,ho);function yf(){}function Qt(t,e,r){bt=bt||Mt,t=t||{},typeof r!="boolean"&&(r=e instanceof bt),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=af(this,t,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var n=t.decodeStrings===!1;this.decodeStrings=!n,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(i){Sf(e,i)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=t.emitClose!==!1,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new co(this)}Qt.prototype.getBuffer=function(){for(var e=this.bufferedRequest,r=[];e;)r.push(e),e=e.next;return r};(function(){try{Object.defineProperty(Qt.prototype,"buffer",{get:tf.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var cr;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(cr=Function.prototype[Symbol.hasInstance],Object.defineProperty(G,Symbol.hasInstance,{value:function(e){return cr.call(this,e)?!0:this!==G?!1:e&&e._writableState instanceof Qt}})):cr=function(e){return e instanceof this};function G(t){bt=bt||Mt;var e=this instanceof bt;if(!e&&!cr.call(G,this))return new G(t);this._writableState=new Qt(t,this,e),this.writable=!0,t&&(typeof t.write=="function"&&(this._write=t.write),typeof t.writev=="function"&&(this._writev=t.writev),typeof t.destroy=="function"&&(this._destroy=t.destroy),typeof t.final=="function"&&(this._final=t.final)),ho.call(this)}G.prototype.pipe=function(){At(this,new cf)};function vf(t,e){var r=new df;At(t,r),process.nextTick(e,r)}function bf(t,e,r,n){var i;return r===null?i=new pf:typeof r!="string"&&!e.objectMode&&(i=new lf("chunk",["string","Buffer"],r)),i?(At(t,i),process.nextTick(n,i),!1):!0}G.prototype.write=function(t,e,r){var n=this._writableState,i=!1,o=!n.objectMode&&of(t);return o&&!Mr.isBuffer(t)&&(t=nf(t)),typeof e=="function"&&(r=e,e=null),o?e="buffer":e||(e=n.defaultEncoding),typeof r!="function"&&(r=yf),n.ending?vf(this,r):(o||bf(this,n,t,r))&&(n.pendingcb++,i=mf(this,n,o,t,e,r)),i};G.prototype.cork=function(){this._writableState.corked++};G.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,!t.writing&&!t.corked&&!t.bufferProcessing&&t.bufferedRequest&&po(this,t))};G.prototype.setDefaultEncoding=function(e){if(typeof e=="string"&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new gf(e);return this._writableState.defaultEncoding=e,this};Object.defineProperty(G.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function wf(t,e,r){return!t.objectMode&&t.decodeStrings!==!1&&typeof e=="string"&&(e=Mr.from(e,r)),e}Object.defineProperty(G.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function mf(t,e,r,n,i,o){if(!r){var s=wf(e,n,i);n!==s&&(r=!0,i="buffer",n=s)}var a=e.objectMode?1:n.length;e.length+=a;var f=e.length<e.highWaterMark;if(f||(e.needDrain=!0),e.writing||e.corked){var l=e.lastBufferedRequest;e.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},l?l.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else wn(t,e,!1,a,n,i,o);return f}function wn(t,e,r,n,i,o,s){e.writelen=n,e.writecb=s,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new hf("write")):r?t._writev(i,e.onwrite):t._write(i,o,e.onwrite),e.sync=!1}function _f(t,e,r,n,i){--e.pendingcb,r?(process.nextTick(i,n),process.nextTick(Vt,t,e),t._writableState.errorEmitted=!0,At(t,n)):(i(n),t._writableState.errorEmitted=!0,At(t,n),Vt(t,e))}function Ef(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function Sf(t,e){var r=t._writableState,n=r.sync,i=r.writecb;if(typeof i!="function")throw new uf;if(Ef(r),e)_f(t,r,n,e,i);else{var o=go(r)||t.destroyed;!o&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&po(t,r),n?process.nextTick(_i,t,r,o,i):_i(t,r,o,i)}}function _i(t,e,r,n){r||Tf(t,e),e.pendingcb--,n(),Vt(t,e)}function Tf(t,e){e.length===0&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function po(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var n=e.bufferedRequestCount,i=new Array(n),o=e.corkedRequestsFree;o.entry=r;for(var s=0,a=!0;r;)i[s]=r,r.isBuf||(a=!1),r=r.next,s+=1;i.allBuffers=a,wn(t,e,!0,e.length,i,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new co(e),e.bufferedRequestCount=0}else{for(;r;){var f=r.chunk,l=r.encoding,d=r.callback,p=e.objectMode?1:f.length;if(wn(t,e,!1,p,f,l,d),r=r.next,e.bufferedRequestCount--,e.writing)break}r===null&&(e.lastBufferedRequest=null)}e.bufferedRequest=r,e.bufferProcessing=!1}G.prototype._write=function(t,e,r){r(new ff("_write()"))};G.prototype._writev=null;G.prototype.end=function(t,e,r){var n=this._writableState;return typeof t=="function"?(r=t,t=null,e=null):typeof e=="function"&&(r=e,e=null),t!=null&&this.write(t,e),n.corked&&(n.corked=1,this.uncork()),n.ending||kf(this,n,r),this};Object.defineProperty(G.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function go(t){return t.ending&&t.length===0&&t.bufferedRequest===null&&!t.finished&&!t.writing}function Cf(t,e){t._final(function(r){e.pendingcb--,r&&At(t,r),e.prefinished=!0,t.emit("prefinish"),Vt(t,e)})}function Af(t,e){!e.prefinished&&!e.finalCalled&&(typeof t._final=="function"&&!e.destroyed?(e.pendingcb++,e.finalCalled=!0,process.nextTick(Cf,t,e)):(e.prefinished=!0,t.emit("prefinish")))}function Vt(t,e){var r=go(e);if(r&&(Af(t,e),e.pendingcb===0&&(e.finished=!0,t.emit("finish"),e.autoDestroy))){var n=t._readableState;(!n||n.autoDestroy&&n.endEmitted)&&t.destroy()}return r}function kf(t,e,r){e.ending=!0,Vt(t,e),r&&(e.finished?process.nextTick(r):t.once("finish",r)),e.ended=!0,t.writable=!1}function If(t,e,r){var n=t.entry;for(t.entry=null;n;){var i=n.callback;e.pendingcb--,i(r),n=n.next}e.corkedRequestsFree.next=t}Object.defineProperty(G.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(e){!this._writableState||(this._writableState.destroyed=e)}});G.prototype.destroy=jn.destroy;G.prototype._undestroy=jn.undestroy;G.prototype._destroy=function(t,e){e(t)};var xf=Object.keys||function(t){var e=[];for(var r in t)e.push(r);return e},Mt=Le,yo=bo,mn=uo;Oe.exports(Le,yo);for(var Ei=xf(mn.prototype),tn=0;tn<Ei.length;tn++){var rn=Ei[tn];Le.prototype[rn]||(Le.prototype[rn]=mn.prototype[rn])}function Le(t){if(!(this instanceof Le))return new Le(t);yo.call(this,t),mn.call(this,t),this.allowHalfOpen=!0,t&&(t.readable===!1&&(this.readable=!1),t.writable===!1&&(this.writable=!1),t.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",Bf)))}Object.defineProperty(Le.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});Object.defineProperty(Le.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});Object.defineProperty(Le.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Bf(){this._writableState.ended||process.nextTick(Rf,this)}function Rf(t){t.end()}Object.defineProperty(Le.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(e){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=e,this._writableState.destroyed=e)}});var qn={},_n={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(t,e){var r=Ve,n=r.Buffer;function i(s,a){for(var f in s)a[f]=s[f]}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?t.exports=r:(i(r,e),e.Buffer=o);function o(s,a,f){return n(s,a,f)}o.prototype=Object.create(n.prototype),i(n,o),o.from=function(s,a,f){if(typeof s=="number")throw new TypeError("Argument must not be a number");return n(s,a,f)},o.alloc=function(s,a,f){if(typeof s!="number")throw new TypeError("Argument must be a number");var l=n(s);return a!==void 0?typeof f=="string"?l.fill(a,f):l.fill(a):l.fill(0),l},o.allocUnsafe=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return n(s)},o.allocUnsafeSlow=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return r.SlowBuffer(s)}})(_n,_n.exports);var Wn=_n.exports.Buffer,Si=Wn.isEncoding||function(t){switch(t=""+t,t&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function Pf(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}function Mf(t){var e=Pf(t);if(typeof e!="string"&&(Wn.isEncoding===Si||!Si(t)))throw new Error("Unknown encoding: "+t);return e||t}qn.StringDecoder=Yt;function Yt(t){this.encoding=Mf(t);var e;switch(this.encoding){case"utf16le":this.text=Nf,this.end=jf,e=4;break;case"utf8":this.fillLast=Df,e=4;break;case"base64":this.text=qf,this.end=Wf,e=3;break;default:this.write=$f,this.end=zf;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=Wn.allocUnsafe(e)}Yt.prototype.write=function(t){if(t.length===0)return"";var e,r;if(this.lastNeed){if(e=this.fillLast(t),e===void 0)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""};Yt.prototype.end=Ff;Yt.prototype.text=Uf;Yt.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length};function nn(t){return t<=127?0:t>>5===6?2:t>>4===14?3:t>>3===30?4:t>>6===2?-1:-2}function Of(t,e,r){var n=e.length-1;if(n<r)return 0;var i=nn(e[n]);return i>=0?(i>0&&(t.lastNeed=i-1),i):--n<r||i===-2?0:(i=nn(e[n]),i>=0?(i>0&&(t.lastNeed=i-2),i):--n<r||i===-2?0:(i=nn(e[n]),i>=0?(i>0&&(i===2?i=0:t.lastNeed=i-3),i):0))}function Lf(t,e,r){if((e[0]&192)!==128)return t.lastNeed=0,"\uFFFD";if(t.lastNeed>1&&e.length>1){if((e[1]&192)!==128)return t.lastNeed=1,"\uFFFD";if(t.lastNeed>2&&e.length>2&&(e[2]&192)!==128)return t.lastNeed=2,"\uFFFD"}}function Df(t){var e=this.lastTotal-this.lastNeed,r=Lf(this,t);if(r!==void 0)return r;if(this.lastNeed<=t.length)return t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,e,0,t.length),this.lastNeed-=t.length}function Uf(t,e){var r=Of(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var n=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)}function Ff(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"\uFFFD":e}function Nf(t,e){if((t.length-e)%2===0){var r=t.toString("utf16le",e);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function jf(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}function qf(t,e){var r=(t.length-e)%3;return r===0?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,r===1?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function Wf(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function $f(t){return t.toString(this.encoding)}function zf(t){return t&&t.length?this.write(t):""}var Ti=ht.codes.ERR_STREAM_PREMATURE_CLOSE;function Vf(t){var e=!1;return function(){if(!e){e=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];t.apply(this,n)}}}function Hf(){}function Kf(t){return t.setHeader&&typeof t.abort=="function"}function vo(t,e,r){if(typeof e=="function")return vo(t,null,e);e||(e={}),r=Vf(r||Hf);var n=e.readable||e.readable!==!1&&t.readable,i=e.writable||e.writable!==!1&&t.writable,o=function(){t.writable||a()},s=t._writableState&&t._writableState.finished,a=function(){i=!1,s=!0,n||r.call(t)},f=t._readableState&&t._readableState.endEmitted,l=function(){n=!1,f=!0,i||r.call(t)},d=function(S){r.call(t,S)},p=function(){var S;if(n&&!f)return(!t._readableState||!t._readableState.ended)&&(S=new Ti),r.call(t,S);if(i&&!s)return(!t._writableState||!t._writableState.ended)&&(S=new Ti),r.call(t,S)},y=function(){t.req.on("finish",a)};return Kf(t)?(t.on("complete",a),t.on("abort",p),t.req?y():t.on("request",y)):i&&!t._writableState&&(t.on("end",o),t.on("close",o)),t.on("end",l),t.on("finish",a),e.error!==!1&&t.on("error",d),t.on("close",p),function(){t.removeListener("complete",a),t.removeListener("abort",p),t.removeListener("request",y),t.req&&t.req.removeListener("finish",a),t.removeListener("end",o),t.removeListener("close",o),t.removeListener("finish",a),t.removeListener("end",l),t.removeListener("error",d),t.removeListener("close",p)}}var $n=vo,ir;function He(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Gf=$n,Ke=Symbol("lastResolve"),nt=Symbol("lastReject"),Nt=Symbol("error"),yr=Symbol("ended"),st=Symbol("lastPromise"),zn=Symbol("handlePromise"),at=Symbol("stream");function Ye(t,e){return{value:t,done:e}}function Qf(t){var e=t[Ke];if(e!==null){var r=t[at].read();r!==null&&(t[st]=null,t[Ke]=null,t[nt]=null,e(Ye(r,!1)))}}function Yf(t){process.nextTick(Qf,t)}function Xf(t,e){return function(r,n){t.then(function(){if(e[yr]){r(Ye(void 0,!0));return}e[zn](r,n)},n)}}var Zf=Object.getPrototypeOf(function(){}),Jf=Object.setPrototypeOf((ir={get stream(){return this[at]},next:function(){var e=this,r=this[Nt];if(r!==null)return Promise.reject(r);if(this[yr])return Promise.resolve(Ye(void 0,!0));if(this[at].destroyed)return new Promise(function(s,a){process.nextTick(function(){e[Nt]?a(e[Nt]):s(Ye(void 0,!0))})});var n=this[st],i;if(n)i=new Promise(Xf(n,this));else{var o=this[at].read();if(o!==null)return Promise.resolve(Ye(o,!1));i=new Promise(this[zn])}return this[st]=i,i}},He(ir,Symbol.asyncIterator,function(){return this}),He(ir,"return",function(){var e=this;return new Promise(function(r,n){e[at].destroy(null,function(i){if(i){n(i);return}r(Ye(void 0,!0))})})}),ir),Zf),eu=function(e){var r,n=Object.create(Jf,(r={},He(r,at,{value:e,writable:!0}),He(r,Ke,{value:null,writable:!0}),He(r,nt,{value:null,writable:!0}),He(r,Nt,{value:null,writable:!0}),He(r,yr,{value:e._readableState.endEmitted,writable:!0}),He(r,zn,{value:function(o,s){var a=n[at].read();a?(n[st]=null,n[Ke]=null,n[nt]=null,o(Ye(a,!1))):(n[Ke]=o,n[nt]=s)},writable:!0}),r));return n[st]=null,Gf(e,function(i){if(i&&i.code!=="ERR_STREAM_PREMATURE_CLOSE"){var o=n[nt];o!==null&&(n[st]=null,n[Ke]=null,n[nt]=null,o(i)),n[Nt]=i;return}var s=n[Ke];s!==null&&(n[st]=null,n[Ke]=null,n[nt]=null,s(Ye(void 0,!0))),n[yr]=!0}),e.on("readable",Yf.bind(null,n)),n},tu=eu,ru=function(){throw new Error("Readable.from is not available in the browser")},bo=U,wt;U.ReadableState=mo;ke.EventEmitter;var wo=function(e,r){return e.listeners(r).length},Xt=oo,Or=Ve.Buffer,nu={}.Uint8Array||function(){};function iu(t){return Or.from(t)}function ou(t){return Or.isBuffer(t)||t instanceof nu}var on=ke,O;on&&on.debuglog?O=on.debuglog("stream"):O=function(){};var su=Wl,Vn=ao,au=fo,lu=au.getHighWaterMark,Lr=ht.codes,fu=Lr.ERR_INVALID_ARG_TYPE,uu=Lr.ERR_STREAM_PUSH_AFTER_EOF,cu=Lr.ERR_METHOD_NOT_IMPLEMENTED,hu=Lr.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,mt,sn,an;Oe.exports(U,Xt);var jt=Vn.errorOrDestroy,ln=["error","close","destroy","pause","resume"];function pu(t,e,r){if(typeof t.prependListener=="function")return t.prependListener(e,r);!t._events||!t._events[e]?t.on(e,r):Array.isArray(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]}function mo(t,e,r){wt=wt||Mt,t=t||{},typeof r!="boolean"&&(r=e instanceof wt),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=lu(this,t,"readableHighWaterMark",r),this.buffer=new su,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=t.emitClose!==!1,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(mt||(mt=qn.StringDecoder),this.decoder=new mt(t.encoding),this.encoding=t.encoding)}function U(t){if(wt=wt||Mt,!(this instanceof U))return new U(t);var e=this instanceof wt;this._readableState=new mo(t,this,e),this.readable=!0,t&&(typeof t.read=="function"&&(this._read=t.read),typeof t.destroy=="function"&&(this._destroy=t.destroy)),Xt.call(this)}Object.defineProperty(U.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(e){!this._readableState||(this._readableState.destroyed=e)}});U.prototype.destroy=Vn.destroy;U.prototype._undestroy=Vn.undestroy;U.prototype._destroy=function(t,e){e(t)};U.prototype.push=function(t,e){var r=this._readableState,n;return r.objectMode?n=!0:typeof t=="string"&&(e=e||r.defaultEncoding,e!==r.encoding&&(t=Or.from(t,e),e=""),n=!0),_o(this,t,e,!1,n)};U.prototype.unshift=function(t){return _o(this,t,null,!0,!1)};function _o(t,e,r,n,i){O("readableAddChunk",e);var o=t._readableState;if(e===null)o.reading=!1,yu(t,o);else{var s;if(i||(s=du(o,e)),s)jt(t,s);else if(o.objectMode||e&&e.length>0)if(typeof e!="string"&&!o.objectMode&&Object.getPrototypeOf(e)!==Or.prototype&&(e=iu(e)),n)o.endEmitted?jt(t,new hu):fn(t,o,e,!0);else if(o.ended)jt(t,new uu);else{if(o.destroyed)return!1;o.reading=!1,o.decoder&&!r?(e=o.decoder.write(e),o.objectMode||e.length!==0?fn(t,o,e,!1):En(t,o)):fn(t,o,e,!1)}else n||(o.reading=!1,En(t,o))}return!o.ended&&(o.length<o.highWaterMark||o.length===0)}function fn(t,e,r,n){e.flowing&&e.length===0&&!e.sync?(e.awaitDrain=0,t.emit("data",r)):(e.length+=e.objectMode?1:r.length,n?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&Dr(t)),En(t,e)}function du(t,e){var r;return!ou(e)&&typeof e!="string"&&e!==void 0&&!t.objectMode&&(r=new fu("chunk",["string","Buffer","Uint8Array"],e)),r}U.prototype.isPaused=function(){return this._readableState.flowing===!1};U.prototype.setEncoding=function(t){mt||(mt=qn.StringDecoder);var e=new mt(t);this._readableState.decoder=e,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";r!==null;)n+=e.write(r.data),r=r.next;return this._readableState.buffer.clear(),n!==""&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var Ci=1073741824;function gu(t){return t>=Ci?t=Ci:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}function Ai(t,e){return t<=0||e.length===0&&e.ended?0:e.objectMode?1:t!==t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=gu(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}U.prototype.read=function(t){O("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(t!==0&&(e.emittedReadable=!1),t===0&&e.needReadable&&((e.highWaterMark!==0?e.length>=e.highWaterMark:e.length>0)||e.ended))return O("read: emitReadable",e.length,e.ended),e.length===0&&e.ended?un(this):Dr(this),null;if(t=Ai(t,e),t===0&&e.ended)return e.length===0&&un(this),null;var n=e.needReadable;O("need readable",n),(e.length===0||e.length-t<e.highWaterMark)&&(n=!0,O("length less than watermark",n)),e.ended||e.reading?(n=!1,O("reading or ended",n)):n&&(O("do read"),e.reading=!0,e.sync=!0,e.length===0&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=Ai(r,e)));var i;return t>0?i=To(t,e):i=null,i===null?(e.needReadable=e.length<=e.highWaterMark,t=0):(e.length-=t,e.awaitDrain=0),e.length===0&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&un(this)),i!==null&&this.emit("data",i),i};function yu(t,e){if(O("onEofChunk"),!e.ended){if(e.decoder){var r=e.decoder.end();r&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length)}e.ended=!0,e.sync?Dr(t):(e.needReadable=!1,e.emittedReadable||(e.emittedReadable=!0,Eo(t)))}}function Dr(t){var e=t._readableState;O("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(O("emitReadable",e.flowing),e.emittedReadable=!0,process.nextTick(Eo,t))}function Eo(t){var e=t._readableState;O("emitReadable_",e.destroyed,e.length,e.ended),!e.destroyed&&(e.length||e.ended)&&(t.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,Hn(t)}function En(t,e){e.readingMore||(e.readingMore=!0,process.nextTick(vu,t,e))}function vu(t,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&e.length===0);){var r=e.length;if(O("maybeReadMore read 0"),t.read(0),r===e.length)break}e.readingMore=!1}U.prototype._read=function(t){jt(this,new cu("_read()"))};U.prototype.pipe=function(t,e){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=t;break;case 1:n.pipes=[n.pipes,t];break;default:n.pipes.push(t);break}n.pipesCount+=1,O("pipe count=%d opts=%j",n.pipesCount,e);var i=(!e||e.end!==!1)&&t!==process.stdout&&t!==process.stderr,o=i?a:_;n.endEmitted?process.nextTick(o):r.once("end",o),t.on("unpipe",s);function s(C,x){O("onunpipe"),C===r&&x&&x.hasUnpiped===!1&&(x.hasUnpiped=!0,d())}function a(){O("onend"),t.end()}var f=bu(r);t.on("drain",f);var l=!1;function d(){O("cleanup"),t.removeListener("close",w),t.removeListener("finish",S),t.removeListener("drain",f),t.removeListener("error",y),t.removeListener("unpipe",s),r.removeListener("end",a),r.removeListener("end",_),r.removeListener("data",p),l=!0,n.awaitDrain&&(!t._writableState||t._writableState.needDrain)&&f()}r.on("data",p);function p(C){O("ondata");var x=t.write(C);O("dest.write",x),x===!1&&((n.pipesCount===1&&n.pipes===t||n.pipesCount>1&&Co(n.pipes,t)!==-1)&&!l&&(O("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function y(C){O("onerror",C),_(),t.removeListener("error",y),wo(t,"error")===0&&jt(t,C)}pu(t,"error",y);function w(){t.removeListener("finish",S),_()}t.once("close",w);function S(){O("onfinish"),t.removeListener("close",w),_()}t.once("finish",S);function _(){O("unpipe"),r.unpipe(t)}return t.emit("pipe",r),n.flowing||(O("pipe resume"),r.resume()),t};function bu(t){return function(){var r=t._readableState;O("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&wo(t,"data")&&(r.flowing=!0,Hn(t))}}U.prototype.unpipe=function(t){var e=this._readableState,r={hasUnpiped:!1};if(e.pipesCount===0)return this;if(e.pipesCount===1)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,r),this);if(!t){var n=e.pipes,i=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,{hasUnpiped:!1});return this}var s=Co(e.pipes,t);return s===-1?this:(e.pipes.splice(s,1),e.pipesCount-=1,e.pipesCount===1&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,r),this)};U.prototype.on=function(t,e){var r=Xt.prototype.on.call(this,t,e),n=this._readableState;return t==="data"?(n.readableListening=this.listenerCount("readable")>0,n.flowing!==!1&&this.resume()):t==="readable"&&!n.endEmitted&&!n.readableListening&&(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,O("on readable",n.length,n.reading),n.length?Dr(this):n.reading||process.nextTick(wu,this)),r};U.prototype.addListener=U.prototype.on;U.prototype.removeListener=function(t,e){var r=Xt.prototype.removeListener.call(this,t,e);return t==="readable"&&process.nextTick(So,this),r};U.prototype.removeAllListeners=function(t){var e=Xt.prototype.removeAllListeners.apply(this,arguments);return(t==="readable"||t===void 0)&&process.nextTick(So,this),e};function So(t){var e=t._readableState;e.readableListening=t.listenerCount("readable")>0,e.resumeScheduled&&!e.paused?e.flowing=!0:t.listenerCount("data")>0&&t.resume()}function wu(t){O("readable nexttick read 0"),t.read(0)}U.prototype.resume=function(){var t=this._readableState;return t.flowing||(O("resume"),t.flowing=!t.readableListening,mu(this,t)),t.paused=!1,this};function mu(t,e){e.resumeScheduled||(e.resumeScheduled=!0,process.nextTick(_u,t,e))}function _u(t,e){O("resume",e.reading),e.reading||t.read(0),e.resumeScheduled=!1,t.emit("resume"),Hn(t),e.flowing&&!e.reading&&t.read(0)}U.prototype.pause=function(){return O("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(O("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Hn(t){var e=t._readableState;for(O("flow",e.flowing);e.flowing&&t.read()!==null;);}U.prototype.wrap=function(t){var e=this,r=this._readableState,n=!1;t.on("end",function(){if(O("wrapped end"),r.decoder&&!r.ended){var s=r.decoder.end();s&&s.length&&e.push(s)}e.push(null)}),t.on("data",function(s){if(O("wrapped data"),r.decoder&&(s=r.decoder.write(s)),!(r.objectMode&&s==null)&&!(!r.objectMode&&(!s||!s.length))){var a=e.push(s);a||(n=!0,t.pause())}});for(var i in t)this[i]===void 0&&typeof t[i]=="function"&&(this[i]=function(a){return function(){return t[a].apply(t,arguments)}}(i));for(var o=0;o<ln.length;o++)t.on(ln[o],this.emit.bind(this,ln[o]));return this._read=function(s){O("wrapped _read",s),n&&(n=!1,t.resume())},this};typeof Symbol=="function"&&(U.prototype[Symbol.asyncIterator]=function(){return sn===void 0&&(sn=tu),sn(this)});Object.defineProperty(U.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}});Object.defineProperty(U.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}});Object.defineProperty(U.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}});U._fromList=To;Object.defineProperty(U.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function To(t,e){if(e.length===0)return null;var r;return e.objectMode?r=e.buffer.shift():!t||t>=e.length?(e.decoder?r=e.buffer.join(""):e.buffer.length===1?r=e.buffer.first():r=e.buffer.concat(e.length),e.buffer.clear()):r=e.buffer.consume(t,e.decoder),r}function un(t){var e=t._readableState;O("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,process.nextTick(Eu,e,t))}function Eu(t,e){if(O("endReadableNT",t.endEmitted,t.length),!t.endEmitted&&t.length===0&&(t.endEmitted=!0,e.readable=!1,e.emit("end"),t.autoDestroy)){var r=e._writableState;(!r||r.autoDestroy&&r.finished)&&e.destroy()}}typeof Symbol=="function"&&(U.from=function(t,e){return an===void 0&&(an=ru),an(U,t,e)});function Co(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}var Ao=$e,Ur=ht.codes,Su=Ur.ERR_METHOD_NOT_IMPLEMENTED,Tu=Ur.ERR_MULTIPLE_CALLBACK,Cu=Ur.ERR_TRANSFORM_ALREADY_TRANSFORMING,Au=Ur.ERR_TRANSFORM_WITH_LENGTH_0,Fr=Mt;Oe.exports($e,Fr);function ku(t,e){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(n===null)return this.emit("error",new Tu);r.writechunk=null,r.writecb=null,e!=null&&this.push(e),n(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function $e(t){if(!(this instanceof $e))return new $e(t);Fr.call(this,t),this._transformState={afterTransform:ku.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",Iu)}function Iu(){var t=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,r){ki(t,e,r)}):ki(this,null,null)}$e.prototype.push=function(t,e){return this._transformState.needTransform=!1,Fr.prototype.push.call(this,t,e)};$e.prototype._transform=function(t,e,r){r(new Su("_transform()"))};$e.prototype._write=function(t,e,r){var n=this._transformState;if(n.writecb=r,n.writechunk=t,n.writeencoding=e,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}};$e.prototype._read=function(t){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};$e.prototype._destroy=function(t,e){Fr.prototype._destroy.call(this,t,function(r){e(r)})};function ki(t,e,r){if(e)return t.emit("error",e);if(r!=null&&t.push(r),t._writableState.length)throw new Au;if(t._transformState.transforming)throw new Cu;return t.push(null)}var xu=Ht,ko=Ao;Oe.exports(Ht,ko);function Ht(t){if(!(this instanceof Ht))return new Ht(t);ko.call(this,t)}Ht.prototype._transform=function(t,e,r){r(null,t)};var cn;function Bu(t){var e=!1;return function(){e||(e=!0,t.apply(void 0,arguments))}}var Io=ht.codes,Ru=Io.ERR_MISSING_ARGS,Pu=Io.ERR_STREAM_DESTROYED;function Ii(t){if(t)throw t}function Mu(t){return t.setHeader&&typeof t.abort=="function"}function Ou(t,e,r,n){n=Bu(n);var i=!1;t.on("close",function(){i=!0}),cn===void 0&&(cn=$n),cn(t,{readable:e,writable:r},function(s){if(s)return n(s);i=!0,n()});var o=!1;return function(s){if(!i&&!o){if(o=!0,Mu(t))return t.abort();if(typeof t.destroy=="function")return t.destroy();n(s||new Pu("pipe"))}}}function xi(t){t()}function Lu(t,e){return t.pipe(e)}function Du(t){return!t.length||typeof t[t.length-1]!="function"?Ii:t.pop()}function Uu(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=Du(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new Ru("streams");var i,o=e.map(function(s,a){var f=a<e.length-1,l=a>0;return Ou(s,f,l,function(d){i||(i=d),d&&o.forEach(xi),!f&&(o.forEach(xi),n(i))})});return e.reduce(Lu)}var Fu=Uu;(function(t,e){e=t.exports=bo,e.Stream=e,e.Readable=e,e.Writable=uo,e.Duplex=Mt,e.Transform=Ao,e.PassThrough=xu,e.finished=$n,e.pipeline=Fu})(We,We.exports);const Nu=Fn,ju=We.exports.Readable,qu={objectMode:!0},Wu={clean:!0};function Ze(t){if(!(this instanceof Ze))return new Ze(t);this.options=t||{},this.options=Nu(Wu,t),this._inflights=new Map}Ze.prototype.put=function(t,e){return this._inflights.set(t.messageId,t),e&&e(),this};Ze.prototype.createStream=function(){const t=new ju(qu),e=[];let r=!1,n=0;return this._inflights.forEach(function(i,o){e.push(i)}),t._read=function(){!r&&n<e.length?this.push(e[n++]):this.push(null)},t.destroy=function(){if(r)return;const i=this;r=!0,setTimeout(function(){i.emit("close")},0)},t};Ze.prototype.del=function(t,e){return t=this._inflights.get(t.messageId),t?(this._inflights.delete(t.messageId),e(null,t)):e&&e(new Error("missing packet")),this};Ze.prototype.get=function(t,e){return t=this._inflights.get(t.messageId),t?e(null,t):e&&e(new Error("missing packet")),this};Ze.prototype.close=function(t){this.options.clean&&(this._inflights=null),t&&t()};var xo=Ze;function kt(t){if(!(this instanceof kt))return new kt(t);this.aliasToTopic={},this.max=t}kt.prototype.put=function(t,e){return e===0||e>this.max?!1:(this.aliasToTopic[e]=t,this.length=Object.keys(this.aliasToTopic).length,!0)};kt.prototype.getTopicByAlias=function(t){return this.aliasToTopic[t]};kt.prototype.clear=function(){this.aliasToTopic={}};var $u=kt,zu=N;N.Node=ft;N.create=N;function N(t){var e=this;if(e instanceof N||(e=new N),e.tail=null,e.head=null,e.length=0,t&&typeof t.forEach=="function")t.forEach(function(i){e.push(i)});else if(arguments.length>0)for(var r=0,n=arguments.length;r<n;r++)e.push(arguments[r]);return e}N.prototype.removeNode=function(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,r=t.prev;return e&&(e.prev=r),r&&(r.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=r),t.list.length--,t.next=null,t.prev=null,t.list=null,e};N.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}};N.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}};N.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++)Hu(this,arguments[t]);return this.length};N.prototype.unshift=function(){for(var t=0,e=arguments.length;t<e;t++)Ku(this,arguments[t]);return this.length};N.prototype.pop=function(){if(!!this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}};N.prototype.shift=function(){if(!!this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}};N.prototype.forEach=function(t,e){e=e||this;for(var r=this.head,n=0;r!==null;n++)t.call(e,r.value,n,this),r=r.next};N.prototype.forEachReverse=function(t,e){e=e||this;for(var r=this.tail,n=this.length-1;r!==null;n--)t.call(e,r.value,n,this),r=r.prev};N.prototype.get=function(t){for(var e=0,r=this.head;r!==null&&e<t;e++)r=r.next;if(e===t&&r!==null)return r.value};N.prototype.getReverse=function(t){for(var e=0,r=this.tail;r!==null&&e<t;e++)r=r.prev;if(e===t&&r!==null)return r.value};N.prototype.map=function(t,e){e=e||this;for(var r=new N,n=this.head;n!==null;)r.push(t.call(e,n.value,this)),n=n.next;return r};N.prototype.mapReverse=function(t,e){e=e||this;for(var r=new N,n=this.tail;n!==null;)r.push(t.call(e,n.value,this)),n=n.prev;return r};N.prototype.reduce=function(t,e){var r,n=this.head;if(arguments.length>1)r=e;else if(this.head)n=this.head.next,r=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=0;n!==null;i++)r=t(r,n.value,i),n=n.next;return r};N.prototype.reduceReverse=function(t,e){var r,n=this.tail;if(arguments.length>1)r=e;else if(this.tail)n=this.tail.prev,r=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=this.length-1;n!==null;i--)r=t(r,n.value,i),n=n.prev;return r};N.prototype.toArray=function(){for(var t=new Array(this.length),e=0,r=this.head;r!==null;e++)t[e]=r.value,r=r.next;return t};N.prototype.toArrayReverse=function(){for(var t=new Array(this.length),e=0,r=this.tail;r!==null;e++)t[e]=r.value,r=r.prev;return t};N.prototype.slice=function(t,e){e=e||this.length,e<0&&(e+=this.length),t=t||0,t<0&&(t+=this.length);var r=new N;if(e<t||e<0)return r;t<0&&(t=0),e>this.length&&(e=this.length);for(var n=0,i=this.head;i!==null&&n<t;n++)i=i.next;for(;i!==null&&n<e;n++,i=i.next)r.push(i.value);return r};N.prototype.sliceReverse=function(t,e){e=e||this.length,e<0&&(e+=this.length),t=t||0,t<0&&(t+=this.length);var r=new N;if(e<t||e<0)return r;t<0&&(t=0),e>this.length&&(e=this.length);for(var n=this.length,i=this.tail;i!==null&&n>e;n--)i=i.prev;for(;i!==null&&n>t;n--,i=i.prev)r.push(i.value);return r};N.prototype.splice=function(t,e,...r){t>this.length&&(t=this.length-1),t<0&&(t=this.length+t);for(var n=0,i=this.head;i!==null&&n<t;n++)i=i.next;for(var o=[],n=0;i&&n<e;n++)o.push(i.value),i=this.removeNode(i);i===null&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev);for(var n=0;n<r.length;n++)i=Vu(this,i,r[n]);return o};N.prototype.reverse=function(){for(var t=this.head,e=this.tail,r=t;r!==null;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=e,this.tail=t,this};function Vu(t,e,r){var n=e===t.head?new ft(r,null,e,t):new ft(r,e,e.next,t);return n.next===null&&(t.tail=n),n.prev===null&&(t.head=n),t.length++,n}function Hu(t,e){t.tail=new ft(e,t.tail,null,t),t.head||(t.head=t.tail),t.length++}function Ku(t,e){t.head=new ft(e,null,t.head,t),t.tail||(t.tail=t.head),t.length++}function ft(t,e,r,n){if(!(this instanceof ft))return new ft(t,e,r,n);this.list=n,this.value=t,e?(e.next=this,this.prev=e):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}try{require("./iterator.js")(N)}catch{}const Gu=zu,it=Symbol("max"),Ne=Symbol("length"),gt=Symbol("lengthCalculator"),qt=Symbol("allowStale"),lt=Symbol("maxAge"),Ue=Symbol("dispose"),Bi=Symbol("noDisposeOnSet"),X=Symbol("lruList"),Se=Symbol("cache"),Bo=Symbol("updateAgeOnGet"),hn=()=>1;class Qu{constructor(e){if(typeof e=="number"&&(e={max:e}),e||(e={}),e.max&&(typeof e.max!="number"||e.max<0))throw new TypeError("max must be a non-negative number");this[it]=e.max||1/0;const r=e.length||hn;if(this[gt]=typeof r!="function"?hn:r,this[qt]=e.stale||!1,e.maxAge&&typeof e.maxAge!="number")throw new TypeError("maxAge must be a number");this[lt]=e.maxAge||0,this[Ue]=e.dispose,this[Bi]=e.noDisposeOnSet||!1,this[Bo]=e.updateAgeOnGet||!1,this.reset()}set max(e){if(typeof e!="number"||e<0)throw new TypeError("max must be a non-negative number");this[it]=e||1/0,Dt(this)}get max(){return this[it]}set allowStale(e){this[qt]=!!e}get allowStale(){return this[qt]}set maxAge(e){if(typeof e!="number")throw new TypeError("maxAge must be a non-negative number");this[lt]=e,Dt(this)}get maxAge(){return this[lt]}set lengthCalculator(e){typeof e!="function"&&(e=hn),e!==this[gt]&&(this[gt]=e,this[Ne]=0,this[X].forEach(r=>{r.length=this[gt](r.value,r.key),this[Ne]+=r.length})),Dt(this)}get lengthCalculator(){return this[gt]}get length(){return this[Ne]}get itemCount(){return this[X].length}rforEach(e,r){r=r||this;for(let n=this[X].tail;n!==null;){const i=n.prev;Ri(this,e,n,r),n=i}}forEach(e,r){r=r||this;for(let n=this[X].head;n!==null;){const i=n.next;Ri(this,e,n,r),n=i}}keys(){return this[X].toArray().map(e=>e.key)}values(){return this[X].toArray().map(e=>e.value)}reset(){this[Ue]&&this[X]&&this[X].length&&this[X].forEach(e=>this[Ue](e.key,e.value)),this[Se]=new Map,this[X]=new Gu,this[Ne]=0}dump(){return this[X].map(e=>vr(this,e)?!1:{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[X]}set(e,r,n){if(n=n||this[lt],n&&typeof n!="number")throw new TypeError("maxAge must be a number");const i=n?Date.now():0,o=this[gt](r,e);if(this[Se].has(e)){if(o>this[it])return _t(this,this[Se].get(e)),!1;const f=this[Se].get(e).value;return this[Ue]&&(this[Bi]||this[Ue](e,f.value)),f.now=i,f.maxAge=n,f.value=r,this[Ne]+=o-f.length,f.length=o,this.get(e),Dt(this),!0}const s=new Yu(e,r,o,i,n);return s.length>this[it]?(this[Ue]&&this[Ue](e,r),!1):(this[Ne]+=s.length,this[X].unshift(s),this[Se].set(e,this[X].head),Dt(this),!0)}has(e){if(!this[Se].has(e))return!1;const r=this[Se].get(e).value;return!vr(this,r)}get(e){return pn(this,e,!0)}peek(e){return pn(this,e,!1)}pop(){const e=this[X].tail;return e?(_t(this,e),e.value):null}del(e){_t(this,this[Se].get(e))}load(e){this.reset();const r=Date.now();for(let n=e.length-1;n>=0;n--){const i=e[n],o=i.e||0;if(o===0)this.set(i.k,i.v);else{const s=o-r;s>0&&this.set(i.k,i.v,s)}}}prune(){this[Se].forEach((e,r)=>pn(this,r,!1))}}const pn=(t,e,r)=>{const n=t[Se].get(e);if(n){const i=n.value;if(vr(t,i)){if(_t(t,n),!t[qt])return}else r&&(t[Bo]&&(n.value.now=Date.now()),t[X].unshiftNode(n));return i.value}},vr=(t,e)=>{if(!e||!e.maxAge&&!t[lt])return!1;const r=Date.now()-e.now;return e.maxAge?r>e.maxAge:t[lt]&&r>t[lt]},Dt=t=>{if(t[Ne]>t[it])for(let e=t[X].tail;t[Ne]>t[it]&&e!==null;){const r=e.prev;_t(t,e),e=r}},_t=(t,e)=>{if(e){const r=e.value;t[Ue]&&t[Ue](r.key,r.value),t[Ne]-=r.length,t[Se].delete(r.key),t[X].removeNode(e)}};class Yu{constructor(e,r,n,i,o){this.key=e,this.value=r,this.length=n,this.now=i,this.maxAge=o||0}}const Ri=(t,e,r,n)=>{let i=r.value;vr(t,i)&&(_t(t,r),t[qt]||(i=void 0)),i&&e.call(n,i.value,i.key,t)};var Xu=Qu,Ro={},Zu=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(d){return f([l,d])}}function f(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},Ju=globalThis&&globalThis.__read||function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},ec=globalThis&&globalThis.__spreadArray||function(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))},tc=globalThis&&globalThis.__values||function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};function Po(t){var e=this;t===void 0&&(t=[]);var r=0,n=[];this.size=function(){return r},this.empty=function(){return r===0},this.clear=function(){r=0,n.length=0},this.front=function(){if(!this.empty())return n[0]},this.back=function(){if(!this.empty())return n[r-1]},this.forEach=function(i){n.forEach(i)},this.getElementByPos=function(i){if(i<0||i>=r)throw new Error("pos must more than 0 and less than vector's size");return n[i]},this.eraseElementByPos=function(i){if(i<0||i>=r)throw new Error("pos must more than 0 and less than vector's size");for(var o=i;o<r-1;++o)n[o]=n[o+1];this.popBack()},this.eraseElementByValue=function(i){var o=[];this.forEach(function(a){a!==i&&o.push(a)}),o.forEach(function(a,f){n[f]=a});for(var s=o.length;r>s;)this.popBack()},this.pushBack=function(i){n.push(i),++r},this.popBack=function(){n.pop(),r>0&&--r},this.setElementByPos=function(i,o){if(i<0||i>=r)throw new Error("pos must more than 0 and less than vector's size");n[i]=o},this.insert=function(i,o,s){if(s===void 0&&(s=1),i<0||i>r)throw new Error("pos must more than 0 and less than or equal to vector's size");n.splice.apply(n,ec([i,0],Ju(new Array(s).fill(o)),!1)),r+=s},this.find=function(i){return n.includes(i)},this.reverse=function(){n.reverse()},this.unique=function(){var i,o=[];this.forEach(function(a,f){(f===0||a!==i)&&(o.push(a),i=a)}),o.forEach(function(a,f){n[f]=a});for(var s=o.length;r>s;)this.popBack()},this.sort=function(i){n.sort(i)},this[Symbol.iterator]=function(){return function(){return Zu(this,function(i){switch(i.label){case 0:return[5,tc(n)];case 1:return[2,i.sent()]}})}()},t.forEach(function(i){return e.pushBack(i)}),Object.freeze(this)}Object.freeze(Po);function Mo(t){var e=this;t===void 0&&(t=[]);var r=0,n=[];this.size=function(){return r},this.empty=function(){return r===0},this.clear=function(){r=0,n.length=0},this.push=function(i){n.push(i),++r},this.pop=function(){n.pop(),r>0&&--r},this.top=function(){return n[r-1]},t.forEach(function(i){return e.push(i)}),Object.freeze(this)}Object.freeze(Mo);var rc=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(d){return f([l,d])}}function f(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},or=function(){function t(e){this.value=void 0,this.pre=void 0,this.next=void 0,this.value=e}return t}();function Q(t){var e=this;t===void 0&&(t=[]);var r=0,n=void 0,i=void 0;this.size=function(){return r},this.empty=function(){return r===0},this.clear=function(){n=i=void 0,r=0},this.front=function(){return n==null?void 0:n.value},this.back=function(){return i==null?void 0:i.value},this.forEach=function(o){for(var s=n,a=0;s;){if(s.value===void 0)throw new Error("unknown error");o(s.value,a++),s=s.next}},this.getElementByPos=function(o){if(o<0||o>=r)throw new Error("pos must more then 0 and less then the list length");for(var s=n;o--&&s;)s=s.next;if(!s||s.value===void 0)throw new Error("unknown error");return s.value},this.eraseElementByPos=function(o){if(o<0||o>=r)throw new Error("erase pos must more then 0 and less then the list length");if(o===0)this.popFront();else if(o===r-1)this.popBack();else{for(var s=n;o--;){if(!(s!=null&&s.next))throw new Error("unknown error");s=s.next}if(!s||!s.pre||!s.next)throw new Error("unknown error");var a=s.pre,f=s.next;f.pre=a,a.next=f,r>0&&--r}},this.eraseElementByValue=function(o){for(;n&&n.value===o;)this.popFront();for(;i&&i.value===o;)this.popBack();if(!!n)for(var s=n;s;){if(s.value===o){var a=s.pre,f=s.next;f&&(f.pre=a),a&&(a.next=f),r>0&&--r}s=s.next}},this.pushBack=function(o){if(o==null)throw new Error("you can't push null or undefined here");++r;var s=new or(o);i?(i.next=s,s.pre=i,i=s):n=i=s},this.popBack=function(){!i||(r>0&&--r,i&&(n===i?n=i=void 0:(i=i.pre,i&&(i.next=void 0))))},this.setElementByPos=function(o,s){if(s==null)throw new Error("you can't set null or undefined here");if(o<0||o>=r)throw new Error("pos must more then 0 and less then the list length");for(var a=n;o--;){if(!a)throw new Error("unknown error");a=a.next}a&&(a.value=s)},this.insert=function(o,s,a){if(a===void 0&&(a=1),s==null)throw new Error("you can't insert null or undefined here");if(o<0||o>r)throw new Error("insert pos must more then 0 and less then or equal to the list length");if(a<0)throw new Error("insert size must more than 0");if(o===0)for(;a--;)this.pushFront(s);else if(o===r)for(;a--;)this.pushBack(s);else{for(var f=n,l=1;l<o;++l){if(!(f!=null&&f.next))throw new Error("unknown error");f=f==null?void 0:f.next}if(!f)throw new Error("unknown error");var d=f.next;for(r+=a;a--;)f.next=new or(s),f.next.pre=f,f=f.next;f.next=d,d&&(d.pre=f)}},this.find=function(o){for(var s=n;s;){if(s.value===o)return!0;s=s.next}return!1},this.reverse=function(){for(var o=n,s=i,a=0;o&&s&&a*2<r;){var f=o.value;o.value=s.value,s.value=f,o=o.next,s=s.pre,++a}},this.unique=function(){for(var o=n;o;){for(var s=o;s&&s.next&&s.value===s.next.value;)s=s.next,r>0&&--r;o.next=s.next,o.next&&(o.next.pre=o),o=o.next}},this.sort=function(o){var s=[];this.forEach(function(f){s.push(f)}),s.sort(o);var a=n;s.forEach(function(f){a&&(a.value=f,a=a.next)})},this.pushFront=function(o){if(o==null)throw new Error("you can't push null or undefined here");++r;var s=new or(o);n?(s.next=n,n.pre=s,n=s):n=i=s},this.popFront=function(){!n||(r>0&&--r,n&&(n===i?n=i=void 0:(n=n.next,n&&(n.pre=void 0))))},this.merge=function(o){var s=this,a=n;o.forEach(function(f){for(;a&&a.value!==void 0&&a.value<=f;)a=a.next;if(a===void 0)s.pushBack(f),a=i;else if(a===n)s.pushFront(f),a=n;else{++r;var l=a.pre;l&&(l.next=new or(f),l.next.pre=l,l.next.next=a,a&&(a.pre=l.next))}})},this[Symbol.iterator]=function(){return function(){var o;return rc(this,function(s){switch(s.label){case 0:o=n,s.label=1;case 1:if(o===void 0)return[3,3];if(!o.value)throw new Error("unknown error");return[4,o.value];case 2:return s.sent(),o=o.next,[3,1];case 3:return[2]}})}()},t.forEach(function(o){return e.pushBack(o)}),Object.freeze(this)}Object.freeze(Q);function Oo(t){t===void 0&&(t=[]);var e=new Q(t);this.size=function(){return e.size()},this.empty=function(){return e.empty()},this.clear=function(){e.clear()},this.push=function(r){e.pushBack(r)},this.pop=function(){e.popFront()},this.front=function(){return e.front()},Object.freeze(this)}Object.freeze(Oo);var nc=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(d){return f([l,d])}}function f(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};F.sigma=3;F.bucketSize=5e3;function F(t){var e=this;t===void 0&&(t=[]);var r=[],n=0,i=0,o=0,s=0,a=0,f=0;this.size=function(){return f},this.empty=function(){return f===0},this.clear=function(){n=o=i=s=a=f=0,d.call(this,F.bucketSize),f=0},this.front=function(){return r[n][i]},this.back=function(){return r[o][s]},this.forEach=function(p){if(!this.empty()){var y=0;if(n===o){for(var w=i;w<=s;++w)p(r[n][w],y++);return}for(var w=i;w<F.bucketSize;++w)p(r[n][w],y++);for(var w=n+1;w<o;++w)for(var S=0;S<F.bucketSize;++S)p(r[w][S],y++);for(var w=0;w<=s;++w)p(r[o][w],y++)}};var l=function(p){var y=n*F.bucketSize+i,w=y+p,S=o*F.bucketSize+s;if(w<y||w>S)throw new Error("pos should more than 0 and less than queue's size");var _=Math.floor(w/F.bucketSize),C=w%F.bucketSize;return{curNodeBucketIndex:_,curNodePointerIndex:C}};this.getElementByPos=function(p){var y=l(p),w=y.curNodeBucketIndex,S=y.curNodePointerIndex;return r[w][S]},this.eraseElementByPos=function(p){var y=this;if(p<0||p>f)throw new Error("pos should more than 0 and less than queue's size");if(p===0)this.popFront();else if(p===this.size())this.popBack();else{for(var w=[],S=p+1;S<f;++S)w.push(this.getElementByPos(S));this.cut(p),this.popBack(),w.forEach(function(_){return y.pushBack(_)})}},this.eraseElementByValue=function(p){if(!this.empty()){var y=[];this.forEach(function(_){_!==p&&y.push(_)});for(var w=y.length,S=0;S<w;++S)this.setElementByPos(S,y[S]);this.cut(w-1)}};var d=function(p){for(var y=[],w=p*F.sigma,S=Math.max(Math.ceil(w/F.bucketSize),2),_=0;_<S;++_)y.push(new Array(F.bucketSize));var C=Math.ceil(p/F.bucketSize),x=Math.floor(S/2)-Math.floor(C/2),h=x,g=0;if(this.size())for(var _=0;_<C;++_){for(var m=0;m<F.bucketSize;++m)if(y[x+_][m]=this.front(),this.popFront(),this.empty()){h=x+_,g=m;break}if(this.empty())break}r=y,n=x,i=0,o=h,s=g,a=S,f=p};this.pushBack=function(p){this.empty()||(o===a-1&&s===F.bucketSize-1&&d.call(this,this.size()),s<F.bucketSize-1?++s:o<a-1&&(++o,s=0)),++f,r[o][s]=p},this.popBack=function(){this.empty()||(this.size()!==1&&(s>0?--s:n<o&&(--o,s=F.bucketSize-1)),f>0&&--f)},this.setElementByPos=function(p,y){var w=l(p),S=w.curNodeBucketIndex,_=w.curNodePointerIndex;r[S][_]=y},this.insert=function(p,y,w){var S=this;if(w===void 0&&(w=1),p===0)for(;w--;)this.pushFront(y);else if(p===this.size())for(;w--;)this.pushBack(y);else{for(var _=[],C=p;C<f;++C)_.push(this.getElementByPos(C));this.cut(p-1);for(var C=0;C<w;++C)this.pushBack(y);_.forEach(function(x){return S.pushBack(x)})}},this.find=function(p){if(n===o){for(var y=i;y<=s;++y)if(r[n][y]===p)return!0;return!1}for(var y=i;y<F.bucketSize;++y)if(r[n][y]===p)return!0;for(var y=n+1;y<o;++y)for(var w=0;w<F.bucketSize;++w)if(r[y][w]===p)return!0;for(var y=0;y<=s;++y)if(r[o][y]===p)return!0;return!1},this.reverse=function(){for(var p=0,y=f-1;p<y;){var w=this.getElementByPos(p);this.setElementByPos(p,this.getElementByPos(y)),this.setElementByPos(y,w),++p,--y}},this.unique=function(){if(!this.empty()){var p=[],y=this.front();this.forEach(function(S,_){(_===0||S!==y)&&(p.push(S),y=S)});for(var w=0;w<f;++w)this.setElementByPos(w,p[w]);this.cut(p.length-1)}},this.sort=function(p){var y=[];this.forEach(function(S){y.push(S)}),y.sort(p);for(var w=0;w<f;++w)this.setElementByPos(w,y[w])},this.pushFront=function(p){this.empty()||(n===0&&i===0&&d.call(this,this.size()),i>0?--i:n>0&&(--n,i=F.bucketSize-1)),++f,r[n][i]=p},this.popFront=function(){this.empty()||(this.size()!==1&&(i<F.bucketSize-1?++i:n<o&&(++n,i=0)),f>0&&--f)},this.shrinkToFit=function(){var p=this,y=[];this.forEach(function(C){y.push(C)});var w=y.length;r=[];for(var S=Math.ceil(w/F.bucketSize),_=0;_<S;++_)r.push(new Array(F.bucketSize));this.clear(),y.forEach(function(C){return p.pushBack(C)})},this.cut=function(p){if(p<0){this.clear();return}var y=l(p),w=y.curNodeBucketIndex,S=y.curNodePointerIndex;o=w,s=S,f=p+1},this[Symbol.iterator]=function(){return function(){var y,y,y,p,y;return nc(this,function(w){switch(w.label){case 0:if(f===0)return[2];if(n!==o)return[3,5];y=i,w.label=1;case 1:return y<=s?[4,r[n][y]]:[3,4];case 2:w.sent(),w.label=3;case 3:return++y,[3,1];case 4:return[2];case 5:y=i,w.label=6;case 6:return y<F.bucketSize?[4,r[n][y]]:[3,9];case 7:w.sent(),w.label=8;case 8:return++y,[3,6];case 9:y=n+1,w.label=10;case 10:if(!(y<o))return[3,15];p=0,w.label=11;case 11:return p<F.bucketSize?[4,r[y][p]]:[3,14];case 12:w.sent(),w.label=13;case 13:return++p,[3,11];case 14:return++y,[3,10];case 15:y=0,w.label=16;case 16:return y<=s?[4,r[o][y]]:[3,19];case 17:w.sent(),w.label=18;case 18:return++y,[3,16];case 19:return[2]}})}()},function(){var p=F.bucketSize;t.size?p=t.size():t.length&&(p=t.length);var y=p*F.sigma;a=Math.ceil(y/F.bucketSize),a=Math.max(a,3);for(var w=0;w<a;++w)r.push(new Array(F.bucketSize));var S=Math.ceil(p/F.bucketSize);n=Math.floor(a/2)-Math.floor(S/2),o=n,t.forEach(function(_){return e.pushBack(_)})}(),Object.freeze(this)}Object.freeze(F);function Lo(t,e){t===void 0&&(t=[]),e=e||function(s,a){return s>a?-1:s<a?1:0};var r=[];t.forEach(function(s){return r.push(s)});var n=r.length,i=function(s,a){if(s<0||s>=n)throw new Error("unknown error");if(a<0||a>=n)throw new Error("unknown error");var f=r[s];r[s]=r[a],r[a]=f},o=function(s){if(s<0||s>=n)throw new Error("unknown error");var a=s*2+1,f=s*2+2;a<n&&e(r[s],r[a])>0&&i(s,a),f<n&&e(r[s],r[f])>0&&i(s,f)};(function(){for(var s=Math.floor((n-1)/2);s>=0;--s)for(var a=s,f=a*2+1;f<n;){var l=f,d=l+1,p=l;if(d<n&&e(r[l],r[d])>0&&(p=d),e(r[a],r[p])<=0)break;i(a,p),a=p,f=a*2+1}})(),this.size=function(){return n},this.empty=function(){return n===0},this.clear=function(){n=0,r.length=0},this.push=function(s){if(r.push(s),++n,n!==1)for(var a=n-1;a>0;){var f=Math.floor((a-1)/2);if(e(r[f],s)<=0)break;o(f),a=f}},this.pop=function(){if(!this.empty()){if(this.size()===1){--n;return}var s=r[n-1];--n;for(var a=0;a<this.size();){var f=a*2+1,l=a*2+2;if(f>=this.size())break;var d=f;if(l<this.size()&&e(r[f],r[l])>0&&(d=l),e(r[d],s)>=0)break;r[a]=r[d],a=d}r[a]=s}},this.top=function(){return r[0]},Object.freeze(this)}Object.freeze(Lo);var k=function(){function t(e,r){this.color=!0,this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0,this.leftChild=void 0,this.rightChild=void 0,this.key=e,this.value=r}return t.prototype.rotateLeft=function(){var e=this.parent,r=this.brother,n=this.leftChild,i=this.rightChild;if(!i)throw new Error("unknown error");var o=i.leftChild,s=i.rightChild;return e&&(e.leftChild===this?e.leftChild=i:e.rightChild===this&&(e.rightChild=i)),i.parent=e,i.brother=r,i.leftChild=this,i.rightChild=s,r&&(r.brother=i),this.parent=i,this.brother=s,this.leftChild=n,this.rightChild=o,s&&(s.parent=i,s.brother=this),n&&(n.parent=this,n.brother=o),o&&(o.parent=this,o.brother=n),i},t.prototype.rotateRight=function(){var e=this.parent,r=this.brother,n=this.leftChild;if(!n)throw new Error("unknown error");var i=this.rightChild,o=n.leftChild,s=n.rightChild;return e&&(e.leftChild===this?e.leftChild=n:e.rightChild===this&&(e.rightChild=n)),n.parent=e,n.brother=r,n.leftChild=o,n.rightChild=this,r&&(r.brother=n),o&&(o.parent=n,o.brother=this),this.parent=n,this.brother=o,this.leftChild=s,this.rightChild=i,s&&(s.parent=this,s.brother=i),i&&(i.parent=this,i.brother=s),n},t.prototype.remove=function(){if(this.leftChild||this.rightChild)throw new Error("can only remove leaf node");this.parent&&(this===this.parent.leftChild?this.parent.leftChild=void 0:this===this.parent.rightChild&&(this.parent.rightChild=void 0)),this.brother&&(this.brother.brother=void 0),this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0},t.TreeNodeColorType={red:!0,black:!1},t}();Object.freeze(k);var ic=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(d){return f([l,d])}}function f(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},sr=globalThis&&globalThis.__values||function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};function ot(t,e){var r=this;t===void 0&&(t=[]),e=e||function(h,g){return h<g?-1:h>g?1:0};var n=0,i=new k;i.color=k.TreeNodeColorType.black,this.size=function(){return n},this.empty=function(){return n===0},this.clear=function(){n=0,i.key=void 0,i.leftChild=i.rightChild=i.brother=i.parent=void 0,i.color=k.TreeNodeColorType.black};var o=function(h){if(!h||h.key===void 0)throw new Error("unknown error");return h.leftChild?o(h.leftChild):h},s=function(h){if(!h||h.key===void 0)throw new Error("unknown error");return h.rightChild?s(h.rightChild):h};this.front=function(){if(!this.empty()){var h=o(i);return h.key}},this.back=function(){if(!this.empty()){var h=s(i);return h.key}},this.forEach=function(h){var g,m,A=0;try{for(var R=sr(this),j=R.next();!j.done;j=R.next()){var H=j.value;h(H,A++)}}catch(Ee){g={error:Ee}}finally{try{j&&!j.done&&(m=R.return)&&m.call(R)}finally{if(g)throw g.error}}},this.getElementByPos=function(h){var g,m;if(h<0||h>=this.size())throw new Error("pos must more than 0 and less than set's size");var A=0;try{for(var R=sr(this),j=R.next();!j.done;j=R.next()){var H=j.value;if(A===h)return H;++A}}catch(Ee){g={error:Ee}}finally{try{j&&!j.done&&(m=R.return)&&m.call(R)}finally{if(g)throw g.error}}throw new Error("unknown error")};var a=function(h){var g=h.parent;if(!g){if(h===i)return;throw new Error("unknown error")}if(h.color===k.TreeNodeColorType.red){h.color=k.TreeNodeColorType.black;return}var m=h.brother;if(!m)throw new Error("unknown error");if(h===g.leftChild){if(m.color===k.TreeNodeColorType.red){m.color=k.TreeNodeColorType.black,g.color=k.TreeNodeColorType.red;var A=g.rotateLeft();i===g&&(i=A),a(h)}else if(m.color===k.TreeNodeColorType.black)if(m.rightChild&&m.rightChild.color===k.TreeNodeColorType.red){m.color=g.color,g.color=k.TreeNodeColorType.black,m.rightChild&&(m.rightChild.color=k.TreeNodeColorType.black);var A=g.rotateLeft();i===g&&(i=A),h.color=k.TreeNodeColorType.black}else if((!m.rightChild||m.rightChild.color===k.TreeNodeColorType.black)&&m.leftChild&&m.leftChild.color===k.TreeNodeColorType.red){m.color=k.TreeNodeColorType.red,m.leftChild&&(m.leftChild.color=k.TreeNodeColorType.black);var A=m.rotateRight();i===m&&(i=A),a(h)}else(!m.leftChild||m.leftChild.color===k.TreeNodeColorType.black)&&(!m.rightChild||m.rightChild.color===k.TreeNodeColorType.black)&&(m.color=k.TreeNodeColorType.red,a(g))}else if(h===g.rightChild){if(m.color===k.TreeNodeColorType.red){m.color=k.TreeNodeColorType.black,g.color=k.TreeNodeColorType.red;var A=g.rotateRight();i===g&&(i=A),a(h)}else if(m.color===k.TreeNodeColorType.black)if(m.leftChild&&m.leftChild.color===k.TreeNodeColorType.red){m.color=g.color,g.color=k.TreeNodeColorType.black,m.leftChild&&(m.leftChild.color=k.TreeNodeColorType.black);var A=g.rotateRight();i===g&&(i=A),h.color=k.TreeNodeColorType.black}else if((!m.leftChild||m.leftChild.color===k.TreeNodeColorType.black)&&m.rightChild&&m.rightChild.color===k.TreeNodeColorType.red){m.color=k.TreeNodeColorType.red,m.rightChild&&(m.rightChild.color=k.TreeNodeColorType.black);var A=m.rotateLeft();i===m&&(i=A),a(h)}else(!m.leftChild||m.leftChild.color===k.TreeNodeColorType.black)&&(!m.rightChild||m.rightChild.color===k.TreeNodeColorType.black)&&(m.color=k.TreeNodeColorType.red,a(g))}},f=function(h){for(var g=h;g.leftChild||g.rightChild;){if(g.rightChild){g=o(g.rightChild);var m=h.key;h.key=g.key,g.key=m,h=g}if(g.leftChild){g=s(g.leftChild);var m=h.key;h.key=g.key,g.key=m,h=g}}a(g),g&&g.remove(),--n,i.color=k.TreeNodeColorType.black},l=function(h,g){if(!h||h.key===void 0)return!1;var m=l(h.leftChild,g);return m||g(h)?!0:l(h.rightChild,g)};this.eraseElementByPos=function(h){if(h<0||h>=n)throw new Error("pos must more than 0 and less than set's size");var g=0;l(i,function(m){return h===g?(f(m),!0):(++g,!1)})},this.eraseElementByValue=function(h){if(!this.empty()){var g=y(i,h);g===void 0||g.key===void 0||e(g.key,h)!==0||f(g)}};var d=function(h,g){if(!h||h.key===void 0)throw new Error("unknown error");var m=e(g,h.key);return m<0?h.leftChild?d(h.leftChild,g):(h.leftChild=new k,h.leftChild.parent=h,h.leftChild.brother=h.rightChild,h.rightChild&&(h.rightChild.brother=h.leftChild),h.leftChild):m>0?h.rightChild?d(h.rightChild,g):(h.rightChild=new k,h.rightChild.parent=h,h.rightChild.brother=h.leftChild,h.leftChild&&(h.leftChild.brother=h.rightChild),h.rightChild):h},p=function(h){var g=h.parent;if(!g){if(h===i)return;throw new Error("unknown error")}if(g.color!==k.TreeNodeColorType.black&&g.color===k.TreeNodeColorType.red){var m=g.brother,A=g.parent;if(!A)throw new Error("unknown error");if(m&&m.color===k.TreeNodeColorType.red)m.color=g.color=k.TreeNodeColorType.black,A.color=k.TreeNodeColorType.red,p(A);else if(!m||m.color===k.TreeNodeColorType.black){if(g===A.leftChild){if(h===g.leftChild){g.color=k.TreeNodeColorType.black,A.color=k.TreeNodeColorType.red;var R=A.rotateRight();A===i&&(i=R)}else if(h===g.rightChild){var R=g.rotateLeft();A===i&&(i=R),p(g)}}else if(g===A.rightChild){if(h===g.leftChild){var R=g.rotateRight();A===i&&(i=R),p(g)}else if(h===g.rightChild){g.color=k.TreeNodeColorType.black,A.color=k.TreeNodeColorType.red;var R=A.rotateLeft();A===i&&(i=R)}}}}};this.insert=function(h){if(h==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(this.empty()){++n,i.key=h,i.color=k.TreeNodeColorType.black;return}var g=d(i,h);g.key!==void 0&&e(g.key,h)===0||(++n,g.key=h,p(g),i.color=k.TreeNodeColorType.black)};var y=function(h,g){if(!(!h||h.key===void 0)){var m=e(g,h.key);return m<0?y(h.leftChild,g):m>0?y(h.rightChild,g):h}};this.find=function(h){var g=y(i,h);return g!==void 0&&g.key!==void 0&&e(g.key,h)===0};var w=function(h,g){if(!(!h||h.key===void 0)){var m=e(h.key,g);if(m===0)return h.key;if(m<0)return w(h.rightChild,g);var A=w(h.leftChild,g);return A!==void 0?A:h.key}};this.lowerBound=function(h){return w(i,h)};var S=function(h,g){if(!(!h||h.key===void 0)){var m=e(h.key,g);if(m<=0)return S(h.rightChild,g);var A=S(h.leftChild,g);return A!==void 0?A:h.key}};this.upperBound=function(h){return S(i,h)};var _=function(h,g){if(!(!h||h.key===void 0)){var m=e(h.key,g);if(m===0)return h.key;if(m>0)return _(h.leftChild,g);var A=_(h.rightChild,g);return A!==void 0?A:h.key}};this.reverseLowerBound=function(h){return _(i,h)};var C=function(h,g){if(!(!h||h.key===void 0)){var m=e(h.key,g);if(m>=0)return C(h.leftChild,g);var A=C(h.rightChild,g);return A!==void 0?A:h.key}};this.reverseUpperBound=function(h){return C(i,h)},this.union=function(h){var g=this;h.forEach(function(m){return g.insert(m)})},this.getHeight=function(){if(this.empty())return 0;var h=function(g){return g?Math.max(h(g.leftChild),h(g.rightChild))+1:1};return h(i)};var x=function(h){return ic(this,function(g){switch(g.label){case 0:return!h||h.key===void 0?[2]:[5,sr(x(h.leftChild))];case 1:return g.sent(),[4,h.key];case 2:return g.sent(),[5,sr(x(h.rightChild))];case 3:return g.sent(),[2]}})};this[Symbol.iterator]=function(){return x(i)},t.forEach(function(h){return r.insert(h)}),Object.freeze(this)}Object.freeze(ot);var oc=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(d){return f([l,d])}}function f(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},ar=globalThis&&globalThis.__values||function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};function Fe(t,e){var r=this;t===void 0&&(t=[]),e=e||function(h,g){return h<g?-1:h>g?1:0};var n=0,i=new k;i.color=k.TreeNodeColorType.black,this.size=function(){return n},this.empty=function(){return n===0},this.clear=function(){n=0,i.key=i.value=void 0,i.leftChild=i.rightChild=i.brother=void 0};var o=function(h){if(!h||h.key===void 0)throw new Error("unknown error");return h.leftChild?o(h.leftChild):h},s=function(h){if(!h||h.key===void 0)throw new Error("unknown error");return h.rightChild?s(h.rightChild):h};this.front=function(){if(!this.empty()){var h=o(i);if(h.key===void 0||h.value===void 0)throw new Error("unknown error");return{key:h.key,value:h.value}}},this.back=function(){if(!this.empty()){var h=s(i);if(h.key===void 0||h.value===void 0)throw new Error("unknown error");return{key:h.key,value:h.value}}},this.forEach=function(h){var g,m,A=0;try{for(var R=ar(this),j=R.next();!j.done;j=R.next()){var H=j.value;h(H,A++)}}catch(Ee){g={error:Ee}}finally{try{j&&!j.done&&(m=R.return)&&m.call(R)}finally{if(g)throw g.error}}},this.getElementByPos=function(h){var g,m;if(h<0||h>=this.size())throw new Error("pos must more than 0 and less than set's size");var A=0;try{for(var R=ar(this),j=R.next();!j.done;j=R.next()){var H=j.value;if(A===h)return H;++A}}catch(Ee){g={error:Ee}}finally{try{j&&!j.done&&(m=R.return)&&m.call(R)}finally{if(g)throw g.error}}throw new Error("unknown Error")};var a=function(h,g){if(!(!h||h.key===void 0||h.value===void 0)){var m=e(h.key,g);return m===0?{key:h.key,value:h.value}:m<0?a(h.rightChild,g):a(h.leftChild,g)||{key:h.key,value:h.value}}};this.lowerBound=function(h){return a(i,h)};var f=function(h,g){if(!(!h||h.key===void 0||h.value===void 0)){var m=e(h.key,g);return m<=0?f(h.rightChild,g):f(h.leftChild,g)||{key:h.key,value:h.value}}};this.upperBound=function(h){return f(i,h)};var l=function(h,g){if(!(!h||h.key===void 0||h.value===void 0)){var m=e(h.key,g);return m===0?{key:h.key,value:h.value}:m>0?l(h.leftChild,g):l(h.rightChild,g)||{key:h.key,value:h.value}}};this.reverseLowerBound=function(h){return l(i,h)};var d=function(h,g){if(!(!h||h.key===void 0||h.value===void 0)){var m=e(h.key,g);return m>=0?d(h.leftChild,g):d(h.rightChild,g)||{key:h.key,value:h.value}}};this.reverseUpperBound=function(h){return d(i,h)};var p=function(h){var g=h.parent;if(!g){if(h===i)return;throw new Error("unknown error")}if(h.color===k.TreeNodeColorType.red){h.color=k.TreeNodeColorType.black;return}var m=h.brother;if(!m)throw new Error("unknown error");if(h===g.leftChild){if(m.color===k.TreeNodeColorType.red){m.color=k.TreeNodeColorType.black,g.color=k.TreeNodeColorType.red;var A=g.rotateLeft();i===g&&(i=A),p(h)}else if(m.color===k.TreeNodeColorType.black)if(m.rightChild&&m.rightChild.color===k.TreeNodeColorType.red){m.color=g.color,g.color=k.TreeNodeColorType.black,m.rightChild&&(m.rightChild.color=k.TreeNodeColorType.black);var A=g.rotateLeft();i===g&&(i=A),h.color=k.TreeNodeColorType.black}else if((!m.rightChild||m.rightChild.color===k.TreeNodeColorType.black)&&m.leftChild&&m.leftChild.color===k.TreeNodeColorType.red){m.color=k.TreeNodeColorType.red,m.leftChild&&(m.leftChild.color=k.TreeNodeColorType.black);var A=m.rotateRight();i===m&&(i=A),p(h)}else(!m.leftChild||m.leftChild.color===k.TreeNodeColorType.black)&&(!m.rightChild||m.rightChild.color===k.TreeNodeColorType.black)&&(m.color=k.TreeNodeColorType.red,p(g))}else if(h===g.rightChild){if(m.color===k.TreeNodeColorType.red){m.color=k.TreeNodeColorType.black,g.color=k.TreeNodeColorType.red;var A=g.rotateRight();i===g&&(i=A),p(h)}else if(m.color===k.TreeNodeColorType.black)if(m.leftChild&&m.leftChild.color===k.TreeNodeColorType.red){m.color=g.color,g.color=k.TreeNodeColorType.black,m.leftChild&&(m.leftChild.color=k.TreeNodeColorType.black);var A=g.rotateRight();i===g&&(i=A),h.color=k.TreeNodeColorType.black}else if((!m.leftChild||m.leftChild.color===k.TreeNodeColorType.black)&&m.rightChild&&m.rightChild.color===k.TreeNodeColorType.red){m.color=k.TreeNodeColorType.red,m.rightChild&&(m.rightChild.color=k.TreeNodeColorType.black);var A=m.rotateLeft();i===m&&(i=A),p(h)}else(!m.leftChild||m.leftChild.color===k.TreeNodeColorType.black)&&(!m.rightChild||m.rightChild.color===k.TreeNodeColorType.black)&&(m.color=k.TreeNodeColorType.red,p(g))}},y=function(h){for(var g=h;g.leftChild||g.rightChild;){if(g.rightChild){g=o(g.rightChild);var m=h.key;h.key=g.key,g.key=m;var A=h.value;h.value=g.value,g.value=A,h=g}if(g.leftChild){g=s(g.leftChild);var m=h.key;h.key=g.key,g.key=m;var A=h.value;h.value=g.value,g.value=A,h=g}}p(g),g&&g.remove(),--n,i.color=k.TreeNodeColorType.black},w=function(h,g){if(!h||h.key===void 0)return!1;var m=w(h.leftChild,g);return m||g(h)?!0:w(h.rightChild,g)};this.eraseElementByPos=function(h){if(h<0||h>=n)throw new Error("pos must more than 0 and less than set's size");var g=0;w(i,function(m){return h===g?(y(m),!0):(++g,!1)})},this.eraseElementByKey=function(h){if(!this.empty()){var g=C(i,h);g===void 0||g.key===void 0||e(g.key,h)!==0||y(g)}};var S=function(h,g){if(!h||h.key===void 0)throw new Error("unknown error");var m=e(g,h.key);return m<0?h.leftChild?S(h.leftChild,g):(h.leftChild=new k,h.leftChild.parent=h,h.leftChild.brother=h.rightChild,h.rightChild&&(h.rightChild.brother=h.leftChild),h.leftChild):m>0?h.rightChild?S(h.rightChild,g):(h.rightChild=new k,h.rightChild.parent=h,h.rightChild.brother=h.leftChild,h.leftChild&&(h.leftChild.brother=h.rightChild),h.rightChild):h},_=function(h){var g=h.parent;if(!g){if(h===i)return;throw new Error("unknown error")}if(g.color!==k.TreeNodeColorType.black&&g.color===k.TreeNodeColorType.red){var m=g.brother,A=g.parent;if(!A)throw new Error("unknown error");if(m&&m.color===k.TreeNodeColorType.red)m.color=g.color=k.TreeNodeColorType.black,A.color=k.TreeNodeColorType.red,_(A);else if(!m||m.color===k.TreeNodeColorType.black){if(g===A.leftChild){if(h===g.leftChild){g.color=k.TreeNodeColorType.black,A.color=k.TreeNodeColorType.red;var R=A.rotateRight();A===i&&(i=R)}else if(h===g.rightChild){var R=g.rotateLeft();A===i&&(i=R),_(g)}}else if(g===A.rightChild){if(h===g.leftChild){var R=g.rotateRight();A===i&&(i=R),_(g)}else if(h===g.rightChild){g.color=k.TreeNodeColorType.black,A.color=k.TreeNodeColorType.red;var R=A.rotateLeft();A===i&&(i=R)}}}}};this.setElement=function(h,g){if(h==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(g==null){this.eraseElementByKey(h);return}if(this.empty()){++n,i.key=h,i.value=g,i.color=k.TreeNodeColorType.black;return}var m=S(i,h);if(m.key!==void 0&&e(m.key,h)===0){m.value=g;return}++n,m.key=h,m.value=g,_(m),i.color=k.TreeNodeColorType.black};var C=function(h,g){if(!(!h||h.key===void 0)){var m=e(g,h.key);return m<0?C(h.leftChild,g):m>0?C(h.rightChild,g):h}};this.find=function(h){return!!C(i,h)},this.getElementByKey=function(h){var g=C(i,h);if((g==null?void 0:g.key)===void 0||(g==null?void 0:g.value)===void 0)throw new Error("unknown error");return g.value},this.union=function(h){var g=this;h.forEach(function(m){var A=m.key,R=m.value;return g.setElement(A,R)})},this.getHeight=function(){if(this.empty())return 0;var h=function(g){return g?Math.max(h(g.leftChild),h(g.rightChild))+1:1};return h(i)};var x=function(h){return oc(this,function(g){switch(g.label){case 0:return!h||h.key===void 0||h.value===void 0?[2]:[5,ar(x(h.leftChild))];case 1:return g.sent(),[4,{key:h.key,value:h.value}];case 2:return g.sent(),[5,ar(x(h.rightChild))];case 3:return g.sent(),[2]}})};this[Symbol.iterator]=function(){return x(i)},t.forEach(function(h){var g=h.key,m=h.value;return r.setElement(g,m)}),Object.freeze(this)}Object.freeze(Fe);var sc=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(d){return f([l,d])}}function f(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},ac=globalThis&&globalThis.__values||function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};J.initSize=1<<4;J.maxSize=1<<30;J.sigma=.75;J.treeifyThreshold=8;J.untreeifyThreshold=6;J.minTreeifySize=64;function J(t,e,r){var n=this;if(t===void 0&&(t=[]),e===void 0&&(e=J.initSize),r=r||function(f){var l=0,d="";if(typeof f=="number")l=Math.floor(f),l=(l<<5)-l,l=l&l;else{typeof f!="string"?d=JSON.stringify(f):d=f;for(var p=0;p<d.length;p++){var y=d.charCodeAt(p);l=(l<<5)-l+y,l=l&l}}return l^=l>>>16,l},(e&e-1)!==0)throw new Error("initBucketNum must be 2 to the power of n");var i=0,o=[],s=Math.max(J.initSize,Math.min(J.maxSize,e));this.size=function(){return i},this.empty=function(){return i===0},this.clear=function(){i=0,s=e,o=[]},this.forEach=function(f){var l=0;o.forEach(function(d){d.forEach(function(p){f(p,l++)})})};var a=function(f){if(!(f>=J.maxSize)){s=f*2;var l=[];o.forEach(function(d,p){if(!d.empty()){if(d instanceof Q&&d.size()===1){var y=d.front();if(y===void 0)throw new Error("unknown error");l[r(y)&s-1]=new Q([y])}else if(d instanceof ot){var w=new Q,S=new Q;d.forEach(function(x){var h=r(x);(h&f)===0?w.pushBack(x):S.pushBack(x)}),w.size()>J.untreeifyThreshold?l[p]=new ot(w):w.size()&&(l[p]=w),S.size()>J.untreeifyThreshold?l[p+f]=new ot(S):S.size()&&(l[p+f]=S)}else{var _=new Q,C=new Q;d.forEach(function(x){var h=r(x);(h&f)===0?_.pushBack(x):C.pushBack(x)}),_.size()&&(l[p]=_),C.size()&&(l[p+f]=C)}o[p].clear()}}),o=l}};this.insert=function(f){if(f==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");var l=r(f)&s-1;if(!o[l])o[l]=new Q([f]),++i;else{var d=o[l].size();if(o[l]instanceof Q){if(o[l].find(f))return;o[l].pushBack(f),o[l].size()>=J.treeifyThreshold&&(o[l]=new ot(o[l]))}else o[l].insert(f);var p=o[l].size();i+=p-d}i>s*J.sigma&&a.call(this,s)},this.eraseElementByValue=function(f){var l=r(f)&s-1;if(!!o[l]){var d=o[l].size();o[l].eraseElementByValue(f),o[l]instanceof ot&&o[l].size()<=J.untreeifyThreshold&&(o[l]=new Q(o[l]));var p=o[l].size();i+=p-d}},this.find=function(f){var l=r(f)&s-1;return o[l]?o[l].find(f):!1},this[Symbol.iterator]=function(){return function(){var f,l,d,p,y,w,S;return sc(this,function(_){switch(_.label){case 0:f=0,_.label=1;case 1:if(!(f<s))return[3,10];for(;f<s&&!o[f];)++f;if(f>=s)return[3,10];_.label=2;case 2:_.trys.push([2,7,8,9]),l=(w=void 0,ac(o[f])),d=l.next(),_.label=3;case 3:return d.done?[3,6]:(p=d.value,[4,p]);case 4:_.sent(),_.label=5;case 5:return d=l.next(),[3,3];case 6:return[3,9];case 7:return y=_.sent(),w={error:y},[3,9];case 8:try{d&&!d.done&&(S=l.return)&&S.call(l)}finally{if(w)throw w.error}return[7];case 9:return++f,[3,1];case 10:return[2]}})}()},t.forEach(function(f){return n.insert(f)}),Object.freeze(this)}Object.freeze(J);var lc=globalThis&&globalThis.__generator||function(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(d){return f([l,d])}}function f(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},yt=globalThis&&globalThis.__values||function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};ee.initSize=1<<4;ee.maxSize=1<<30;ee.sigma=.75;ee.treeifyThreshold=8;ee.untreeifyThreshold=6;ee.minTreeifySize=64;function ee(t,e,r){var n=this;if(t===void 0&&(t=[]),e===void 0&&(e=ee.initSize),r=r||function(f){var l,d,p=0,y="";if(typeof f=="number")p=Math.floor(f),p=(p<<5)-p,p=p&p;else{typeof f!="string"?y=JSON.stringify(f):y=f;try{for(var w=yt(y),S=w.next();!S.done;S=w.next()){var _=S.value,C=_.charCodeAt(0);p=(p<<5)-p+C,p=p&p}}catch(x){l={error:x}}finally{try{S&&!S.done&&(d=w.return)&&d.call(w)}finally{if(l)throw l.error}}}return p^=p>>>16,p},(e&e-1)!==0)throw new Error("initBucketNum must be 2 to the power of n");var i=0,o=[],s=Math.max(ee.initSize,Math.min(ee.maxSize,e));this.size=function(){return i},this.empty=function(){return i===0},this.clear=function(){i=0,s=e,o=[]},this.forEach=function(f){var l=0;o.forEach(function(d){d.forEach(function(p){f(p,l++)})})};var a=function(f){if(!(f>=ee.maxSize)){s=f*2;var l=[];o.forEach(function(d,p){if(!d.empty()){if(d instanceof Q&&d.size()===1){var y=d.front(),w=y.key,S=y.value;l[r(w)&s-1]=new Q([{key:w,value:S}])}else if(d instanceof Fe){var _=new Q,C=new Q;d.forEach(function(g){var m=r(g.key);(m&f)===0?_.pushBack(g):C.pushBack(g)}),_.size()>ee.untreeifyThreshold?l[p]=new Fe(_):_.size()&&(l[p]=_),C.size()>ee.untreeifyThreshold?l[p+f]=new Fe(C):C.size()&&(l[p+f]=C)}else{var x=new Q,h=new Q;d.forEach(function(g){var m=r(g.key);(m&f)===0?x.pushBack(g):h.pushBack(g)}),x.size()&&(l[p]=x),h.size()&&(l[p+f]=h)}o[p].clear()}}),o=l}};this.setElement=function(f,l){var d,p;if(f==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(l==null){this.eraseElementByKey(f);return}var y=r(f)&s-1;if(!o[y])++i,o[y]=new Q([{key:f,value:l}]);else{var w=o[y].size();if(o[y]instanceof Q){try{for(var S=yt(o[y]),_=S.next();!_.done;_=S.next()){var C=_.value;if(C.key===f){C.value=l;return}}}catch(h){d={error:h}}finally{try{_&&!_.done&&(p=S.return)&&p.call(S)}finally{if(d)throw d.error}}o[y].pushBack({key:f,value:l}),o[y].size()>=ee.treeifyThreshold&&(o[y]=new Fe(o[y]))}else o[y].setElement(f,l);var x=o[y].size();i+=x-w}i>s*ee.sigma&&a.call(this,s)},this.getElementByKey=function(f){var l,d,p=r(f)&s-1;if(!!o[p]){if(o[p]instanceof Fe)return o[p].getElementByKey(f);try{for(var y=yt(o[p]),w=y.next();!w.done;w=y.next()){var S=w.value;if(S.key===f)return S.value}}catch(_){l={error:_}}finally{try{w&&!w.done&&(d=y.return)&&d.call(y)}finally{if(l)throw l.error}}}},this.eraseElementByKey=function(f){var l,d,p=r(f)&s-1;if(!!o[p]){var y=o[p].size();if(o[p]instanceof Fe)o[p].eraseElementByKey(f),o[p].size()<=ee.untreeifyThreshold&&(o[p]=new Q(o[p]));else{var w=-1;try{for(var S=yt(o[p]),_=S.next();!_.done;_=S.next()){var C=_.value;if(++w,C.key===f){o[p].eraseElementByPos(w);break}}}catch(h){l={error:h}}finally{try{_&&!_.done&&(d=S.return)&&d.call(S)}finally{if(l)throw l.error}}}var x=o[p].size();i+=x-y}},this.find=function(f){var l,d,p=r(f)&s-1;if(!o[p])return!1;if(o[p]instanceof Fe)return o[p].find(f);try{for(var y=yt(o[p]),w=y.next();!w.done;w=y.next()){var S=w.value;if(S.key===f)return!0}}catch(_){l={error:_}}finally{try{w&&!w.done&&(d=y.return)&&d.call(y)}finally{if(l)throw l.error}}return!1},this[Symbol.iterator]=function(){return function(){var f,l,d,p,y,w,S;return lc(this,function(_){switch(_.label){case 0:f=0,_.label=1;case 1:if(!(f<s))return[3,10];for(;f<s&&!o[f];)++f;if(f>=s)return[3,10];_.label=2;case 2:_.trys.push([2,7,8,9]),l=(w=void 0,yt(o[f])),d=l.next(),_.label=3;case 3:return d.done?[3,6]:(p=d.value,[4,p]);case 4:_.sent(),_.label=5;case 5:return d=l.next(),[3,3];case 6:return[3,9];case 7:return y=_.sent(),w={error:y},[3,9];case 8:try{d&&!d.done&&(S=l.return)&&S.call(l)}finally{if(w)throw w.error}return[7];case 9:return++f,[3,1];case 10:return[2]}})}()},t.forEach(function(f){var l=f.key,d=f.value;return n.setElement(l,d)}),Object.freeze(this)}Object.freeze(ee);var fc=Object.freeze(Object.defineProperty({__proto__:null,Vector:Po,Stack:Mo,Queue:Oo,LinkList:Q,Deque:F,PriorityQueue:Lo,Set:ot,Map:Fe,HashSet:J,HashMap:ee},Symbol.toStringTag,{value:"Module"})),uc=Bn(fc),Ae={exports:{}},It=1e3,xt=It*60,Bt=xt*60,ut=Bt*24,cc=ut*7,hc=ut*365.25,pc=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return dc(t);if(r==="number"&&isFinite(t))return e.long?yc(t):gc(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function dc(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!!e){var r=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*hc;case"weeks":case"week":case"w":return r*cc;case"days":case"day":case"d":return r*ut;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Bt;case"minutes":case"minute":case"mins":case"min":case"m":return r*xt;case"seconds":case"second":case"secs":case"sec":case"s":return r*It;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function gc(t){var e=Math.abs(t);return e>=ut?Math.round(t/ut)+"d":e>=Bt?Math.round(t/Bt)+"h":e>=xt?Math.round(t/xt)+"m":e>=It?Math.round(t/It)+"s":t+"ms"}function yc(t){var e=Math.abs(t);return e>=ut?lr(t,e,ut,"day"):e>=Bt?lr(t,e,Bt,"hour"):e>=xt?lr(t,e,xt,"minute"):e>=It?lr(t,e,It,"second"):t+" ms"}function lr(t,e,r,n){var i=e>=r*1.5;return Math.round(t/r)+" "+n+(i?"s":"")}function vc(t){r.debug=r,r.default=r,r.coerce=f,r.disable=o,r.enable=i,r.enabled=s,r.humanize=pc,r.destroy=l,Object.keys(t).forEach(d=>{r[d]=t[d]}),r.names=[],r.skips=[],r.formatters={};function e(d){let p=0;for(let y=0;y<d.length;y++)p=(p<<5)-p+d.charCodeAt(y),p|=0;return r.colors[Math.abs(p)%r.colors.length]}r.selectColor=e;function r(d){let p,y=null,w,S;function _(...C){if(!_.enabled)return;const x=_,h=Number(new Date),g=h-(p||h);x.diff=g,x.prev=p,x.curr=h,p=h,C[0]=r.coerce(C[0]),typeof C[0]!="string"&&C.unshift("%O");let m=0;C[0]=C[0].replace(/%([a-zA-Z%])/g,(R,j)=>{if(R==="%%")return"%";m++;const H=r.formatters[j];if(typeof H=="function"){const Ee=C[m];R=H.call(x,Ee),C.splice(m,1),m--}return R}),r.formatArgs.call(x,C),(x.log||r.log).apply(x,C)}return _.namespace=d,_.useColors=r.useColors(),_.color=r.selectColor(d),_.extend=n,_.destroy=r.destroy,Object.defineProperty(_,"enabled",{enumerable:!0,configurable:!1,get:()=>y!==null?y:(w!==r.namespaces&&(w=r.namespaces,S=r.enabled(d)),S),set:C=>{y=C}}),typeof r.init=="function"&&r.init(_),_}function n(d,p){const y=r(this.namespace+(typeof p=="undefined"?":":p)+d);return y.log=this.log,y}function i(d){r.save(d),r.namespaces=d,r.names=[],r.skips=[];let p;const y=(typeof d=="string"?d:"").split(/[\s,]+/),w=y.length;for(p=0;p<w;p++)!y[p]||(d=y[p].replace(/\*/g,".*?"),d[0]==="-"?r.skips.push(new RegExp("^"+d.slice(1)+"$")):r.names.push(new RegExp("^"+d+"$")))}function o(){const d=[...r.names.map(a),...r.skips.map(a).map(p=>"-"+p)].join(",");return r.enable(""),d}function s(d){if(d[d.length-1]==="*")return!0;let p,y;for(p=0,y=r.skips.length;p<y;p++)if(r.skips[p].test(d))return!1;for(p=0,y=r.names.length;p<y;p++)if(r.names[p].test(d))return!0;return!1}function a(d){return d.toString().substring(2,d.toString().length-2).replace(/\.\*\?$/,"*")}function f(d){return d instanceof Error?d.stack||d.message:d}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}var bc=vc;(function(t,e){e.formatArgs=n,e.save=i,e.load=o,e.useColors=r,e.storage=s(),e.destroy=(()=>{let f=!1;return()=>{f||(f=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(f){if(f[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+f[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;f.splice(1,0,l,"color: inherit");let d=0,p=0;f[0].replace(/%[a-zA-Z%]/g,y=>{y!=="%%"&&(d++,y==="%c"&&(p=d))}),f.splice(p,0,l)}e.log=console.debug||console.log||(()=>{});function i(f){try{f?e.storage.setItem("debug",f):e.storage.removeItem("debug")}catch{}}function o(){let f;try{f=e.storage.getItem("debug")}catch{}return!f&&typeof process!="undefined"&&"env"in process&&(f={}.DEBUG),f}function s(){try{return localStorage}catch{}}t.exports=bc(e);const{formatters:a}=t.exports;a.j=function(f){try{return JSON.stringify(f)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}})(Ae,Ae.exports);const wc=uc.Set,Re=Ae.exports("number-allocator:trace"),Pi=Ae.exports("number-allocator:error");function Rt(t,e){this.low=t,this.high=e}Rt.prototype.equals=function(t){return this.low===t.low&&this.high===t.high};Rt.prototype.compare=function(t){return this.low<t.low&&this.high<t.low?-1:t.low<this.low&&t.high<this.low?1:0};function De(t,e){if(!(this instanceof De))return new De(t,e);this.min=t,this.max=e,this.ss=new wc([],(r,n)=>r.compare(n)),Re("Create"),this.clear()}De.prototype.firstVacant=function(){return this.ss.size()===0?null:this.ss.front().low};De.prototype.alloc=function(){if(this.ss.size()===0)return Re("alloc():empty"),null;const t=this.ss.front(),e=t.low;return e+1<=t.high?++t.low:this.ss.eraseElementByPos(0),Re("alloc():"+e),e};De.prototype.use=function(t){const e=new Rt(t,t),r=this.ss.lowerBound(e);if(r){if(r.equals(e))return this.ss.eraseElementByValue(r),Re("use():"+t),!0;if(r.low>t)return!1;if(r.low===t)return++r.low,Re("use():"+t),!0;if(r.high===t)return--r.high,Re("use():"+t),!0;const n=r.low;return r.low=t+1,this.ss.insert(new Rt(n,t-1)),Re("use():"+t),!0}return Re("use():failed"),!1};De.prototype.free=function(t){if(t<this.min||t>this.max){Pi("free():"+t+" is out of range");return}const e=new Rt(t,t),r=this.ss.lowerBound(e);if(r){if(r.low<=t&&t<=r.high){Pi("free():"+t+" has already been vacant");return}if(r===this.ss.front())t+1===r.low?--r.low:this.ss.insert(e);else{const n=this.ss.reverseLowerBound(e);n.high+1===t?t+1===r.low?(this.ss.eraseElementByValue(n),r.low=n.low):n.high=t:t+1===r.low?r.low=t:this.ss.insert(e)}}else{if(r===this.ss.front()){this.ss.insert(e);return}const n=this.ss.reverseLowerBound(e);n.high+1===t?n.high=t:this.ss.insert(e)}Re("free():"+t)};De.prototype.clear=function(){Re("clear()"),this.ss.clear(),this.ss.insert(new Rt(this.min,this.max))};De.prototype.intervalCount=function(){return this.ss.size()};De.prototype.dump=function(){console.log("length:"+this.ss.size());for(const t of this.ss)console.log(t)};var mc=De;const _c=mc;Ro.NumberAllocator=_c;const Ec=Xu,Sc=Ro.NumberAllocator;function Je(t){if(!(this instanceof Je))return new Je(t);t>0&&(this.aliasToTopic=new Ec({max:t}),this.topicToAlias={},this.numberAllocator=new Sc(1,t),this.max=t,this.length=0)}Je.prototype.put=function(t,e){if(e===0||e>this.max)return!1;const r=this.aliasToTopic.get(e);return r&&delete this.topicToAlias[r],this.aliasToTopic.set(e,t),this.topicToAlias[t]=e,this.numberAllocator.use(e),this.length=this.aliasToTopic.length,!0};Je.prototype.getTopicByAlias=function(t){return this.aliasToTopic.get(t)};Je.prototype.getAliasByTopic=function(t){const e=this.topicToAlias[t];return typeof e!="undefined"&&this.aliasToTopic.get(e),e};Je.prototype.clear=function(){this.aliasToTopic.reset(),this.topicToAlias={},this.numberAllocator.clear(),this.length=0};Je.prototype.getLruAlias=function(){const t=this.numberAllocator.firstVacant();return t||this.aliasToTopic.keys()[this.aliasToTopic.length-1]};var Tc=Je,Nr={},jr={exports:{}};const{Buffer:Te}=Ve,Do=Symbol.for("BufferList");function z(t){if(!(this instanceof z))return new z(t);z._init.call(this,t)}z._init=function(e){Object.defineProperty(this,Do,{value:!0}),this._bufs=[],this.length=0,e&&this.append(e)};z.prototype._new=function(e){return new z(e)};z.prototype._offset=function(e){if(e===0)return[0,0];let r=0;for(let n=0;n<this._bufs.length;n++){const i=r+this._bufs[n].length;if(e<i||n===this._bufs.length-1)return[n,e-r];r=i}};z.prototype._reverseOffset=function(t){const e=t[0];let r=t[1];for(let n=0;n<e;n++)r+=this._bufs[n].length;return r};z.prototype.get=function(e){if(e>this.length||e<0)return;const r=this._offset(e);return this._bufs[r[0]][r[1]]};z.prototype.slice=function(e,r){return typeof e=="number"&&e<0&&(e+=this.length),typeof r=="number"&&r<0&&(r+=this.length),this.copy(null,0,e,r)};z.prototype.copy=function(e,r,n,i){if((typeof n!="number"||n<0)&&(n=0),(typeof i!="number"||i>this.length)&&(i=this.length),n>=this.length||i<=0)return e||Te.alloc(0);const o=!!e,s=this._offset(n),a=i-n;let f=a,l=o&&r||0,d=s[1];if(n===0&&i===this.length){if(!o)return this._bufs.length===1?this._bufs[0]:Te.concat(this._bufs,this.length);for(let p=0;p<this._bufs.length;p++)this._bufs[p].copy(e,l),l+=this._bufs[p].length;return e}if(f<=this._bufs[s[0]].length-d)return o?this._bufs[s[0]].copy(e,r,d,d+f):this._bufs[s[0]].slice(d,d+f);o||(e=Te.allocUnsafe(a));for(let p=s[0];p<this._bufs.length;p++){const y=this._bufs[p].length-d;if(f>y)this._bufs[p].copy(e,l,d),l+=y;else{this._bufs[p].copy(e,l,d,d+f),l+=y;break}f-=y,d&&(d=0)}return e.length>l?e.slice(0,l):e};z.prototype.shallowSlice=function(e,r){if(e=e||0,r=typeof r!="number"?this.length:r,e<0&&(e+=this.length),r<0&&(r+=this.length),e===r)return this._new();const n=this._offset(e),i=this._offset(r),o=this._bufs.slice(n[0],i[0]+1);return i[1]===0?o.pop():o[o.length-1]=o[o.length-1].slice(0,i[1]),n[1]!==0&&(o[0]=o[0].slice(n[1])),this._new(o)};z.prototype.toString=function(e,r,n){return this.slice(r,n).toString(e)};z.prototype.consume=function(e){if(e=Math.trunc(e),Number.isNaN(e)||e<=0)return this;for(;this._bufs.length;)if(e>=this._bufs[0].length)e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift();else{this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}return this};z.prototype.duplicate=function(){const e=this._new();for(let r=0;r<this._bufs.length;r++)e.append(this._bufs[r]);return e};z.prototype.append=function(e){if(e==null)return this;if(e.buffer)this._appendBuffer(Te.from(e.buffer,e.byteOffset,e.byteLength));else if(Array.isArray(e))for(let r=0;r<e.length;r++)this.append(e[r]);else if(this._isBufferList(e))for(let r=0;r<e._bufs.length;r++)this.append(e._bufs[r]);else typeof e=="number"&&(e=e.toString()),this._appendBuffer(Te.from(e));return this};z.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length};z.prototype.indexOf=function(t,e,r){if(r===void 0&&typeof e=="string"&&(r=e,e=void 0),typeof t=="function"||Array.isArray(t))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof t=="number"?t=Te.from([t]):typeof t=="string"?t=Te.from(t,r):this._isBufferList(t)?t=t.slice():Array.isArray(t.buffer)?t=Te.from(t.buffer,t.byteOffset,t.byteLength):Te.isBuffer(t)||(t=Te.from(t)),e=Number(e||0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),t.length===0)return e>this.length?this.length:e;const n=this._offset(e);let i=n[0],o=n[1];for(;i<this._bufs.length;i++){const s=this._bufs[i];for(;o<s.length;)if(s.length-o>=t.length){const f=s.indexOf(t,o);if(f!==-1)return this._reverseOffset([i,f]);o=s.length-t.length+1}else{const f=this._reverseOffset([i,o]);if(this._match(f,t))return f;o++}o=0}return-1};z.prototype._match=function(t,e){if(this.length-t<e.length)return!1;for(let r=0;r<e.length;r++)if(this.get(t+r)!==e[r])return!1;return!0};(function(){const t={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(const e in t)(function(r){t[r]===null?z.prototype[r]=function(n,i){return this.slice(n,n+i)[r](0,i)}:z.prototype[r]=function(n=0){return this.slice(n,n+t[r])[r](0)}})(e)})();z.prototype._isBufferList=function(e){return e instanceof z||z.isBufferList(e)};z.isBufferList=function(e){return e!=null&&e[Do]};var Cc=z;const Kn=We.exports.Duplex,Ac=Oe.exports,Zt=Cc;function le(t){if(!(this instanceof le))return new le(t);if(typeof t=="function"){this._callback=t;const e=function(n){this._callback&&(this._callback(n),this._callback=null)}.bind(this);this.on("pipe",function(n){n.on("error",e)}),this.on("unpipe",function(n){n.removeListener("error",e)}),t=null}Zt._init.call(this,t),Kn.call(this)}Ac(le,Kn);Object.assign(le.prototype,Zt.prototype);le.prototype._new=function(e){return new le(e)};le.prototype._write=function(e,r,n){this._appendBuffer(e),typeof n=="function"&&n()};le.prototype._read=function(e){if(!this.length)return this.push(null);e=Math.min(e,this.length),this.push(this.slice(0,e)),this.consume(e)};le.prototype.end=function(e){Kn.prototype.end.call(this,e),this._callback&&(this._callback(null,this.slice()),this._callback=null)};le.prototype._destroy=function(e,r){this._bufs.length=0,this.length=0,r(e)};le.prototype._isBufferList=function(e){return e instanceof le||e instanceof Zt||le.isBufferList(e)};le.isBufferList=Zt.isBufferList;jr.exports=le;jr.exports.BufferListStream=le;jr.exports.BufferList=Zt;class kc{constructor(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}}var Ic=kc,Gn={exports:{}};(function(t){const e=t.exports;e.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},e.codes={};for(const n in e.types){const i=e.types[n];e.codes[i]=n}e.CMD_SHIFT=4,e.CMD_MASK=240,e.DUP_MASK=8,e.QOS_MASK=3,e.QOS_SHIFT=1,e.RETAIN_MASK=1,e.VARBYTEINT_MASK=127,e.VARBYTEINT_FIN_MASK=128,e.VARBYTEINT_MAX=268435455,e.SESSIONPRESENT_MASK=1,e.SESSIONPRESENT_HEADER=Buffer.from([e.SESSIONPRESENT_MASK]),e.CONNACK_HEADER=Buffer.from([e.codes.connack<<e.CMD_SHIFT]),e.USERNAME_MASK=128,e.PASSWORD_MASK=64,e.WILL_RETAIN_MASK=32,e.WILL_QOS_MASK=24,e.WILL_QOS_SHIFT=3,e.WILL_FLAG_MASK=4,e.CLEAN_SESSION_MASK=2,e.CONNECT_HEADER=Buffer.from([e.codes.connect<<e.CMD_SHIFT]),e.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},e.propertiesCodes={};for(const n in e.properties){const i=e.properties[n];e.propertiesCodes[i]=n}e.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"};function r(n){return[0,1,2].map(i=>[0,1].map(o=>[0,1].map(s=>{const a=Buffer.alloc(1);return a.writeUInt8(e.codes[n]<<e.CMD_SHIFT|(o?e.DUP_MASK:0)|i<<e.QOS_SHIFT|s,0,!0),a})))}e.PUBLISH_HEADER=r("publish"),e.SUBSCRIBE_HEADER=r("subscribe"),e.SUBSCRIBE_OPTIONS_QOS_MASK=3,e.SUBSCRIBE_OPTIONS_NL_MASK=1,e.SUBSCRIBE_OPTIONS_NL_SHIFT=2,e.SUBSCRIBE_OPTIONS_RAP_MASK=1,e.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,e.SUBSCRIBE_OPTIONS_RH_MASK=3,e.SUBSCRIBE_OPTIONS_RH_SHIFT=4,e.SUBSCRIBE_OPTIONS_RH=[0,16,32],e.SUBSCRIBE_OPTIONS_NL=4,e.SUBSCRIBE_OPTIONS_RAP=8,e.SUBSCRIBE_OPTIONS_QOS=[0,1,2],e.UNSUBSCRIBE_HEADER=r("unsubscribe"),e.ACKS={unsuback:r("unsuback"),puback:r("puback"),pubcomp:r("pubcomp"),pubrel:r("pubrel"),pubrec:r("pubrec")},e.SUBACK_HEADER=Buffer.from([e.codes.suback<<e.CMD_SHIFT]),e.VERSION3=Buffer.from([3]),e.VERSION4=Buffer.from([4]),e.VERSION5=Buffer.from([5]),e.VERSION131=Buffer.from([131]),e.VERSION132=Buffer.from([132]),e.QOS=[0,1,2].map(n=>Buffer.from([n])),e.EMPTY={pingreq:Buffer.from([e.codes.pingreq<<4,0]),pingresp:Buffer.from([e.codes.pingresp<<4,0]),disconnect:Buffer.from([e.codes.disconnect<<4,0])}})(Gn);const xc=jr.exports,Bc=ke,Mi=Ic,W=Gn.exports,P=Ae.exports("mqtt-packet:parser");class br extends Bc{constructor(){super(),this.parser=this.constructor.parser}static parser(e){return this instanceof br?(this.settings=e||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState(),this):new br().parser(e)}_resetState(){P("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new Mi,this.error=null,this._list=xc(),this._stateCounter=0}parse(e){for(this.error&&this._resetState(),this._list.append(e),P("parse: current state: %s",this._states[this._stateCounter]);(this.packet.length!==-1||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,P("parse: state complete. _stateCounter is now: %d",this._stateCounter),P("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return P("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length}_parseHeader(){const e=this._list.readUInt8(0);return this.packet.cmd=W.types[e>>W.CMD_SHIFT],this.packet.retain=(e&W.RETAIN_MASK)!==0,this.packet.qos=e>>W.QOS_SHIFT&W.QOS_MASK,this.packet.dup=(e&W.DUP_MASK)!==0,P("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0}_parseLength(){const e=this._parseVarByteNum(!0);return e&&(this.packet.length=e.value,this._list.consume(e.bytes)),P("_parseLength %d",e.value),!!e}_parsePayload(){P("_parsePayload: payload %O",this._list);let e=!1;if(this.packet.length===0||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}e=!0}return P("_parsePayload complete result: %s",e),e}_parseConnect(){P("_parseConnect");let e,r,n,i;const o={},s=this.packet,a=this._parseString();if(a===null)return this._emitError(new Error("Cannot parse protocolId"));if(a!=="MQTT"&&a!=="MQIsdp")return this._emitError(new Error("Invalid protocolId"));if(s.protocolId=a,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(s.protocolVersion=this._list.readUInt8(this._pos),s.protocolVersion>=128&&(s.bridgeMode=!0,s.protocolVersion=s.protocolVersion-128),s.protocolVersion!==3&&s.protocolVersion!==4&&s.protocolVersion!==5)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(o.username=this._list.readUInt8(this._pos)&W.USERNAME_MASK,o.password=this._list.readUInt8(this._pos)&W.PASSWORD_MASK,o.will=this._list.readUInt8(this._pos)&W.WILL_FLAG_MASK,o.will&&(s.will={},s.will.retain=(this._list.readUInt8(this._pos)&W.WILL_RETAIN_MASK)!==0,s.will.qos=(this._list.readUInt8(this._pos)&W.WILL_QOS_MASK)>>W.WILL_QOS_SHIFT),s.clean=(this._list.readUInt8(this._pos)&W.CLEAN_SESSION_MASK)!==0,this._pos++,s.keepalive=this._parseNum(),s.keepalive===-1)return this._emitError(new Error("Packet too short"));if(s.protocolVersion===5){const l=this._parseProperties();Object.getOwnPropertyNames(l).length&&(s.properties=l)}const f=this._parseString();if(f===null)return this._emitError(new Error("Packet too short"));if(s.clientId=f,P("_parseConnect: packet.clientId: %s",s.clientId),o.will){if(s.protocolVersion===5){const l=this._parseProperties();Object.getOwnPropertyNames(l).length&&(s.will.properties=l)}if(e=this._parseString(),e===null)return this._emitError(new Error("Cannot parse will topic"));if(s.will.topic=e,P("_parseConnect: packet.will.topic: %s",s.will.topic),r=this._parseBuffer(),r===null)return this._emitError(new Error("Cannot parse will payload"));s.will.payload=r,P("_parseConnect: packet.will.paylaod: %s",s.will.payload)}if(o.username){if(i=this._parseString(),i===null)return this._emitError(new Error("Cannot parse username"));s.username=i,P("_parseConnect: packet.username: %s",s.username)}if(o.password){if(n=this._parseBuffer(),n===null)return this._emitError(new Error("Cannot parse password"));s.password=n}return this.settings=s,P("_parseConnect: complete"),s}_parseConnack(){P("_parseConnack");const e=this.packet;if(this._list.length<1)return null;if(e.sessionPresent=!!(this._list.readUInt8(this._pos++)&W.SESSIONPRESENT_MASK),this.settings.protocolVersion===5)this._list.length>=2?e.reasonCode=this._list.readUInt8(this._pos++):e.reasonCode=0;else{if(this._list.length<2)return null;e.returnCode=this._list.readUInt8(this._pos++)}if(e.returnCode===-1||e.reasonCode===-1)return this._emitError(new Error("Cannot parse return code"));if(this.settings.protocolVersion===5){const r=this._parseProperties();Object.getOwnPropertyNames(r).length&&(e.properties=r)}P("_parseConnack: complete")}_parsePublish(){P("_parsePublish");const e=this.packet;if(e.topic=this._parseString(),e.topic===null)return this._emitError(new Error("Cannot parse topic"));if(!(e.qos>0&&!this._parseMessageId())){if(this.settings.protocolVersion===5){const r=this._parseProperties();Object.getOwnPropertyNames(r).length&&(e.properties=r)}e.payload=this._list.slice(this._pos,e.length),P("_parsePublish: payload from buffer list: %o",e.payload)}}_parseSubscribe(){P("_parseSubscribe");const e=this.packet;let r,n,i,o,s,a,f;if(e.qos!==1)return this._emitError(new Error("Wrong subscribe header"));if(e.subscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){const l=this._parseProperties();Object.getOwnPropertyNames(l).length&&(e.properties=l)}for(;this._pos<e.length;){if(r=this._parseString(),r===null)return this._emitError(new Error("Cannot parse topic"));if(this._pos>=e.length)return this._emitError(new Error("Malformed Subscribe Payload"));n=this._parseByte(),i=n&W.SUBSCRIBE_OPTIONS_QOS_MASK,a=(n>>W.SUBSCRIBE_OPTIONS_NL_SHIFT&W.SUBSCRIBE_OPTIONS_NL_MASK)!==0,s=(n>>W.SUBSCRIBE_OPTIONS_RAP_SHIFT&W.SUBSCRIBE_OPTIONS_RAP_MASK)!==0,o=n>>W.SUBSCRIBE_OPTIONS_RH_SHIFT&W.SUBSCRIBE_OPTIONS_RH_MASK,f={topic:r,qos:i},this.settings.protocolVersion===5?(f.nl=a,f.rap=s,f.rh=o):this.settings.bridgeMode&&(f.rh=0,f.rap=!0,f.nl=!0),P("_parseSubscribe: push subscription `%s` to subscription",f),e.subscriptions.push(f)}}}_parseSuback(){P("_parseSuback");const e=this.packet;if(this.packet.granted=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){const r=this._parseProperties();Object.getOwnPropertyNames(r).length&&(e.properties=r)}for(;this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}_parseUnsubscribe(){P("_parseUnsubscribe");const e=this.packet;if(e.unsubscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){const r=this._parseProperties();Object.getOwnPropertyNames(r).length&&(e.properties=r)}for(;this._pos<e.length;){const r=this._parseString();if(r===null)return this._emitError(new Error("Cannot parse topic"));P("_parseUnsubscribe: push topic `%s` to unsubscriptions",r),e.unsubscriptions.push(r)}}}_parseUnsuback(){P("_parseUnsuback");const e=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if(this.settings.protocolVersion===5){const r=this._parseProperties();for(Object.getOwnPropertyNames(r).length&&(e.properties=r),e.granted=[];this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}_parseConfirmation(){P("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);const e=this.packet;if(this._parseMessageId(),this.settings.protocolVersion===5&&(e.length>2?(e.reasonCode=this._parseByte(),P("_parseConfirmation: packet.reasonCode `%d`",e.reasonCode)):e.reasonCode=0,e.length>3)){const r=this._parseProperties();Object.getOwnPropertyNames(r).length&&(e.properties=r)}return!0}_parseDisconnect(){const e=this.packet;if(P("_parseDisconnect"),this.settings.protocolVersion===5){this._list.length>0?e.reasonCode=this._parseByte():e.reasonCode=0;const r=this._parseProperties();Object.getOwnPropertyNames(r).length&&(e.properties=r)}return P("_parseDisconnect result: true"),!0}_parseAuth(){P("_parseAuth");const e=this.packet;if(this.settings.protocolVersion!==5)return this._emitError(new Error("Not supported auth packet for this version MQTT"));e.reasonCode=this._parseByte();const r=this._parseProperties();return Object.getOwnPropertyNames(r).length&&(e.properties=r),P("_parseAuth: result: true"),!0}_parseMessageId(){const e=this.packet;return e.messageId=this._parseNum(),e.messageId===null?(this._emitError(new Error("Cannot parse messageId")),!1):(P("_parseMessageId: packet.messageId %d",e.messageId),!0)}_parseString(e){const r=this._parseNum(),n=r+this._pos;if(r===-1||n>this._list.length||n>this.packet.length)return null;const i=this._list.toString("utf8",this._pos,n);return this._pos+=r,P("_parseString: result: %s",i),i}_parseStringPair(){return P("_parseStringPair"),{name:this._parseString(),value:this._parseString()}}_parseBuffer(){const e=this._parseNum(),r=e+this._pos;if(e===-1||r>this._list.length||r>this.packet.length)return null;const n=this._list.slice(this._pos,r);return this._pos+=e,P("_parseBuffer: result: %o",n),n}_parseNum(){if(this._list.length-this._pos<2)return-1;const e=this._list.readUInt16BE(this._pos);return this._pos+=2,P("_parseNum: result: %s",e),e}_parse4ByteNum(){if(this._list.length-this._pos<4)return-1;const e=this._list.readUInt32BE(this._pos);return this._pos+=4,P("_parse4ByteNum: result: %s",e),e}_parseVarByteNum(e){P("_parseVarByteNum");const r=4;let n=0,i=1,o=0,s=!1,a;const f=this._pos?this._pos:0;for(;n<r&&f+n<this._list.length;){if(a=this._list.readUInt8(f+n++),o+=i*(a&W.VARBYTEINT_MASK),i*=128,(a&W.VARBYTEINT_FIN_MASK)===0){s=!0;break}if(this._list.length<=n)break}return!s&&n===r&&this._list.length>=n&&this._emitError(new Error("Invalid variable byte integer")),f&&(this._pos+=n),s=s?e?{bytes:n,value:o}:o:!1,P("_parseVarByteNum: result: %o",s),s}_parseByte(){let e;return this._pos<this._list.length&&(e=this._list.readUInt8(this._pos),this._pos++),P("_parseByte: result: %o",e),e}_parseByType(e){switch(P("_parseByType: type: %s",e),e){case"byte":return this._parseByte()!==0;case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}}_parseProperties(){P("_parseProperties");const e=this._parseVarByteNum(),n=this._pos+e,i={};for(;this._pos<n;){const o=this._parseByte();if(!o)return this._emitError(new Error("Cannot parse property code type")),!1;const s=W.propertiesCodes[o];if(!s)return this._emitError(new Error("Unknown property")),!1;if(s==="userProperties"){i[s]||(i[s]=Object.create(null));const a=this._parseByType(W.propertiesTypes[s]);if(i[s][a.name])if(Array.isArray(i[s][a.name]))i[s][a.name].push(a.value);else{const f=i[s][a.name];i[s][a.name]=[f],i[s][a.name].push(a.value)}else i[s][a.name]=a.value;continue}i[s]?Array.isArray(i[s])?i[s].push(this._parseByType(W.propertiesTypes[s])):(i[s]=[i[s]],i[s].push(this._parseByType(W.propertiesTypes[s]))):i[s]=this._parseByType(W.propertiesTypes[s])}return i}_newPacket(){return P("_newPacket"),this.packet&&(this._list.consume(this.packet.length),P("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),P("_newPacket: new packet"),this.packet=new Mi,this._pos=0,!0}_emitError(e){P("_emitError"),this.error=e,this.emit("error",e)}}var Rc=br;const Pc=65536,Uo={},Mc=Buffer.isBuffer(Buffer.from([1,2]).subarray(0,1));function Fo(t){const e=Buffer.allocUnsafe(2);return e.writeUInt8(t>>8,0),e.writeUInt8(t&255,0+1),e}function Oc(){for(let t=0;t<Pc;t++)Uo[t]=Fo(t)}function Lc(t){let r=0,n=0;const i=Buffer.allocUnsafe(4);do r=t%128|0,t=t/128|0,t>0&&(r=r|128),i.writeUInt8(r,n++);while(t>0&&n<4);return t>0&&(n=0),Mc?i.subarray(0,n):i.slice(0,n)}function Dc(t){const e=Buffer.allocUnsafe(4);return e.writeUInt32BE(t,0),e}var Uc={cache:Uo,generateCache:Oc,generateNumber:Fo,genBufVariableByteInt:Lc,generate4ByteBuffer:Dc},Sn={exports:{}};typeof process=="undefined"||!process.version||process.version.indexOf("v0.")===0||process.version.indexOf("v1.")===0&&process.version.indexOf("v1.8.")!==0?Sn.exports={nextTick:Fc}:Sn.exports=process;function Fc(t,e,r,n){if(typeof t!="function")throw new TypeError('"callback" argument must be a function');var i=arguments.length,o,s;switch(i){case 0:case 1:return process.nextTick(t);case 2:return process.nextTick(function(){t.call(null,e)});case 3:return process.nextTick(function(){t.call(null,e,r)});case 4:return process.nextTick(function(){t.call(null,e,r,n)});default:for(o=new Array(i-1),s=0;s<o.length;)o[s++]=arguments[s];return process.nextTick(function(){t.apply(null,o)})}}const M=Gn.exports,Nc=Buffer.allocUnsafe(0),jc=Buffer.from([0]),Jt=Uc,qc=Sn.exports.nextTick,we=Ae.exports("mqtt-packet:writeToStream"),wr=Jt.cache,Wc=Jt.generateNumber,$c=Jt.generateCache,Tn=Jt.genBufVariableByteInt,zc=Jt.generate4ByteBuffer;let ce=Cn,mr=!0;function No(t,e,r){switch(we("generate called"),e.cork&&(e.cork(),qc(Vc,e)),mr&&(mr=!1,$c()),we("generate: packet.cmd: %s",t.cmd),t.cmd){case"connect":return Hc(t,e);case"connack":return Kc(t,e,r);case"publish":return Gc(t,e,r);case"puback":case"pubrec":case"pubrel":case"pubcomp":return Qc(t,e,r);case"subscribe":return Yc(t,e,r);case"suback":return Xc(t,e,r);case"unsubscribe":return Zc(t,e,r);case"unsuback":return Jc(t,e,r);case"pingreq":case"pingresp":return eh(t,e);case"disconnect":return th(t,e,r);case"auth":return rh(t,e,r);default:return e.emit("error",new Error("Unknown command")),!1}}Object.defineProperty(No,"cacheNumbers",{get(){return ce===Cn},set(t){t?((!wr||Object.keys(wr).length===0)&&(mr=!0),ce=Cn):(mr=!1,ce=nh)}});function Vc(t){t.uncork()}function Hc(t,e,r){const n=t||{},i=n.protocolId||"MQTT";let o=n.protocolVersion||4;const s=n.will;let a=n.clean;const f=n.keepalive||0,l=n.clientId||"",d=n.username,p=n.password,y=n.properties;a===void 0&&(a=!0);let w=0;if(!i||typeof i!="string"&&!Buffer.isBuffer(i))return e.emit("error",new Error("Invalid protocolId")),!1;if(w+=i.length+2,o!==3&&o!==4&&o!==5)return e.emit("error",new Error("Invalid protocol version")),!1;if(w+=1,(typeof l=="string"||Buffer.isBuffer(l))&&(l||o>=4)&&(l||a))w+=Buffer.byteLength(l)+2;else{if(o<4)return e.emit("error",new Error("clientId must be supplied before 3.1.1")),!1;if(a*1===0)return e.emit("error",new Error("clientId must be given if cleanSession set to 0")),!1}if(typeof f!="number"||f<0||f>65535||f%1!==0)return e.emit("error",new Error("Invalid keepalive")),!1;if(w+=2,w+=1,o===5){var S=et(e,y);if(!S)return!1;w+=S.length}if(s){if(typeof s!="object")return e.emit("error",new Error("Invalid will")),!1;if(!s.topic||typeof s.topic!="string")return e.emit("error",new Error("Invalid will topic")),!1;if(w+=Buffer.byteLength(s.topic)+2,w+=2,s.payload)if(s.payload.length>=0)typeof s.payload=="string"?w+=Buffer.byteLength(s.payload):w+=s.payload.length;else return e.emit("error",new Error("Invalid will payload")),!1;var _={};if(o===5){if(_=et(e,s.properties),!_)return!1;w+=_.length}}let C=!1;if(d!=null)if(Fi(d))C=!0,w+=Buffer.byteLength(d)+2;else return e.emit("error",new Error("Invalid username")),!1;if(p!=null){if(!C)return e.emit("error",new Error("Username is required to use password")),!1;if(Fi(p))w+=jo(p)+2;else return e.emit("error",new Error("Invalid password")),!1}e.write(M.CONNECT_HEADER),_e(e,w),vt(e,i),n.bridgeMode&&(o+=128),e.write(o===131?M.VERSION131:o===132?M.VERSION132:o===4?M.VERSION4:o===5?M.VERSION5:M.VERSION3);let x=0;return x|=d!=null?M.USERNAME_MASK:0,x|=p!=null?M.PASSWORD_MASK:0,x|=s&&s.retain?M.WILL_RETAIN_MASK:0,x|=s&&s.qos?s.qos<<M.WILL_QOS_SHIFT:0,x|=s?M.WILL_FLAG_MASK:0,x|=a?M.CLEAN_SESSION_MASK:0,e.write(Buffer.from([x])),ce(e,f),o===5&&S.write(),vt(e,l),s&&(o===5&&_.write(),ct(e,s.topic),vt(e,s.payload)),d!=null&&vt(e,d),p!=null&&vt(e,p),!0}function Kc(t,e,r){const n=r?r.protocolVersion:4,i=t||{},o=n===5?i.reasonCode:i.returnCode,s=i.properties;let a=2;if(typeof o!="number")return e.emit("error",new Error("Invalid return code")),!1;let f=null;if(n===5){if(f=et(e,s),!f)return!1;a+=f.length}return e.write(M.CONNACK_HEADER),_e(e,a),e.write(i.sessionPresent?M.SESSIONPRESENT_HEADER:jc),e.write(Buffer.from([o])),f!=null&&f.write(),!0}function Gc(t,e,r){we("publish: packet: %o",t);const n=r?r.protocolVersion:4,i=t||{},o=i.qos||0,s=i.retain?M.RETAIN_MASK:0,a=i.topic,f=i.payload||Nc,l=i.messageId,d=i.properties;let p=0;if(typeof a=="string")p+=Buffer.byteLength(a)+2;else if(Buffer.isBuffer(a))p+=a.length+2;else return e.emit("error",new Error("Invalid topic")),!1;if(Buffer.isBuffer(f)?p+=f.length:p+=Buffer.byteLength(f),o&&typeof l!="number")return e.emit("error",new Error("Invalid messageId")),!1;o&&(p+=2);let y=null;if(n===5){if(y=et(e,d),!y)return!1;p+=y.length}return e.write(M.PUBLISH_HEADER[o][i.dup?1:0][s?1:0]),_e(e,p),ce(e,jo(a)),e.write(a),o>0&&ce(e,l),y!=null&&y.write(),we("publish: payload: %o",f),e.write(f)}function Qc(t,e,r){const n=r?r.protocolVersion:4,i=t||{},o=i.cmd||"puback",s=i.messageId,a=i.dup&&o==="pubrel"?M.DUP_MASK:0;let f=0;const l=i.reasonCode,d=i.properties;let p=n===5?3:2;if(o==="pubrel"&&(f=1),typeof s!="number")return e.emit("error",new Error("Invalid messageId")),!1;let y=null;if(n===5&&typeof d=="object"){if(y=er(e,d,r,p),!y)return!1;p+=y.length}return e.write(M.ACKS[o][f][a][0]),_e(e,p),ce(e,s),n===5&&e.write(Buffer.from([l])),y!==null&&y.write(),!0}function Yc(t,e,r){we("subscribe: packet: ");const n=r?r.protocolVersion:4,i=t||{},o=i.dup?M.DUP_MASK:0,s=i.messageId,a=i.subscriptions,f=i.properties;let l=0;if(typeof s!="number")return e.emit("error",new Error("Invalid messageId")),!1;l+=2;let d=null;if(n===5){if(d=et(e,f),!d)return!1;l+=d.length}if(typeof a=="object"&&a.length)for(let y=0;y<a.length;y+=1){const w=a[y].topic,S=a[y].qos;if(typeof w!="string")return e.emit("error",new Error("Invalid subscriptions - invalid topic")),!1;if(typeof S!="number")return e.emit("error",new Error("Invalid subscriptions - invalid qos")),!1;if(n===5){if(typeof(a[y].nl||!1)!="boolean")return e.emit("error",new Error("Invalid subscriptions - invalid No Local")),!1;if(typeof(a[y].rap||!1)!="boolean")return e.emit("error",new Error("Invalid subscriptions - invalid Retain as Published")),!1;const x=a[y].rh||0;if(typeof x!="number"||x>2)return e.emit("error",new Error("Invalid subscriptions - invalid Retain Handling")),!1}l+=Buffer.byteLength(w)+2+1}else return e.emit("error",new Error("Invalid subscriptions")),!1;we("subscribe: writing to stream: %o",M.SUBSCRIBE_HEADER),e.write(M.SUBSCRIBE_HEADER[1][o?1:0][0]),_e(e,l),ce(e,s),d!==null&&d.write();let p=!0;for(const y of a){const w=y.topic,S=y.qos,_=+y.nl,C=+y.rap,x=y.rh;let h;ct(e,w),h=M.SUBSCRIBE_OPTIONS_QOS[S],n===5&&(h|=_?M.SUBSCRIBE_OPTIONS_NL:0,h|=C?M.SUBSCRIBE_OPTIONS_RAP:0,h|=x?M.SUBSCRIBE_OPTIONS_RH[x]:0),p=e.write(Buffer.from([h]))}return p}function Xc(t,e,r){const n=r?r.protocolVersion:4,i=t||{},o=i.messageId,s=i.granted,a=i.properties;let f=0;if(typeof o!="number")return e.emit("error",new Error("Invalid messageId")),!1;if(f+=2,typeof s=="object"&&s.length)for(let d=0;d<s.length;d+=1){if(typeof s[d]!="number")return e.emit("error",new Error("Invalid qos vector")),!1;f+=1}else return e.emit("error",new Error("Invalid qos vector")),!1;let l=null;if(n===5){if(l=er(e,a,r,f),!l)return!1;f+=l.length}return e.write(M.SUBACK_HEADER),_e(e,f),ce(e,o),l!==null&&l.write(),e.write(Buffer.from(s))}function Zc(t,e,r){const n=r?r.protocolVersion:4,i=t||{},o=i.messageId,s=i.dup?M.DUP_MASK:0,a=i.unsubscriptions,f=i.properties;let l=0;if(typeof o!="number")return e.emit("error",new Error("Invalid messageId")),!1;if(l+=2,typeof a=="object"&&a.length)for(let y=0;y<a.length;y+=1){if(typeof a[y]!="string")return e.emit("error",new Error("Invalid unsubscriptions")),!1;l+=Buffer.byteLength(a[y])+2}else return e.emit("error",new Error("Invalid unsubscriptions")),!1;let d=null;if(n===5){if(d=et(e,f),!d)return!1;l+=d.length}e.write(M.UNSUBSCRIBE_HEADER[1][s?1:0][0]),_e(e,l),ce(e,o),d!==null&&d.write();let p=!0;for(let y=0;y<a.length;y++)p=ct(e,a[y]);return p}function Jc(t,e,r){const n=r?r.protocolVersion:4,i=t||{},o=i.messageId,s=i.dup?M.DUP_MASK:0,a=i.granted,f=i.properties,l=i.cmd,d=0;let p=2;if(typeof o!="number")return e.emit("error",new Error("Invalid messageId")),!1;if(n===5)if(typeof a=="object"&&a.length)for(let w=0;w<a.length;w+=1){if(typeof a[w]!="number")return e.emit("error",new Error("Invalid qos vector")),!1;p+=1}else return e.emit("error",new Error("Invalid qos vector")),!1;let y=null;if(n===5){if(y=er(e,f,r,p),!y)return!1;p+=y.length}return e.write(M.ACKS[l][d][s][0]),_e(e,p),ce(e,o),y!==null&&y.write(),n===5&&e.write(Buffer.from(a)),!0}function eh(t,e,r){return e.write(M.EMPTY[t.cmd])}function th(t,e,r){const n=r?r.protocolVersion:4,i=t||{},o=i.reasonCode,s=i.properties;let a=n===5?1:0,f=null;if(n===5){if(f=er(e,s,r,a),!f)return!1;a+=f.length}return e.write(Buffer.from([M.codes.disconnect<<4])),_e(e,a),n===5&&e.write(Buffer.from([o])),f!==null&&f.write(),!0}function rh(t,e,r){const n=r?r.protocolVersion:4,i=t||{},o=i.reasonCode,s=i.properties;let a=n===5?1:0;n!==5&&e.emit("error",new Error("Invalid mqtt version for auth packet"));const f=er(e,s,r,a);return f?(a+=f.length,e.write(Buffer.from([M.codes.auth<<4])),_e(e,a),e.write(Buffer.from([o])),f!==null&&f.write(),!0):!1}const Oi={};function _e(t,e){if(e>M.VARBYTEINT_MAX)return t.emit("error",new Error(`Invalid variable byte integer: ${e}`)),!1;let r=Oi[e];return r||(r=Tn(e),e<16384&&(Oi[e]=r)),we("writeVarByteInt: writing to stream: %o",r),t.write(r)}function ct(t,e){const r=Buffer.byteLength(e);return ce(t,r),we("writeString: %s",e),t.write(e,"utf8")}function Li(t,e,r){ct(t,e),ct(t,r)}function Cn(t,e){return we("writeNumberCached: number: %d",e),we("writeNumberCached: %o",wr[e]),t.write(wr[e])}function nh(t,e){const r=Wc(e);return we("writeNumberGenerated: %o",r),t.write(r)}function ih(t,e){const r=zc(e);return we("write4ByteNumber: %o",r),t.write(r)}function vt(t,e){typeof e=="string"?ct(t,e):e?(ce(t,e.length),t.write(e)):ce(t,0)}function et(t,e){if(typeof e!="object"||e.length!=null)return{length:1,write(){Ui(t,{},0)}};let r=0;function n(o,s){const a=M.propertiesTypes[o];let f=0;switch(a){case"byte":{if(typeof s!="boolean")return t.emit("error",new Error(`Invalid ${o}: ${s}`)),!1;f+=1+1;break}case"int8":{if(typeof s!="number"||s<0||s>255)return t.emit("error",new Error(`Invalid ${o}: ${s}`)),!1;f+=1+1;break}case"binary":{if(s&&s===null)return t.emit("error",new Error(`Invalid ${o}: ${s}`)),!1;f+=1+Buffer.byteLength(s)+2;break}case"int16":{if(typeof s!="number"||s<0||s>65535)return t.emit("error",new Error(`Invalid ${o}: ${s}`)),!1;f+=1+2;break}case"int32":{if(typeof s!="number"||s<0||s>4294967295)return t.emit("error",new Error(`Invalid ${o}: ${s}`)),!1;f+=1+4;break}case"var":{if(typeof s!="number"||s<0||s>268435455)return t.emit("error",new Error(`Invalid ${o}: ${s}`)),!1;f+=1+Buffer.byteLength(Tn(s));break}case"string":{if(typeof s!="string")return t.emit("error",new Error(`Invalid ${o}: ${s}`)),!1;f+=1+2+Buffer.byteLength(s.toString());break}case"pair":{if(typeof s!="object")return t.emit("error",new Error(`Invalid ${o}: ${s}`)),!1;f+=Object.getOwnPropertyNames(s).reduce((l,d)=>{const p=s[d];return Array.isArray(p)?l+=p.reduce((y,w)=>(y+=1+2+Buffer.byteLength(d.toString())+2+Buffer.byteLength(w.toString()),y),0):l+=1+2+Buffer.byteLength(d.toString())+2+Buffer.byteLength(s[d].toString()),l},0);break}default:return t.emit("error",new Error(`Invalid property ${o}: ${s}`)),!1}return f}if(e)for(const o in e){let s=0,a=0;const f=e[o];if(Array.isArray(f))for(let l=0;l<f.length;l++){if(a=n(o,f[l]),!a)return!1;s+=a}else{if(a=n(o,f),!a)return!1;s=a}if(!s)return!1;r+=s}return{length:Buffer.byteLength(Tn(r))+r,write(){Ui(t,e,r)}}}function er(t,e,r,n){const i=["reasonString","userProperties"],o=r&&r.properties&&r.properties.maximumPacketSize?r.properties.maximumPacketSize:0;let s=et(t,e);if(o)for(;n+s.length>o;){const a=i.shift();if(a&&e[a])delete e[a],s=et(t,e);else return!1}return s}function Di(t,e,r){switch(M.propertiesTypes[e]){case"byte":{t.write(Buffer.from([M.properties[e]])),t.write(Buffer.from([+r]));break}case"int8":{t.write(Buffer.from([M.properties[e]])),t.write(Buffer.from([r]));break}case"binary":{t.write(Buffer.from([M.properties[e]])),vt(t,r);break}case"int16":{t.write(Buffer.from([M.properties[e]])),ce(t,r);break}case"int32":{t.write(Buffer.from([M.properties[e]])),ih(t,r);break}case"var":{t.write(Buffer.from([M.properties[e]])),_e(t,r);break}case"string":{t.write(Buffer.from([M.properties[e]])),ct(t,r);break}case"pair":{Object.getOwnPropertyNames(r).forEach(i=>{const o=r[i];Array.isArray(o)?o.forEach(s=>{t.write(Buffer.from([M.properties[e]])),Li(t,i.toString(),s.toString())}):(t.write(Buffer.from([M.properties[e]])),Li(t,i.toString(),o.toString()))});break}default:return t.emit("error",new Error(`Invalid property ${e} value: ${r}`)),!1}}function Ui(t,e,r){_e(t,r);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&e[n]!==null){const i=e[n];if(Array.isArray(i))for(let o=0;o<i.length;o++)Di(t,n,i[o]);else Di(t,n,i)}}function jo(t){return t?t instanceof Buffer?t.length:Buffer.byteLength(t):0}function Fi(t){return typeof t=="string"||t instanceof Buffer}var qo=No;const oh=qo,sh=ke;function ah(t,e){const r=new lh;return oh(t,r,e),r.concat()}class lh extends sh{constructor(){super(),this._array=new Array(20),this._i=0}write(e){return this._array[this._i++]=e,!0}concat(){let e=0;const r=new Array(this._array.length),n=this._array;let i=0,o;for(o=0;o<n.length&&n[o]!==void 0;o++)typeof n[o]!="string"?r[o]=n[o].length:r[o]=Buffer.byteLength(n[o]),e+=r[o];const s=Buffer.allocUnsafe(e);for(o=0;o<n.length&&n[o]!==void 0;o++)typeof n[o]!="string"?(n[o].copy(s,i),i+=r[o]):(s.write(n[o],i),i+=r[o]);return s}}var fh=ah;Nr.parser=Rc.parser;Nr.generate=fh;Nr.writeToStream=qo;function tt(){if(!(this instanceof tt))return new tt;this.nextId=Math.max(1,Math.floor(Math.random()*65535))}tt.prototype.allocate=function(){const t=this.nextId++;return this.nextId===65536&&(this.nextId=1),t};tt.prototype.getLastAllocated=function(){return this.nextId===1?65535:this.nextId-1};tt.prototype.register=function(t){return!0};tt.prototype.deallocate=function(t){};tt.prototype.clear=function(){};var uh=tt;function ch(t,e,r){var n=this;this._callback=t,this._args=r,this._interval=setInterval(t,e,this._args),this.reschedule=function(i){i||(i=n._interval),n._interval&&clearInterval(n._interval),n._interval=setInterval(n._callback,i,n._args)},this.clear=function(){n._interval&&(clearInterval(n._interval),n._interval=void 0)},this.destroy=function(){n._interval&&clearInterval(n._interval),n._callback=void 0,n._interval=void 0,n._args=void 0}}function hh(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("interval needed");var t;if(arguments.length>0){t=new Array(arguments.length-2);for(var e=0;e<t.length;e++)t[e]=arguments[e+2]}return new ch(arguments[0],arguments[1],t)}var ph=hh,dh=gh;function Et(t){return t instanceof Buffer?Buffer.from(t):new t.constructor(t.buffer.slice(),t.byteOffset,t.length)}function gh(t){if(t=t||{},t.circles)return yh(t);return t.proto?n:r;function e(i,o){for(var s=Object.keys(i),a=new Array(s.length),f=0;f<s.length;f++){var l=s[f],d=i[l];typeof d!="object"||d===null?a[l]=d:d instanceof Date?a[l]=new Date(d):ArrayBuffer.isView(d)?a[l]=Et(d):a[l]=o(d)}return a}function r(i){if(typeof i!="object"||i===null)return i;if(i instanceof Date)return new Date(i);if(Array.isArray(i))return e(i,r);if(i instanceof Map)return new Map(e(Array.from(i),r));if(i instanceof Set)return new Set(e(Array.from(i),r));var o={};for(var s in i)if(Object.hasOwnProperty.call(i,s)!==!1){var a=i[s];typeof a!="object"||a===null?o[s]=a:a instanceof Date?o[s]=new Date(a):a instanceof Map?o[s]=new Map(e(Array.from(a),r)):a instanceof Set?o[s]=new Set(e(Array.from(a),r)):ArrayBuffer.isView(a)?o[s]=Et(a):o[s]=r(a)}return o}function n(i){if(typeof i!="object"||i===null)return i;if(i instanceof Date)return new Date(i);if(Array.isArray(i))return e(i,n);if(i instanceof Map)return new Map(e(Array.from(i),n));if(i instanceof Set)return new Set(e(Array.from(i),n));var o={};for(var s in i){var a=i[s];typeof a!="object"||a===null?o[s]=a:a instanceof Date?o[s]=new Date(a):a instanceof Map?o[s]=new Map(e(Array.from(a),n)):a instanceof Set?o[s]=new Set(e(Array.from(a),n)):ArrayBuffer.isView(a)?o[s]=Et(a):o[s]=n(a)}return o}}function yh(t){var e=[],r=[];return t.proto?o:i;function n(s,a){for(var f=Object.keys(s),l=new Array(f.length),d=0;d<f.length;d++){var p=f[d],y=s[p];if(typeof y!="object"||y===null)l[p]=y;else if(y instanceof Date)l[p]=new Date(y);else if(ArrayBuffer.isView(y))l[p]=Et(y);else{var w=e.indexOf(y);w!==-1?l[p]=r[w]:l[p]=a(y)}}return l}function i(s){if(typeof s!="object"||s===null)return s;if(s instanceof Date)return new Date(s);if(Array.isArray(s))return n(s,i);if(s instanceof Map)return new Map(n(Array.from(s),i));if(s instanceof Set)return new Set(n(Array.from(s),i));var a={};e.push(s),r.push(a);for(var f in s)if(Object.hasOwnProperty.call(s,f)!==!1){var l=s[f];if(typeof l!="object"||l===null)a[f]=l;else if(l instanceof Date)a[f]=new Date(l);else if(l instanceof Map)a[f]=new Map(n(Array.from(l),i));else if(l instanceof Set)a[f]=new Set(n(Array.from(l),i));else if(ArrayBuffer.isView(l))a[f]=Et(l);else{var d=e.indexOf(l);d!==-1?a[f]=r[d]:a[f]=i(l)}}return e.pop(),r.pop(),a}function o(s){if(typeof s!="object"||s===null)return s;if(s instanceof Date)return new Date(s);if(Array.isArray(s))return n(s,o);if(s instanceof Map)return new Map(n(Array.from(s),o));if(s instanceof Set)return new Set(n(Array.from(s),o));var a={};e.push(s),r.push(a);for(var f in s){var l=s[f];if(typeof l!="object"||l===null)a[f]=l;else if(l instanceof Date)a[f]=new Date(l);else if(l instanceof Map)a[f]=new Map(n(Array.from(l),o));else if(l instanceof Set)a[f]=new Set(n(Array.from(l),o));else if(ArrayBuffer.isView(l))a[f]=Et(l);else{var d=e.indexOf(l);d!==-1?a[f]=r[d]:a[f]=o(l)}}return e.pop(),r.pop(),a}}var vh=dh();function bh(t){const e=t.split("/");for(let r=0;r<e.length;r++)if(e[r]!=="+"){if(e[r]==="#")return r===e.length-1;if(e[r].indexOf("+")!==-1||e[r].indexOf("#")!==-1)return!1}return!0}function wh(t){if(t.length===0)return"empty_topic_list";for(let e=0;e<t.length;e++)if(!bh(t[e]))return t[e];return null}var mh={validateTopics:wh};const Wo=ke.EventEmitter,_r=xo,_h=$u,Eh=Tc,$o=Nr,Sh=uh,Th=We.exports.Writable,Ch=Oe.exports,Ah=ph,zo=vh,Vo=mh,qr=Fn,T=Ae.exports("mqttjs:client"),Qn=process?process.nextTick:function(t){setTimeout(t,0)},Yn={}.setImmediate||function(t){Qn(t)},Ni={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:30*1e3,clean:!0,resubscribe:!0},kh=["ECONNREFUSED","EADDRINUSE","ECONNRESET","ENOTFOUND"],Er={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};function Ih(){return"mqttjs_"+Math.random().toString(16).substr(2,8)}function xh(t,e){if(t.options.protocolVersion===5&&e.cmd==="publish"){let r;e.properties&&(r=e.properties.topicAlias);const n=e.topic.toString();if(t.topicAliasSend)if(r){if(n.length!==0&&(T("applyTopicAlias :: register topic: %s - alias: %d",n,r),!t.topicAliasSend.put(n,r)))return T("applyTopicAlias :: error out of range. topic: %s - alias: %d",n,r),new Error("Sending Topic Alias out of range")}else n.length!==0&&(t.options.autoAssignTopicAlias?(r=t.topicAliasSend.getAliasByTopic(n),r?(e.topic="",e.properties=Lt(Ot({},e.properties),{topicAlias:r}),T("applyTopicAlias :: auto assign(use) topic: %s - alias: %d",n,r)):(r=t.topicAliasSend.getLruAlias(),t.topicAliasSend.put(n,r),e.properties=Lt(Ot({},e.properties),{topicAlias:r}),T("applyTopicAlias :: auto assign topic: %s - alias: %d",n,r))):t.options.autoUseTopicAlias&&(r=t.topicAliasSend.getAliasByTopic(n),r&&(e.topic="",e.properties=Lt(Ot({},e.properties),{topicAlias:r}),T("applyTopicAlias :: auto use topic: %s - alias: %d",n,r))));else if(r)return T("applyTopicAlias :: error out of range. topic: %s - alias: %d",n,r),new Error("Sending Topic Alias out of range")}}function Ho(t,e){let r;e.properties&&(r=e.properties.topicAlias);let n=e.topic.toString();if(n.length===0){if(typeof r=="undefined")return new Error("Unregistered Topic Alias");if(n=t.topicAliasSend.getTopicByAlias(r),typeof n=="undefined")return new Error("Unregistered Topic Alias");e.topic=n}r&&delete e.properties.topicAlias}function St(t,e,r){T("sendPacket :: packet: %O",e),T("sendPacket :: emitting `packetsend`"),t.emit("packetsend",e),T("sendPacket :: writing to stream");const n=$o.writeToStream(e,t.stream,t.options);T("sendPacket :: writeToStream result %s",n),!n&&r&&r!==te?(T("sendPacket :: handle events on `drain` once through callback."),t.stream.once("drain",r)):r&&(T("sendPacket :: invoking cb"),r())}function Bh(t){t&&(T("flush: queue exists? %b",!!t),Object.keys(t).forEach(function(e){typeof t[e].cb=="function"&&(t[e].cb(new Error("Connection closed")),delete t[e])}))}function Rh(t){t&&(T("flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(t).forEach(function(e){t[e].volatile&&typeof t[e].cb=="function"&&(t[e].cb(new Error("Connection closed")),delete t[e])}))}function ji(t,e,r,n){T("storeAndSend :: store packet with cmd %s to outgoingStore",e.cmd);let i=e,o;if(i.cmd==="publish"&&(i=zo(e),o=Ho(t,i),o))return r&&r(o);t.outgoingStore.put(i,function(a){if(a)return r&&r(a);n(),St(t,e,r)})}function te(t){T("nop ::",t)}function L(t,e){let r;const n=this;if(!(this instanceof L))return new L(t,e);this.options=e||{};for(r in Ni)typeof this.options[r]=="undefined"?this.options[r]=Ni[r]:this.options[r]=e[r];T("MqttClient :: options.protocol",e.protocol),T("MqttClient :: options.protocolVersion",e.protocolVersion),T("MqttClient :: options.username",e.username),T("MqttClient :: options.keepalive",e.keepalive),T("MqttClient :: options.reconnectPeriod",e.reconnectPeriod),T("MqttClient :: options.rejectUnauthorized",e.rejectUnauthorized),T("MqttClient :: options.topicAliasMaximum",e.topicAliasMaximum),this.options.clientId=typeof e.clientId=="string"?e.clientId:Ih(),T("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=e.protocolVersion===5&&e.customHandleAcks?e.customHandleAcks:function(){arguments[3](0)},this.streamBuilder=t,this.messageIdProvider=typeof this.options.messageIdProvider=="undefined"?new Sh:this.options.messageIdProvider,this.outgoingStore=e.outgoingStore||new _r,this.incomingStore=e.incomingStore||new _r,this.queueQoSZero=e.queueQoSZero===void 0?!0:e.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this._storeProcessingQueue=[],this.outgoing={},this._firstConnection=!0,e.topicAliasMaximum>0&&(e.topicAliasMaximum>65535?T("MqttClient :: options.topicAliasMaximum is out of range"):this.topicAliasRecv=new _h(e.topicAliasMaximum)),this.on("connect",function(){const i=this.queue;function o(){const s=i.shift();T("deliver :: entry %o",s);let a=null;if(!s){n._resubscribe();return}a=s.packet,T("deliver :: call _sendPacket for %o",a);let f=!0;a.messageId&&a.messageId!==0&&(n.messageIdProvider.register(a.messageId)||(f=!1)),f?n._sendPacket(a,function(l){s.cb&&s.cb(l),o()}):(T("messageId: %d has already used. The message is skipped and removed.",a.messageId),o())}T("connect :: sending queued packets"),o()}),this.on("close",function(){T("close :: connected set to `false`"),this.connected=!1,T("close :: clearing connackTimer"),clearTimeout(this.connackTimer),T("close :: clearing ping timer"),n.pingTimer!==null&&(n.pingTimer.clear(),n.pingTimer=null),this.topicAliasRecv&&this.topicAliasRecv.clear(),T("close :: calling _setupReconnect"),this._setupReconnect()}),Wo.call(this),T("MqttClient :: setting up stream"),this._setupStream()}Ch(L,Wo);L.prototype._setupStream=function(){const t=this,e=new Th,r=$o.parser(this.options);let n=null;const i=[];T("_setupStream :: calling method to clear reconnect"),this._clearReconnect(),T("_setupStream :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),r.on("packet",function(l){T("parser :: on packet push to packets array."),i.push(l)});function o(){if(i.length)Qn(s);else{const l=n;n=null,l()}}function s(){T("work :: getting next packet in queue");const l=i.shift();if(l)T("work :: packet pulled from queue"),t._handlePacket(l,o);else{T("work :: no packets in queue");const d=n;n=null,T("work :: done flag is %s",!!d),d&&d()}}e._write=function(l,d,p){n=p,T("writable stream :: parsing buffer"),r.parse(l),s()};function a(l){T("streamErrorHandler :: error",l.message),kh.includes(l.code)?(T("streamErrorHandler :: emitting error"),t.emit("error",l)):te(l)}T("_setupStream :: pipe stream to writable stream"),this.stream.pipe(e),this.stream.on("error",a),this.stream.on("close",function(){T("(%s)stream :: on close",t.options.clientId),Rh(t.outgoing),T("stream: emit close to MqttClient"),t.emit("close")}),T("_setupStream: sending packet `connect`");const f=Object.create(this.options);if(f.cmd="connect",this.topicAliasRecv&&(f.properties||(f.properties={}),this.topicAliasRecv&&(f.properties.topicAliasMaximum=this.topicAliasRecv.max)),St(this,f),r.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return t.end(()=>this.emit("error",new Error("Packet has no Authentication Method"))),this;if(this.options.properties.authenticationMethod&&this.options.authPacket&&typeof this.options.authPacket=="object"){const l=qr({cmd:"auth",reasonCode:0},this.options.authPacket);St(this,l)}}this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(function(){T("!!connectTimeout hit!! Calling _cleanUp with force `true`"),t._cleanUp(!0)},this.options.connectTimeout)};L.prototype._handlePacket=function(t,e){const r=this.options;if(r.protocolVersion===5&&r.properties&&r.properties.maximumPacketSize&&r.properties.maximumPacketSize<t.length)return this.emit("error",new Error("exceeding packets size "+t.cmd)),this.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),this;switch(T("_handlePacket :: emitting packetreceive"),this.emit("packetreceive",t),t.cmd){case"publish":this._handlePublish(t,e);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(t),e();break;case"pubrel":this._handlePubrel(t,e);break;case"connack":this._handleConnack(t),e();break;case"auth":this._handleAuth(t),e();break;case"pingresp":this._handlePingresp(t),e();break;case"disconnect":this._handleDisconnect(t),e();break}};L.prototype._checkDisconnecting=function(t){return this.disconnecting&&(t&&t!==te?t(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting};L.prototype.publish=function(t,e,r,n){T("publish :: message `%s` to topic `%s`",e,t);const i=this.options;if(typeof r=="function"&&(n=r,r=null),r=qr({qos:0,retain:!1,dup:!1},r),this._checkDisconnecting(n))return this;const s=this,a=function(){let f=0;if((r.qos===1||r.qos===2)&&(f=s._nextId(),f===null))return T("No messageId left"),!1;const l={cmd:"publish",topic:t,payload:e,qos:r.qos,retain:r.retain,messageId:f,dup:r.dup};switch(i.protocolVersion===5&&(l.properties=r.properties),T("publish :: qos",r.qos),r.qos){case 1:case 2:s.outgoing[l.messageId]={volatile:!1,cb:n||te},T("MqttClient:publish: packet cmd: %s",l.cmd),s._sendPacket(l,void 0,r.cbStorePut);break;default:T("MqttClient:publish: packet cmd: %s",l.cmd),s._sendPacket(l,n,r.cbStorePut);break}return!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!a())&&this._storeProcessingQueue.push({invoke:a,cbStorePut:r.cbStorePut,callback:n}),this};L.prototype.subscribe=function(){const t=this,e=new Array(arguments.length);for(let p=0;p<arguments.length;p++)e[p]=arguments[p];const r=[];let n=e.shift();const i=n.resubscribe;let o=e.pop()||te,s=e.pop();const a=this.options.protocolVersion;delete n.resubscribe,typeof n=="string"&&(n=[n]),typeof o!="function"&&(s=o,o=te);const f=Vo.validateTopics(n);if(f!==null)return Yn(o,new Error("Invalid topic "+f)),this;if(this._checkDisconnecting(o))return T("subscribe: discconecting true"),this;const l={qos:0};if(a===5&&(l.nl=!1,l.rap=!1,l.rh=0),s=qr(l,s),Array.isArray(n)?n.forEach(function(p){if(T("subscribe: array topic %s",p),!Object.prototype.hasOwnProperty.call(t._resubscribeTopics,p)||t._resubscribeTopics[p].qos<s.qos||i){const y={topic:p,qos:s.qos};a===5&&(y.nl=s.nl,y.rap=s.rap,y.rh=s.rh,y.properties=s.properties),T("subscribe: pushing topic `%s` and qos `%s` to subs list",y.topic,y.qos),r.push(y)}}):Object.keys(n).forEach(function(p){if(T("subscribe: object topic %s",p),!Object.prototype.hasOwnProperty.call(t._resubscribeTopics,p)||t._resubscribeTopics[p].qos<n[p].qos||i){const y={topic:p,qos:n[p].qos};a===5&&(y.nl=n[p].nl,y.rap=n[p].rap,y.rh=n[p].rh,y.properties=s.properties),T("subscribe: pushing `%s` to subs list",y),r.push(y)}}),!r.length)return o(null,[]),this;const d=function(){const p=t._nextId();if(p===null)return T("No messageId left"),!1;const y={cmd:"subscribe",subscriptions:r,qos:1,retain:!1,dup:!1,messageId:p};if(s.properties&&(y.properties=s.properties),t.options.resubscribe){T("subscribe :: resubscribe true");const w=[];r.forEach(function(S){if(t.options.reconnectPeriod>0){const _={qos:S.qos};a===5&&(_.nl=S.nl||!1,_.rap=S.rap||!1,_.rh=S.rh||0,_.properties=S.properties),t._resubscribeTopics[S.topic]=_,w.push(S.topic)}}),t.messageIdToTopic[y.messageId]=w}return t.outgoing[y.messageId]={volatile:!0,cb:function(w,S){if(!w){const _=S.granted;for(let C=0;C<_.length;C+=1)r[C].qos=_[C]}o(w,r)}},T("subscribe :: call _sendPacket"),t._sendPacket(y),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!d())&&this._storeProcessingQueue.push({invoke:d,callback:o}),this};L.prototype.unsubscribe=function(){const t=this,e=new Array(arguments.length);for(let a=0;a<arguments.length;a++)e[a]=arguments[a];let r=e.shift(),n=e.pop()||te,i=e.pop();typeof r=="string"&&(r=[r]),typeof n!="function"&&(i=n,n=te);const o=Vo.validateTopics(r);if(o!==null)return Yn(n,new Error("Invalid topic "+o)),this;if(t._checkDisconnecting(n))return this;const s=function(){const a=t._nextId();if(a===null)return T("No messageId left"),!1;const f={cmd:"unsubscribe",qos:1,messageId:a};return typeof r=="string"?f.unsubscriptions=[r]:Array.isArray(r)&&(f.unsubscriptions=r),t.options.resubscribe&&f.unsubscriptions.forEach(function(l){delete t._resubscribeTopics[l]}),typeof i=="object"&&i.properties&&(f.properties=i.properties),t.outgoing[f.messageId]={volatile:!0,cb:n},T("unsubscribe: call _sendPacket"),t._sendPacket(f),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!s())&&this._storeProcessingQueue.push({invoke:s,callback:n}),this};L.prototype.end=function(t,e,r){const n=this;T("end :: (%s)",this.options.clientId),(t==null||typeof t!="boolean")&&(r=e||te,e=t,t=!1,typeof e!="object"&&(r=e,e=null,typeof r!="function"&&(r=te))),typeof e!="object"&&(r=e,e=null),T("end :: cb? %s",!!r),r=r||te;function i(){T("end :: closeStores: closing incoming and outgoing stores"),n.disconnected=!0,n.incomingStore.close(function(s){n.outgoingStore.close(function(a){if(T("end :: closeStores: emitting end"),n.emit("end"),r){const f=s||a;T("end :: closeStores: invoking callback with args"),r(f)}})}),n._deferredReconnect&&n._deferredReconnect()}function o(){T("end :: (%s) :: finish :: calling _cleanUp with force %s",n.options.clientId,t),n._cleanUp(t,()=>{T("end :: finish :: calling process.nextTick on closeStores"),Qn(i.bind(n))},e)}return this.disconnecting?(r(),this):(this._clearReconnect(),this.disconnecting=!0,!t&&Object.keys(this.outgoing).length>0?(T("end :: (%s) :: calling finish in 10ms once outgoing is empty",n.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,o,10))):(T("end :: (%s) :: immediately calling finish",n.options.clientId),o()),this)};L.prototype.removeOutgoingMessage=function(t){const e=this.outgoing[t]?this.outgoing[t].cb:null;return delete this.outgoing[t],this.outgoingStore.del({messageId:t},function(){e(new Error("Message removed"))}),this};L.prototype.reconnect=function(t){T("client reconnect");const e=this,r=function(){t?(e.options.incomingStore=t.incomingStore,e.options.outgoingStore=t.outgoingStore):(e.options.incomingStore=null,e.options.outgoingStore=null),e.incomingStore=e.options.incomingStore||new _r,e.outgoingStore=e.options.outgoingStore||new _r,e.disconnecting=!1,e.disconnected=!1,e._deferredReconnect=null,e._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=r:r(),this};L.prototype._reconnect=function(){T("_reconnect: emitting reconnect to client"),this.emit("reconnect"),this.connected?(this.end(()=>{this._setupStream()}),T("client already connected. disconnecting first.")):(T("_reconnect: calling _setupStream"),this._setupStream())};L.prototype._setupReconnect=function(){const t=this;!t.disconnecting&&!t.reconnectTimer&&t.options.reconnectPeriod>0?(this.reconnecting||(T("_setupReconnect :: emit `offline` state"),this.emit("offline"),T("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),T("_setupReconnect :: setting reconnectTimer for %d ms",t.options.reconnectPeriod),t.reconnectTimer=setInterval(function(){T("reconnectTimer :: reconnect triggered!"),t._reconnect()},t.options.reconnectPeriod)):T("_setupReconnect :: doing nothing...")};L.prototype._clearReconnect=function(){T("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)};L.prototype._cleanUp=function(t,e){const r=arguments[2];if(e&&(T("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",e)),T("_cleanUp :: forced? %s",t),t)this.options.reconnectPeriod===0&&this.options.clean&&Bh(this.outgoing),T("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy();else{const n=qr({cmd:"disconnect"},r);T("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket(n,Yn.bind(null,this.stream.end.bind(this.stream)))}this.disconnecting||(T("_cleanUp :: client not disconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),this.pingTimer!==null&&(T("_cleanUp :: clearing pingTimer"),this.pingTimer.clear(),this.pingTimer=null),e&&!this.connected&&(T("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",e),e())};L.prototype._sendPacket=function(t,e,r){T("_sendPacket :: (%s) ::  start",this.options.clientId),r=r||te,e=e||te;const n=xh(this,t);if(n){e(n);return}if(!this.connected){if(t.cmd==="auth"){this._shiftPingInterval(),St(this,t,e);return}T("_sendPacket :: client not connected. Storing packet offline."),this._storePacket(t,e,r);return}switch(this._shiftPingInterval(),t.cmd){case"publish":break;case"pubrel":ji(this,t,e,r);return;default:St(this,t,e);return}switch(t.qos){case 2:case 1:ji(this,t,e,r);break;case 0:default:St(this,t,e);break}T("_sendPacket :: (%s) ::  end",this.options.clientId)};L.prototype._storePacket=function(t,e,r){T("_storePacket :: packet: %o",t),T("_storePacket :: cb? %s",!!e),r=r||te;let n=t;if(n.cmd==="publish"){n=zo(t);const i=Ho(this,n);if(i)return e&&e(i)}(n.qos||0)===0&&this.queueQoSZero||n.cmd!=="publish"?this.queue.push({packet:n,cb:e}):n.qos>0?(e=this.outgoing[n.messageId]?this.outgoing[n.messageId].cb:null,this.outgoingStore.put(n,function(i){if(i)return e&&e(i);r()})):e&&e(new Error("No connection to broker"))};L.prototype._setupPingTimer=function(){T("_setupPingTimer :: keepalive %d (seconds)",this.options.keepalive);const t=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=Ah(function(){t._checkPing()},this.options.keepalive*1e3))};L.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(this.options.keepalive*1e3)};L.prototype._checkPing=function(){T("_checkPing :: checking ping..."),this.pingResp?(T("_checkPing :: ping response received. Clearing flag and sending `pingreq`"),this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):(T("_checkPing :: calling _cleanUp with force true"),this._cleanUp(!0))};L.prototype._handlePingresp=function(){this.pingResp=!0};L.prototype._handleConnack=function(t){T("_handleConnack");const e=this.options,n=e.protocolVersion===5?t.reasonCode:t.returnCode;if(clearTimeout(this.connackTimer),delete this.topicAliasSend,t.properties){if(t.properties.topicAliasMaximum){if(t.properties.topicAliasMaximum>65535){this.emit("error",new Error("topicAliasMaximum from broker is out of range"));return}t.properties.topicAliasMaximum>0&&(this.topicAliasSend=new Eh(t.properties.topicAliasMaximum))}t.properties.serverKeepAlive&&e.keepalive&&(e.keepalive=t.properties.serverKeepAlive,this._shiftPingInterval()),t.properties.maximumPacketSize&&(e.properties||(e.properties={}),e.properties.maximumPacketSize=t.properties.maximumPacketSize)}if(n===0)this.reconnecting=!1,this._onConnect(t);else if(n>0){const i=new Error("Connection refused: "+Er[n]);i.code=n,this.emit("error",i)}};L.prototype._handleAuth=function(t){const r=this.options.protocolVersion,n=r===5?t.reasonCode:t.returnCode;if(r!==5){const o=new Error("Protocol error: Auth packets are only supported in MQTT 5. Your version:"+r);o.code=n,this.emit("error",o);return}const i=this;this.handleAuth(t,function(o,s){if(o){i.emit("error",o);return}if(n===24)i.reconnecting=!1,i._sendPacket(s);else{const a=new Error("Connection refused: "+Er[n]);o.code=n,i.emit("error",a)}})};L.prototype.handleAuth=function(t,e){e()};L.prototype._handlePublish=function(t,e){T("_handlePublish: packet %o",t),e=typeof e!="undefined"?e:te;let r=t.topic.toString();const n=t.payload,i=t.qos,o=t.messageId,s=this,a=this.options,f=[0,16,128,131,135,144,145,151,153];if(this.options.protocolVersion===5){let l;if(t.properties&&(l=t.properties.topicAlias),typeof l!="undefined")if(r.length===0)if(l>0&&l<=65535){const d=this.topicAliasRecv.getTopicByAlias(l);if(d)r=d,T("_handlePublish :: topic complemented by alias. topic: %s - alias: %d",r,l);else{T("_handlePublish :: unregistered topic alias. alias: %d",l),this.emit("error",new Error("Received unregistered Topic Alias"));return}}else{T("_handlePublish :: topic alias out of range. alias: %d",l),this.emit("error",new Error("Received Topic Alias is out of range"));return}else if(this.topicAliasRecv.put(r,l))T("_handlePublish :: registered topic: %s - alias: %d",r,l);else{T("_handlePublish :: topic alias out of range. alias: %d",l),this.emit("error",new Error("Received Topic Alias is out of range"));return}}switch(T("_handlePublish: qos %d",i),i){case 2:{a.customHandleAcks(r,n,t,function(l,d){if(l instanceof Error||(d=l,l=null),l)return s.emit("error",l);if(f.indexOf(d)===-1)return s.emit("error",new Error("Wrong reason code for pubrec"));d?s._sendPacket({cmd:"pubrec",messageId:o,reasonCode:d},e):s.incomingStore.put(t,function(){s._sendPacket({cmd:"pubrec",messageId:o},e)})});break}case 1:{a.customHandleAcks(r,n,t,function(l,d){if(l instanceof Error||(d=l,l=null),l)return s.emit("error",l);if(f.indexOf(d)===-1)return s.emit("error",new Error("Wrong reason code for puback"));d||s.emit("message",r,n,t),s.handleMessage(t,function(p){if(p)return e&&e(p);s._sendPacket({cmd:"puback",messageId:o,reasonCode:d},e)})});break}case 0:this.emit("message",r,n,t),this.handleMessage(t,e);break;default:T("_handlePublish: unknown QoS. Doing nothing.");break}};L.prototype.handleMessage=function(t,e){e()};L.prototype._handleAck=function(t){const e=t.messageId,r=t.cmd;let n=null;const i=this.outgoing[e]?this.outgoing[e].cb:null,o=this;let s;if(!i){T("_handleAck :: Server sent an ack in error. Ignoring.");return}switch(T("_handleAck :: packet type",r),r){case"pubcomp":case"puback":{const a=t.reasonCode;a&&a>0&&a!==16&&(s=new Error("Publish error: "+Er[a]),s.code=a,i(s,t)),delete this.outgoing[e],this.outgoingStore.del(t,i),this.messageIdProvider.deallocate(e),this._invokeStoreProcessingQueue();break}case"pubrec":{n={cmd:"pubrel",qos:2,messageId:e};const a=t.reasonCode;a&&a>0&&a!==16?(s=new Error("Publish error: "+Er[a]),s.code=a,i(s,t)):this._sendPacket(n);break}case"suback":{delete this.outgoing[e],this.messageIdProvider.deallocate(e);for(let a=0;a<t.granted.length;a++)if((t.granted[a]&128)!==0){const f=this.messageIdToTopic[e];f&&f.forEach(function(l){delete o._resubscribeTopics[l]})}this._invokeStoreProcessingQueue(),i(null,t);break}case"unsuback":{delete this.outgoing[e],this.messageIdProvider.deallocate(e),this._invokeStoreProcessingQueue(),i(null);break}default:o.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&Object.keys(this.outgoing).length===0&&this.emit("outgoingEmpty")};L.prototype._handlePubrel=function(t,e){T("handling pubrel packet"),e=typeof e!="undefined"?e:te;const r=t.messageId,n=this,i={cmd:"pubcomp",messageId:r};n.incomingStore.get(t,function(o,s){o?n._sendPacket(i,e):(n.emit("message",s.topic,s.payload,s),n.handleMessage(s,function(a){if(a)return e(a);n.incomingStore.del(s,te),n._sendPacket(i,e)}))})};L.prototype._handleDisconnect=function(t){this.emit("disconnect",t)};L.prototype._nextId=function(){return this.messageIdProvider.allocate()};L.prototype.getLastMessageId=function(){return this.messageIdProvider.getLastAllocated()};L.prototype._resubscribe=function(){T("_resubscribe");const t=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||this.options.protocolVersion===5&&!this.connackPacket.sessionPresent)&&t.length>0)if(this.options.resubscribe)if(this.options.protocolVersion===5){T("_resubscribe: protocolVersion 5");for(let e=0;e<t.length;e++){const r={};r[t[e]]=this._resubscribeTopics[t[e]],r.resubscribe=!0,this.subscribe(r,{properties:r[t[e]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1};L.prototype._onConnect=function(t){if(this.disconnected){this.emit("connect",t);return}const e=this;this.connackPacket=t,this.messageIdProvider.clear(),this._setupPingTimer(),this.connected=!0;function r(){let n=e.outgoingStore.createStream();function i(){e._storeProcessing=!1,e._packetIdsDuringStoreProcessing={}}e.once("close",o),n.on("error",function(a){i(),e._flushStoreProcessingQueue(),e.removeListener("close",o),e.emit("error",a)});function o(){n.destroy(),n=null,e._flushStoreProcessingQueue(),i()}function s(){if(!n)return;e._storeProcessing=!0;const a=n.read(1);let f;if(!a){n.once("readable",s);return}if(e._packetIdsDuringStoreProcessing[a.messageId]){s();return}!e.disconnecting&&!e.reconnectTimer?(f=e.outgoing[a.messageId]?e.outgoing[a.messageId].cb:null,e.outgoing[a.messageId]={volatile:!1,cb:function(l,d){f&&f(l,d),s()}},e._packetIdsDuringStoreProcessing[a.messageId]=!0,e.messageIdProvider.register(a.messageId)?e._sendPacket(a):T("messageId: %d has already used.",a.messageId)):n.destroy&&n.destroy()}n.on("end",function(){let a=!0;for(const f in e._packetIdsDuringStoreProcessing)if(!e._packetIdsDuringStoreProcessing[f]){a=!1;break}a?(i(),e.removeListener("close",o),e._invokeAllStoreProcessingQueue(),e.emit("connect",t)):r()}),s()}r()};L.prototype._invokeStoreProcessingQueue=function(){if(this._storeProcessingQueue.length>0){const t=this._storeProcessingQueue[0];if(t&&t.invoke())return this._storeProcessingQueue.shift(),!0}return!1};L.prototype._invokeAllStoreProcessingQueue=function(){for(;this._invokeStoreProcessingQueue(););};L.prototype._flushStoreProcessingQueue=function(){for(const t of this._storeProcessingQueue)t.cbStorePut&&t.cbStorePut(new Error("Connection closed")),t.callback&&t.callback(new Error("Connection closed"));this._storeProcessingQueue.splice(0)};var Ph=L;const Mh=ke,Oh=Ae.exports("mqttjs:tcp");function Lh(t,e){e.port=e.port||1883,e.hostname=e.hostname||e.host||"localhost";const r=e.port,n=e.hostname;return Oh("port %d and host %s",r,n),Mh.createConnection(r,n)}var qi=Lh;const Dh=ke,Uh=ke,Fh=Ae.exports("mqttjs:tls");function Nh(t,e){e.port=e.port||8883,e.host=e.hostname||e.host||"localhost",Uh.isIP(e.host)===0&&(e.servername=e.host),e.rejectUnauthorized=e.rejectUnauthorized!==!1,delete e.path,Fh("port %d host %s rejectUnauthorized %b",e.port,e.host,e.rejectUnauthorized);const r=Dh.connect(e);r.on("secureConnect",function(){e.rejectUnauthorized&&!r.authorized?r.emit("error",new Error("TLS not authorized")):r.removeListener("error",n)});function n(i){e.rejectUnauthorized&&t.emit("error",i),r.end()}return r.on("error",n),r}var dn=Nh,Xn={exports:{}},jh=Ko;function Ko(t,e){if(t&&e)return Ko(t)(e);if(typeof t!="function")throw new TypeError("need wrapper function");return Object.keys(t).forEach(function(n){r[n]=t[n]}),r;function r(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];var o=t.apply(this,n),s=n[n.length-1];return typeof o=="function"&&o!==s&&Object.keys(s).forEach(function(a){o[a]=s[a]}),o}}var Go=jh;Xn.exports=Go(hr);Xn.exports.strict=Go(Qo);hr.proto=hr(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return hr(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return Qo(this)},configurable:!0})});function hr(t){var e=function(){return e.called?e.value:(e.called=!0,e.value=t.apply(this,arguments))};return e.called=!1,e}function Qo(t){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=t.apply(this,arguments)},r=t.name||"Function wrapped with `once`";return e.onceError=r+" shouldn't be called more than once",e.called=!1,e}var qh=Xn.exports,Wh=function(){},$h=function(t){return t.setHeader&&typeof t.abort=="function"},zh=function(t){return t.stdio&&Array.isArray(t.stdio)&&t.stdio.length===3},Yo=function(t,e,r){if(typeof e=="function")return Yo(t,null,e);e||(e={}),r=qh(r||Wh);var n=t._writableState,i=t._readableState,o=e.readable||e.readable!==!1&&t.readable,s=e.writable||e.writable!==!1&&t.writable,a=!1,f=function(){t.writable||l()},l=function(){s=!1,o||r.call(t)},d=function(){o=!1,s||r.call(t)},p=function(C){r.call(t,C?new Error("exited with error code: "+C):null)},y=function(C){r.call(t,C)},w=function(){process.nextTick(S)},S=function(){if(!a){if(o&&!(i&&i.ended&&!i.destroyed))return r.call(t,new Error("premature close"));if(s&&!(n&&n.ended&&!n.destroyed))return r.call(t,new Error("premature close"))}},_=function(){t.req.on("finish",l)};return $h(t)?(t.on("complete",l),t.on("abort",w),t.req?_():t.on("request",_)):s&&!n&&(t.on("end",f),t.on("close",f)),zh(t)&&t.on("exit",p),t.on("end",d),t.on("finish",l),e.error!==!1&&t.on("error",y),t.on("close",w),function(){a=!0,t.removeListener("complete",l),t.removeListener("abort",w),t.removeListener("request",_),t.req&&t.req.removeListener("finish",l),t.removeListener("end",f),t.removeListener("close",f),t.removeListener("finish",l),t.removeListener("exit",p),t.removeListener("end",d),t.removeListener("error",y),t.removeListener("close",w)}},Vh=Yo,Hh=Kh;function Kh(t){var e=t._readableState;return e?e.objectMode||typeof t._duplexState=="number"?t.read():t.read(Gh(e)):null}function Gh(t){return t.buffer.length?t.buffer.head?t.buffer.head.data.length:t.buffer[0].length:t.length}var Wr=We.exports,Xo=Vh,Qh=Oe.exports,Yh=Hh,Zo=Buffer.from&&Buffer.from!==Uint8Array.from?Buffer.from([0]):new Buffer([0]),An=function(t,e){t._corked?t.once("uncork",e):e()},Xh=function(t,e){t._autoDestroy&&t.destroy(e)},Jo=function(t,e){return function(r){r?Xh(t,r.message==="premature close"?null:r):e&&!t._ended&&t.end()}},Zh=function(t,e){if(!t||t._writableState&&t._writableState.finished)return e();if(t._writableState)return t.end(e);t.end(),e()},Jh=function(){},ep=function(t){return new Wr.Readable({objectMode:!0,highWaterMark:16}).wrap(t)},re=function(t,e,r){if(!(this instanceof re))return new re(t,e,r);Wr.Duplex.call(this,r),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!r||r.autoDestroy!==!1,this._forwardDestroy=!r||r.destroy!==!1,this._forwardEnd=!r||r.end!==!1,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,t&&this.setWritable(t),e&&this.setReadable(e)};Qh(re,Wr.Duplex);re.obj=function(t,e,r){return r||(r={}),r.objectMode=!0,r.highWaterMark=16,new re(t,e,r)};re.prototype.cork=function(){++this._corked===1&&this.emit("cork")};re.prototype.uncork=function(){this._corked&&--this._corked===0&&this.emit("uncork")};re.prototype.setWritable=function(t){if(this._unwrite&&this._unwrite(),this.destroyed){t&&t.destroy&&t.destroy();return}if(t===null||t===!1){this.end();return}var e=this,r=Xo(t,{writable:!0,readable:!1},Jo(this,this._forwardEnd)),n=function(){var o=e._ondrain;e._ondrain=null,o&&o()},i=function(){e._writable.removeListener("drain",n),r()};this._unwrite&&process.nextTick(n),this._writable=t,this._writable.on("drain",n),this._unwrite=i,this.uncork()};re.prototype.setReadable=function(t){if(this._unread&&this._unread(),this.destroyed){t&&t.destroy&&t.destroy();return}if(t===null||t===!1){this.push(null),this.resume();return}var e=this,r=Xo(t,{writable:!1,readable:!0},Jo(this)),n=function(){e._forward()},i=function(){e.push(null)},o=function(){e._readable2.removeListener("readable",n),e._readable2.removeListener("end",i),r()};this._drained=!0,this._readable=t,this._readable2=t._readableState?t:ep(t),this._readable2.on("readable",n),this._readable2.on("end",i),this._unread=o,this._forward()};re.prototype._read=function(){this._drained=!0,this._forward()};re.prototype._forward=function(){if(!(this._forwarding||!this._readable2||!this._drained)){this._forwarding=!0;for(var t;this._drained&&(t=Yh(this._readable2))!==null;)this.destroyed||(this._drained=this.push(t));this._forwarding=!1}};re.prototype.destroy=function(t,e){if(e||(e=Jh),this.destroyed)return e(null);this.destroyed=!0;var r=this;process.nextTick(function(){r._destroy(t),e(null)})};re.prototype._destroy=function(t){if(t){var e=this._ondrain;this._ondrain=null,e?e(t):this.emit("error",t)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")};re.prototype._write=function(t,e,r){if(!this.destroyed){if(this._corked)return An(this,this._write.bind(this,t,e,r));if(t===Zo)return this._finish(r);if(!this._writable)return r();this._writable.write(t)===!1?this._ondrain=r:this.destroyed||r()}};re.prototype._finish=function(t){var e=this;this.emit("preend"),An(this,function(){Zh(e._forwardEnd&&e._writable,function(){e._writableState.prefinished===!1&&(e._writableState.prefinished=!0),e.emit("prefinish"),An(e,t)})})};re.prototype.end=function(t,e,r){return typeof t=="function"?this.end(null,null,t):typeof e=="function"?this.end(t,null,e):(this._ended=!0,t&&this.write(t),!this._writableState.ending&&!this._writableState.destroyed&&this.write(Zo),Wr.Writable.prototype.end.call(this,r))};var Zn=re;const{Buffer:Wi}=Ve,tp=We.exports.Transform,rp=Zn;let je,pr,ve;function np(){const t=new tp;return t._write=function(e,r,n){je.send({data:e.buffer,success:function(){n()},fail:function(i){n(new Error(i))}})},t._flush=function(r){je.close({success:function(){r()}})},t}function ip(t){t.hostname||(t.hostname="localhost"),t.path||(t.path="/"),t.wsOptions||(t.wsOptions={})}function op(t,e){const r=t.protocol==="wxs"?"wss":"ws";let n=r+"://"+t.hostname+t.path;return t.port&&t.port!==80&&t.port!==443&&(n=r+"://"+t.hostname+":"+t.port+t.path),typeof t.transformWsUrl=="function"&&(n=t.transformWsUrl(n,t,e)),n}function sp(){je.onOpen(function(){ve.setReadable(pr),ve.setWritable(pr),ve.emit("connect")}),je.onMessage(function(t){let e=t.data;e instanceof ArrayBuffer?e=Wi.from(e):e=Wi.from(e,"utf8"),pr.push(e)}),je.onClose(function(){ve.end(),ve.destroy()}),je.onError(function(t){ve.destroy(new Error(t.errMsg))})}function ap(t,e){if(e.hostname=e.hostname||e.host,!e.hostname)throw new Error("Could not determine host. Specify host manually.");const r=e.protocolId==="MQIsdp"&&e.protocolVersion===3?"mqttv3.1":"mqtt";ip(e);const n=op(e,t);je=wx.connectSocket({url:n,protocols:[r]}),pr=np(),ve=rp.obj(),ve._destroy=function(o,s){je.close({success:function(){s&&s(o)}})};const i=ve.destroy;return ve.destroy=function(){ve.destroy=i;const o=this;setTimeout(function(){je.close({fail:function(){o._destroy(new Error)}})},0)}.bind(ve),sp(),ve}var $i=ap;const{Buffer:gn}=Ve,lp=We.exports.Transform,fp=Zn;let Xe,Ft,Ge,zi=!1;function up(){const t=new lp;return t._write=function(e,r,n){Xe.sendSocketMessage({data:e.buffer,success:function(){n()},fail:function(){n(new Error)}})},t._flush=function(r){Xe.closeSocket({success:function(){r()}})},t}function cp(t){t.hostname||(t.hostname="localhost"),t.path||(t.path="/"),t.wsOptions||(t.wsOptions={})}function hp(t,e){const r=t.protocol==="alis"?"wss":"ws";let n=r+"://"+t.hostname+t.path;return t.port&&t.port!==80&&t.port!==443&&(n=r+"://"+t.hostname+":"+t.port+t.path),typeof t.transformWsUrl=="function"&&(n=t.transformWsUrl(n,t,e)),n}function pp(){zi||(zi=!0,Xe.onSocketOpen(function(){Ge.setReadable(Ft),Ge.setWritable(Ft),Ge.emit("connect")}),Xe.onSocketMessage(function(t){if(typeof t.data=="string"){const e=gn.from(t.data,"base64");Ft.push(e)}else{const e=new FileReader;e.addEventListener("load",function(){let r=e.result;r instanceof ArrayBuffer?r=gn.from(r):r=gn.from(r,"utf8"),Ft.push(r)}),e.readAsArrayBuffer(t.data)}}),Xe.onSocketClose(function(){Ge.end(),Ge.destroy()}),Xe.onSocketError(function(t){Ge.destroy(t)}))}function dp(t,e){if(e.hostname=e.hostname||e.host,!e.hostname)throw new Error("Could not determine host. Specify host manually.");const r=e.protocolId==="MQIsdp"&&e.protocolVersion===3?"mqttv3.1":"mqtt";cp(e);const n=hp(e,t);return Xe=e.my,Xe.connectSocket({url:n,protocols:r}),Ft=up(),Ge=fp.obj(),pp(),Ge}var Vi=dp,Sr={exports:{}},gp=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")};const{Buffer:Ut}=Ve,es=gp,Wt=Ae.exports("mqttjs:ws"),yp=Zn,vp=We.exports.Transform,bp=["rejectUnauthorized","ca","cert","key","pfx","passphrase"],ts=typeof process!="undefined"&&process.title==="browser"||typeof __webpack_require__=="function";function rs(t,e){let r=t.protocol+"://"+t.hostname+":"+t.port+t.path;return typeof t.transformWsUrl=="function"&&(r=t.transformWsUrl(r,t,e)),r}function ns(t){const e=t;return t.hostname||(e.hostname="localhost"),t.port||(t.protocol==="wss"?e.port=443:e.port=80),t.path||(e.path="/"),t.wsOptions||(e.wsOptions={}),!ts&&t.protocol==="wss"&&bp.forEach(function(r){Object.prototype.hasOwnProperty.call(t,r)&&!Object.prototype.hasOwnProperty.call(t.wsOptions,r)&&(e.wsOptions[r]=t[r])}),e}function wp(t){const e=ns(t);if(e.hostname||(e.hostname=e.host),!e.hostname){if(typeof document=="undefined")throw new Error("Could not determine host. Specify host manually.");const r=new URL(document.URL);e.hostname=r.hostname,e.port||(e.port=r.port)}return e.objectMode===void 0&&(e.objectMode=!(e.binary===!0||e.binary===void 0)),e}function mp(t,e,r){Wt("createWebSocket"),Wt("protocol: "+r.protocolId+" "+r.protocolVersion);const n=r.protocolId==="MQIsdp"&&r.protocolVersion===3?"mqttv3.1":"mqtt";return Wt("creating new Websocket for url: "+e+" and protocol: "+n),new es(e,[n],r.wsOptions)}function _p(t,e){const r=e.protocolId==="MQIsdp"&&e.protocolVersion===3?"mqttv3.1":"mqtt",n=rs(e,t),i=new WebSocket(n,[r]);return i.binaryType="arraybuffer",i}function Ep(t,e){Wt("streamBuilder");const r=ns(e),n=rs(r,t),i=mp(t,n,r),o=es.createWebSocketStream(i,r.wsOptions);return o.url=n,i.on("close",()=>{o.destroy()}),o}function Sp(t,e){Wt("browserStreamBuilder");let r;const i=wp(e).browserBufferSize||1024*512,o=e.browserBufferTimeout||1e3,s=!e.objectMode,a=_p(t,e),f=d(e,C,x);e.objectMode||(f._writev=_),f.on("close",()=>{a.close()});const l=typeof a.addEventListener!="undefined";a.readyState===a.OPEN?r=f:(r=r=yp(void 0,void 0,e),e.objectMode||(r._writev=_),l?a.addEventListener("open",p):a.onopen=p),r.socket=a,l?(a.addEventListener("close",y),a.addEventListener("error",w),a.addEventListener("message",S)):(a.onclose=y,a.onerror=w,a.onmessage=S);function d(h,g,m){const A=new vp({objectModeMode:h.objectMode});return A._write=g,A._flush=m,A}function p(){r.setReadable(f),r.setWritable(f),r.emit("connect")}function y(){r.end(),r.destroy()}function w(h){r.destroy(h)}function S(h){let g=h.data;g instanceof ArrayBuffer?g=Ut.from(g):g=Ut.from(g,"utf8"),f.push(g)}function _(h,g){const m=new Array(h.length);for(let A=0;A<h.length;A++)typeof h[A].chunk=="string"?m[A]=Ut.from(h[A],"utf8"):m[A]=h[A].chunk;this._write(Ut.concat(m),"binary",g)}function C(h,g,m){a.bufferedAmount>i&&setTimeout(C,o,h,g,m),s&&typeof h=="string"&&(h=Ut.from(h,"utf8"));try{a.send(h)}catch(A){return m(A)}m()}function x(h){a.close(),h()}return r}ts?Sr.exports=Sp:Sr.exports=Ep;const is=Ph,Tp=xo,Cp=ke,Ap=Fn,Hi=Ae.exports("mqttjs"),de={};typeof process!="undefined"&&process.title!=="browser"||typeof __webpack_require__!="function"?(de.mqtt=qi,de.tcp=qi,de.ssl=dn,de.tls=dn,de.mqtts=dn):(de.wx=$i,de.wxs=$i,de.ali=Vi,de.alis=Vi);de.ws=Sr.exports;de.wss=Sr.exports;function kp(t){let e;t.auth&&(e=t.auth.match(/^(.+):(.+)$/),e?(t.username=e[1],t.password=e[2]):t.username=t.auth)}function os(t,e){if(Hi("connecting to an MQTT broker..."),typeof t=="object"&&!e&&(e=t,t=null),e=e||{},t){const i=Cp.parse(t,!0);if(i.port!=null&&(i.port=Number(i.port)),e=Ap(i,e),e.protocol===null)throw new Error("Missing protocol");e.protocol=e.protocol.replace(/:$/,"")}if(kp(e),e.query&&typeof e.query.clientId=="string"&&(e.clientId=e.query.clientId),e.cert&&e.key)if(e.protocol){if(["mqtts","wss","wxs","alis"].indexOf(e.protocol)===-1)switch(e.protocol){case"mqtt":e.protocol="mqtts";break;case"ws":e.protocol="wss";break;case"wx":e.protocol="wxs";break;case"ali":e.protocol="alis";break;default:throw new Error('Unknown protocol for secure connection: "'+e.protocol+'"!')}}else throw new Error("Missing secure protocol key");if(!de[e.protocol]){const i=["mqtts","wss"].indexOf(e.protocol)!==-1;e.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter(function(o,s){return i&&s%2===0?!1:typeof de[o]=="function"})[0]}if(e.clean===!1&&!e.clientId)throw new Error("Missing clientId for unclean clients");e.protocol&&(e.defaultProtocol=e.protocol);function r(i){return e.servers&&((!i._reconnectCount||i._reconnectCount===e.servers.length)&&(i._reconnectCount=0),e.host=e.servers[i._reconnectCount].host,e.port=e.servers[i._reconnectCount].port,e.protocol=e.servers[i._reconnectCount].protocol?e.servers[i._reconnectCount].protocol:e.defaultProtocol,e.hostname=e.host,i._reconnectCount++),Hi("calling streambuilder for",e.protocol),de[e.protocol](i,e)}const n=new is(r,e);return n.on("error",function(){}),n}Gt.exports=os;Gt.exports.connect=os;Gt.exports.MqttClient=is;Gt.exports.Store=Tp;Object.defineProperty(Rr,"__esModule",{value:!0});Rr.connectMqttEventBroker=void 0;var Ip=Gt.exports,xp=ze;function Bp(t,e,r,n,i){return new Rp(t,e,r,n,i)}Rr.connectMqttEventBroker=Bp;var Rp=function(){function t(e,r,n,i,o){this._mqttClient=Ip.connect(e,{username:r,password:n,clean:!0,clientId:i}),o!==void 0?(this._mqttClient.on("message",function(s,a){o(xp.createEvent(s,a.toString("utf8")))}),this._eventHandlerPresent=!0):this._eventHandlerPresent=!1}return t.prototype.publish=function(e){this._mqttClient.publish(e.topic,e.payload)},t.prototype.subscribe=function(e){this._eventHandlerPresent?this._mqttClient.subscribe(e):console.warn("eventHandler not present, subscribe = noop")},t.prototype.unsubscribe=function(e){this._eventHandlerPresent?this._mqttClient.unsubscribe(e):console.warn("eventHandler not present, unsubscribe = noop")},t.prototype.disconnect=function(){this._mqttClient.end()},t}(),$r={};Object.defineProperty($r,"__esModule",{value:!0});$r.createPlatformMockApi=void 0;var Pp=qe;function Mp(t,e){return new Op(t,e)}$r.createPlatformMockApi=Mp;var Op=function(){function t(e,r){this._eventBroker=e,this._senderName=r}return Object.defineProperty(t.prototype,"eventBroker",{get:function(){return this._eventBroker},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"senderName",{get:function(){return this._senderName},enumerable:!1,configurable:!0}),t.prototype.disconnect=function(){this._eventBroker.disconnect()},t.prototype.createHelloPlatformEvent=function(e){return Pp.helloPlatform(this.senderName,e)},t}();Object.defineProperty(kr,"__esModule",{value:!0});kr.connect=void 0;var Lp=_l,Dp=Rr,Up=$r;function Fp(t,e,r,n,i){if(t==null||t.length===0)throw new Error("mqttAddress must not be blank");if(e==null||e.length===0)throw new Error("mqttUsername must not be blank");if(r==null||r.length===0)throw new Error("mqttPassword must not be blank");if(n==null||n.length===0)throw new Error("senderName must not be blank");var o=n+":"+Lp.v4(),s=Dp.connectMqttEventBroker(t,e,r,o,i);return Up.createPlatformMockApi(s,n)}kr.connect=Fp;(function(t){var e=xe&&xe.__createBinding||(Object.create?function(a,f,l,d){d===void 0&&(d=l),Object.defineProperty(a,d,{enumerable:!0,get:function(){return f[l]}})}:function(a,f,l,d){d===void 0&&(d=l),a[d]=f[l]}),r=xe&&xe.__setModuleDefault||(Object.create?function(a,f){Object.defineProperty(a,"default",{enumerable:!0,value:f})}:function(a,f){a.default=f}),n=xe&&xe.__importStar||function(a){if(a&&a.__esModule)return a;var f={};if(a!=null)for(var l in a)l!=="default"&&Object.hasOwnProperty.call(a,l)&&e(f,a,l);return r(f,a),f};Object.defineProperty(t,"__esModule",{value:!0});var i=ze;Object.defineProperty(t,"createEvent",{enumerable:!0,get:function(){return i.createEvent}});var o=Me;Object.defineProperty(t,"nameForSharedTopic",{enumerable:!0,get:function(){return o.nameForSharedTopic}}),Object.defineProperty(t,"nameForServiceSpecificTopic",{enumerable:!0,get:function(){return o.nameForServiceSpecificTopic}}),t.smartHomeEventBuilder=n(q),t.platformEventsEventBuilder=n(qe),t.appointmentsEventBuilder=n(Pe),t.hintsEventBuilder=n(Ct);var s=kr;Object.defineProperty(t,"connect",{enumerable:!0,get:function(){return s.connect}})})(gr);console.log("Script started successfully");let dr;const Np="ssl://broker.platform.pfaffhack.de:8883",jp="pfaffhack2021",qp="kaiserslautern",Wp="TesterJ",$p=gr.connect({}.CONFIG_MQTT_ADDRESS||Np,{}.CONFIG_MQTT_USERNAME||jp,{}.CONFIG_MQTT_PASSWORD||qp,{}.CONFIG_SENDER_NAME||Wp,function(t){console.log(`message arrived on topic ${t.topic}: ${t.payload}`)}),zp=$p.eventBroker;WA.onInit().then(()=>{console.log("Scripting API ready"),console.log("Player tags: ",WA.player.tags),WA.chat.sendChatMessage("Hello world","Mr Robot"),WA.chat.onChatMessage(t=>{zp.publish(gr.createEvent(gr.nameForServiceSpecificTopic("Workadventure"),t))}),WA.room.onEnterLayer("clockZone").subscribe(()=>{const t=new Date,e=t.getHours()+":"+t.getMinutes();dr=WA.ui.openPopup("clockPopup","It's "+e,[])}),WA.room.onLeaveLayer("clockZone").subscribe(Vp),ca().then(()=>{console.log("Scripting API Extra ready")}).catch(t=>console.error(t))}).catch(t=>console.error(t));function Vp(){dr!==void 0&&(dr.close(),dr=void 0)}
